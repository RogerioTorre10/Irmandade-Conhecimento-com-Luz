<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jornada ‚Ä¢ Irmandade Conhecimento com Luz</title>
  <link rel="stylesheet" href="/public/styles.css" onerror="this.onerror=null; this.href='/fallback-styles.css'; console.warn('Fallback CSS ativado por erro 502 em styles.css');">
  <link rel="alternate icon" href="/assets/img/perfil-da-irmandade.png" type="image/png">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f9f9f9; color: #333; }
    .site-header { display: flex; align-items: center; gap: 12px; padding: 16px; background: #1f2937; color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .chama { display: block; position: relative; overflow: hidden; }
    .chama span {
      position: absolute; bottom: 0; width: 100%; height: 100%;
      background: linear-gradient(to top, #ff4500 0%, #ff8c00 40%, rgba(255, 69, 0, 0) 100%);
      clip-path: polygon(50% 100%, 80% 60%, 70% 40%, 60% 20%, 50% 0%, 40% 20%, 30% 40%, 20% 60%);
      animation: flicker 1.5s infinite; border-radius: 2px;
    }
    .chama.chama-lg span { width: 32px; height: 80px; }
    .chama.chama-md-intermediario span { width: 24px; height: 60px; }
    .container { max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .card { background: #f6efe0; padding: 32px; }
    .j-pergunta { margin-bottom: 24px; display: none; }
    .j-pergunta.active { display: block; }
    #videoOverlay { display: none; }
    @keyframes flicker { 0%, 100% { transform: scaleY(1); opacity: 1; } 50% { transform: scaleY(1.2); opacity: 0.8; } }
  </style>
</head>
<body data-layout="master" data-journey="essencial">
  <header class="site-header">
    <div class="chama chama-lg">
      <span></span>
    </div>
    <h1>Jornada Essencial</h1>
  </header>
  <main id="page-shell" class="container">
    <section id="jornada-canvas" class="card">
      <div id="jornada-conteudo" class="conteudo-pergaminho">
        <div id="section-intro" class="j-section">
          <div class="chama chama-lg">
            <span></span>
          </div>
          <p data-typing data-text="Respire. Esta jornada √© sua. Um passo de cada vez." data-speed="40" data-cursor="true"></p>
          <p data-typing data-text="Bem-vindo(a) √† nossa casa de reflex√£o e coragem. Aqui, f√© e consci√™ncia se unem para acender sua chama interior ‚Äî passo a passo, jornada por jornada." data-speed="50" data-cursor="true"></p>
          <div class="footer-actions">
            <button id="btnIniciar" class="btn btn-primary" data-action="start">Iniciar</button>
          </div>
        </div>
        <div id="section-perguntas" class="j-section hidden">
          <div class="chama chama-md-intermediario" id="chama-perguntas">
            <span></span>
          </div>
          <div id="perguntas-container" class="j-bloco"></div>
          <div class="footer-actions">
            <button id="btnPrevPerguntas" class="btn btn-secondary" data-action="prev">Voltar</button>
            <button id="btnNextPerguntas" class="btn btn-primary" data-action="next">Pr√≥xima</button>
          </div>
        </div>
        <div id="section-final" class="j-section hidden">
          <div class="chama chama-lg" id="chama-final">
            <span></span>
          </div>
          <p data-typing data-text="Parab√©ns por completar esta jornada! Que sua chama interior continue a brilhar." data-speed="40" data-cursor="true"></p>
          <div class="password-form">
            <h3>Ative sua Senha</h3>
            <div class="password-input">
              <input type="password" id="senha" placeholder="Digite sua senha...">
              <span class="password-toggle" onclick="toggleSenha()">üëÅÔ∏è</span>
            </div>
            <button class="btn btn-primary" onclick="ativarSenha()">Ativar</button>
          </div>
          <div class="footer-actions">
            <button id="btnRestart" class="btn btn-secondary" data-action="restart">Reiniciar</button>
          </div>
        </div>
      </div>
    </section>
    <footer class="site-footer">
      <small>¬© 2025 Irmandade Conhecimento com Luz</small>
    </footer>
  </main>
  <div class="progress-badge" id="jprog-pct">0% conclu√≠do</div>
  <div class="progress-bar"><div class="progress-bar-fill" id="jprog-fill"></div></div>
  <div class="j-progress">
    <div class="j-progress__bar"><div class="j-progress__fill"></div></div>
    <div class="j-progress__meta" id="j-meta"></div>
  </div>
  <div id="videoOverlay" class="video-overlay hidden">
    <video id="videoTransicao" class="video-player" playsinline preload="metadata" controls></video>
    <button id="skipVideo" class="btn btn-secondary" style="position:absolute; top:14px; right:14px">Pular v√≠deo</button>
  </div>
  <div id="envTag"></div>

  <!-- Fallback inline se os scripts externos falharem -->
  <script>
    document.getElementById('envTag').textContent = `layout=${document.body.dataset.layout || 'master'} ¬∑ journey=${document.body.dataset.journey || 'essencial'} ¬∑ path=/public`;
    const positiveWords = ['feliz', 'alegria', 'amor'];
    const negativeWords = ['triste', 'dor', 'raiva'];

    function analyzeSentiment(text) {
      const words = text.toLowerCase().split(/\s+/);
      let posCount = 0, negCount = 0;
      words.forEach(word => {
        if (positiveWords.includes(word)) posCount++;
        if (negativeWords.includes(word)) negCount++;
      });
      return posCount > negCount ? "alegre" : (negCount > posCount ? "sofrida" : "neutra");
    }

    function updateChama(score) {
      const chama = document.getElementById('chama-perguntas');
      if (chama) {
        chama.classList.remove('chama-weak', 'chama-strong');
        if (score === "sofrida") chama.classList.add('chama-weak');
        else if (score === "alegre") chama.classList.add('chama-strong');
      }
    }

    function showSection(sectionId) {
      const sections = document.querySelectorAll('.j-section');
      sections.forEach(section => section.classList.add('hidden'));
      const activeSection = document.getElementById(sectionId);
      if (activeSection) activeSection.classList.remove('hidden');
      updateCanvasBackground(sectionId);
    }

    function updateCanvasBackground(sectionId) {
      const canvas = document.getElementById('jornada-canvas');
      if (canvas) {
        if (sectionId === 'section-perguntas') canvas.className = 'card pergaminho pergaminho-h';
        else canvas.className = 'card pergaminho pergaminho-v';
      }
    }

    function loadDynamicBlocks() {
      const content = document.getElementById('perguntas-container');
      if (content) content.innerHTML = '<div class="j-pergunta active"><label class="pergunta-enunciado">Teste</label><textarea rows="4" placeholder="Digite sua resposta..."></textarea></div>';
      console.log('Blocos carregados como fallback!');
    }

    document.addEventListener('DOMContentLoaded', () => {
      showSection('section-intro');
      loadDynamicBlocks();
    });

    function toggleSenha() {
      const input = document.getElementById('senha');
      if (input) input.type = input.type === 'password' ? 'text' : 'password';
    }

    function ativarSenha() {
      const senha = document.getElementById('senha')?.value || '';
      if (senha === 'iniciar') alert('Senha ativada!');
      else alert('Senha incorreta. Tente novamente.');
    }
  </script>
  <script defer src="/public/config.js" onerror="console.error('Falha ao carregar config.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-utils.js" onerror="console.error('Falha ao carregar jornada-utils.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-core.js" onerror="console.error('Falha ao carregar jornada-core.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-auth.js" onerror="console.error('Falha ao carregar jornada-auth.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-chama.js" onerror="console.error('Falha ao carregar jornada-chama.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-paper-qa.js" onerror="console.error('Falha ao carregar jornada-paper-qa.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-typing.js" onerror="console.error('Falha ao carregar jornada-typing.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-controller.js" onerror="console.error('Falha ao carregar jornada-controller.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-render.js" onerror="console.error('Falha ao carregar jornada-render.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-bootstrap.js" onerror="console.error('Falha ao carregar jornada-bootstrap.js, usando fallback inline');"></script>
  <script defer src="/public/jornada-micro.js" onerror="console.error('Falha ao carregar jornada-micro.js, usando fallback inline');"></script>
  <script defer src="/public/api.js" onerror="console.error('Falha ao carregar api.js, usando fallback inline');"></script>
  <!-- Grok xAI - Uhuuuuuuu! üöÄ -->
