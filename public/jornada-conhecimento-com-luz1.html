<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jornada Conhecimento com Luz</title>
  <meta name="description" content="Jornada guiada com estilo pergaminho vertical e horizontal conforme a etapa.">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/styles-base.css" />
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link rel="stylesheet" href="/assets/css/chama.css" />
  <link rel="stylesheet" href="/assets/css/styles-intro.css" />
  <link rel="stylesheet" href="/assets/css/styles-termos.css" />
  <link rel="stylesheet" href="/assets/css/styles-senha.css" />
  <link rel="stylesheet" href="/assets/css/styles-guia.css" />
  <link rel="stylesheet" href="/assets/css/styles-selfie.css" />
  <link rel="stylesheet" href="/assets/css/styles-card.css" />
  <link rel="stylesheet" href="/assets/css/styles-perguntas.css" />
  <link rel="stylesheet" href="/assets/css/styles-final.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cardo:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body class="epic min-h-screen bg-slate-900 text-slate-100">
  <div class="language-selector">
    <select id="language-select">
      <option value="pt-BR">Português (BR)</option>
      <option value="en-US">English (US)</option>
      <option value="es-ES">Español (ES)</option>
    </select>
  </div>
  <header class="site-header">
    <div id="chama-header" class="chama-icone" aria-hidden="true">
      <div class="chama-vela chama-lg">
        <div class="brasa"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="brilho"></div>
      </div>
    </div>
    <h1>Jornada Essencial</h1>
  </header>
  <main class="container">
    <section id="jornada-canvas" class="card pergaminho pergaminho-v">
      <div id="section-conteudo" class="conteudo-pergaminho">
        <div id="aria-pergunta" class="sr-only" aria-live="polite"></div>
        <div id="jornada-content-wrapper"></div>
      </div>
    </section>
    <div id="flame-top-left" class="flame-corner flame-top-left">
      <div class="chama-vela chama-md">
        <div class="brasa"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="brilho"></div>
      </div>
    </div>
    <div id="flame-bottom-right" class="flame-corner flame-bottom-right">
      <div class="chama-vela chama-md">
        <div class="brasa"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="brilho"></div>
      </div>
    </div>
  </main>
  <footer class="site-footer">
    <small>© 2025 Irmandade Conhecimento com Luz</small>
    <div id="envTag" style="margin-top:6px;opacity:.6;font-size:18px;"></div>
  </footer>

  <!-- Scripts -->
  <script src="/assets/js/i18n.js" defer></script>
  <script src="/assets/js/config.js" defer></script>
  <script src="/assets/js/toast-safe.js" defer></script>
  <script src="/assets/js/jornada-shims.js" defer></script>
  <script src="/assets/js/jornada-utils.js" defer></script>
  <script src="/assets/js/api.js" defer></script>
  <script src="/assets/js/jornada-core.js" defer></script>
  <script src="/assets/js/jornada-loader.js" defer></script>
  <script src="/assets/js/jornada-render.js" defer></script>
  <script src="/assets/js/jornada-secoes.js" defer></script>
  <script src="/assets/js/jornada-chama.js" defer></script>
  <script src="/assets/js/jornada-auth.js" defer></script>
  <script src="/assets/js/jornada-paper-qa.js" defer></script>
  <script src="/assets/js/jornada-typing-font.js" defer></script>
  <script src="/assets/js/jornada-typing-bridge.js" defer></script>
  <script src="/assets/js/jornada-controller.js" defer></script>
  <script src="/assets/js/jornada-micro.js" defer></script>
  <script src="/assets/js/jornada-bootstrap.js" defer></script>
  <script src="/assets/js/navigation.js" defer></script>
  <script src="/assets/js/journey.js" defer></script>
  <script src="/assets/js/main.js" defer></script>
  <script src="/assets/js/video-transicao.js" defer></script>
  <script src="/assets/js/section-intro.js" defer></script>
  <script src="/assets/js/section-termos.js" defer></script>
  <script src="/assets/js/section-senha.js" defer></script>
  <script src="/assets/js/section-guia.js" defer></script>
  <script src="/assets/js/section-selfie.js" defer></script>
  <script src="/assets/js/section-card.js" defer></script>
  <script src="/assets/js/section-perguntas.js" defer></script>
  <script src="/assets/js/section-final.js" defer></script>

  <!-- Inicialização -->
  <script>
    window.addEventListener('load', () => {
      console.log('[Init] Evento load disparado');

      let initialized = false;

      const waitForScripts = (callback, maxAttempts = 50, interval = 1000) => {
        let attempts = 0;
        const check = () => {
          if (initialized) return;

          console.log(`[Init] Verificando scripts (tentativa ${attempts + 1}/${maxAttempts})...`);
          const ready = typeof window.JC?.init === 'function' && typeof window.carregarEtapa === 'function';

          if (ready) {
            initialized = true;
            console.log('[Init] Scripts prontos, executando callback');
            callback();
          } else {
            console.log('[Init] Status: JC.init', typeof window.JC?.init, 'carregarEtapa', typeof window.carregarEtapa);
            if (attempts < maxAttempts) {
              attempts++;
              setTimeout(check, interval);
            } else {
              console.error('[Init] Falha ao carregar scripts após várias tentativas');
              if (typeof window.JC?.show === 'function') {
                console.log('[Init] Forçando section-intro');
                window.JC.show('section-intro');
                forceSectionVisible('section-intro');
              } else {
                console.error('[Init] window.JC.show não disponível');
              }
            }
          }
        };
        check();
      };

      const forceSectionVisible = (sectionId) => {
        const el = document.getElementById(sectionId);
        if (!el) {
          console.warn(`[Init] Seção ${sectionId} não encontrada para forçar visibilidade`);
          return;
        }

        el.classList.remove('hidden');
        el.setAttribute('aria-hidden', 'false');
        el.style.display = 'block';
        el.style.opacity = '1';
        el.style.visibility = 'visible';
        el.style.zIndex = '2';
        el.style.transition = 'opacity 0.3s ease';

        console.log(`[Init] Visibilidade forçada para ${sectionId}`);
      };

      waitForScripts(() => {
        try {
          window.JC.init();
          console.log('[Init] JC.init executado com sucesso');
          window.JC.show('section-intro');

          setTimeout(() => {
            forceSectionVisible('section-intro');
          }, 3000);
        } catch (e) {
          console.error('[Init] Erro ao executar JC.init:', e);
        }
      });

      const observer = new MutationObserver(() => {
        const sections = document.querySelectorAll('section[data-section]');
        sections.forEach(sec => {
          if (sec.classList.contains('hidden') || sec.getAttribute('aria-hidden') === 'true') {
            console.log('[Init] Blindando visualmente seção:', sec.id);
            sec.classList.remove('hidden');
            sec.setAttribute('aria-hidden', 'false');
            sec.style.display = 'block';
            sec.style.opacity = '1';
            sec.style.visibility = 'visible';
            sec.style.zIndex = '2';
            sec.style.transition = 'opacity 0.3s ease';
          }
        });
      });

      observer.observe(document.body, { childList: true, subtree: true });
    });
  </script>

  <noscript>
    <p style="text-align:center; padding:12px">Ative o JavaScript para usar esta página.</p>
  </noscript>
</body>
</html>
