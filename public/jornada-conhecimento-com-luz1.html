<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jornada ‚Ä¢ Irmandade Conhecimento com Luz</title>
  <link rel="alternate icon" href="/assets/img/perfil-da-irmandade.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&family=Cardo:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="preload" href="/assets/fonts/ManufacturingConsent-Regular.ttf" as="font" type="font/ttf" crossorigin />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <style>
    /* util */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .hidden{display:none!important}
    .j-section{padding:16px}

    /* Perguntas vis√≠veis e contraste para teste das chamas */
    .pergunta-enunciado{display:block;margin:10px 0 6px;font-weight:700;color:#fff}
    .j-pergunta{display:none}
    .j-pergunta.active{display:block}
    textarea.input{width:100%;padding:14px;border-radius:10px;border:1px solid #7c3aed;background:#000;color:#fff;resize:vertical;min-height:110px}
    textarea.input::placeholder{color:#9ca3af}
    .devolutiva{margin-top:8px;padding:10px;border-left:3px solid #7c3aed;background:rgba(124,58,237,.08);color:#fff;border-radius:8px}

    /* Barra topo e bot√µes de idioma estilo pedra antiga */
    .topbar{position:sticky;top:0;z-index:1200;display:flex;gap:12px;align-items:center;justify-content:flex-start;background:#111;color:#fff;padding:8px 12px;border-bottom:1px solid #333}
    .lang-group{display:flex;gap:8px}
    .lang-pill{position:relative;background:#2b2b2b;color:#eaeaea;border:1px solid #5a4a32;border-radius:10px;padding:6px 10px;min-width:56px;font-weight:700;letter-spacing:.5px;box-shadow:inset 0 1px 0 rgba(255,255,255,.06), 0 2px 0 #3a2f21, 0 6px 12px rgba(0,0,0,.35)}
    .lang-pill[aria-pressed="true"]{background:#4b3b24;color:#fff;border-color:#886b44;box-shadow:inset 0 1px 0 rgba(255,255,255,.08), 0 2px 0 #4d3c28, 0 6px 14px rgba(0,0,0,.45)}
    .lang-pill::before{content:"";position:absolute;inset:-2px;border-radius:12px;background:linear-gradient(145deg,rgba(255,255,255,.06),rgba(0,0,0,.18));pointer-events:none}
    .tts-pill{background:#1f2937;color:#fff;border:1px solid #374151;border-radius:10px;padding:6px 10px}

    /* Contrato com Berkshire Swash */
    #section-termos .conteudo-pergaminho,
    #section-termos2 .conteudo-pergaminho{font-family:'Berkshire Swash',cursive;font-size:20px;line-height:1.6;color:#fff}
  </style>
</head>
<body$1>
  <div class="topbar">
    <div class="lang-group" role="group" aria-label="Escolher idioma">
      <button class="lang-pill" data-lang="pt-BR" aria-pressed="true">BRA</button>
      <button class="lang-pill" data-lang="en-US" aria-pressed="false">USA</button>
      <button class="lang-pill" data-lang="es-ES" aria-pressed="false">ES</button>
    </div>
    <button id="ttsToggle" aria-pressed="false" class="tts-pill">üîä Ler perguntas</button>
  </div>
  <!-- Se√ß√µes iniciais -->
  <section id="section-intro" class="j-section">
    <p data-typing data-text="Respire. Esta jornada √© sua. Um passo de cada vez." data-speed="40" data-cursor="true"></p>
    <div class="footer-actions">
      <button class="btn btn-primary" data-action="next-termos">Avan√ßar</button>
    </div>
  </section>

  <!-- Contrato dividido em duas p√°ginas -->
  <section id="section-termos" class="j-section hidden">
    <div class="conteudo-pergaminho">
      <h2>Termo de Responsabilidade e Consentimento Consciente ‚Äì Parte 1</h2>
      <p>Esta Jornada √© uma experi√™ncia de autoconhecimento e reflex√£o pessoal, com car√°ter educativo, espiritual e simb√≥lico. Ao acessar esta jornada, voc√™ declara estar ciente e de acordo com os seguintes pontos:</p>
      <ul>
        <li><strong>Responsabilidade Pessoal:</strong> Suas respostas refletem sua vis√£o de mundo, sentimentos e experi√™ncias pessoais, sendo de sua inteira responsabilidade.</li>
        <li><strong>Car√°ter N√£o Terap√™utico:</strong> Esta jornada n√£o substitui tratamento psicol√≥gico, m√©dico ou terap√™utico de qualquer natureza.</li>
        <li><strong>Neutralidade Religiosa:</strong> A jornada respeita todas as cren√ßas e n√£o busca substituir ou confrontar nenhuma religi√£o.</li>
      </ul>
      <div class="footer-actions">
        <button class="btn btn-primary" data-action="next-termos2">Pr√≥xima p√°gina</button>
      </div>
    </div>
  </section>

  <section id="section-termos2" class="j-section hidden">
    <div class="conteudo-pergaminho">
      <h2>Termo de Responsabilidade e Consentimento Consciente ‚Äì Parte 2</h2>
      <ul>
        <li><strong>Autonomia do Participante:</strong> Voc√™ √© livre para iniciar quando se sentir pronto. Ap√≥s o primeiro acesso, ter√° 24 horas para concluir. Se n√£o iniciar em 15 dias, a senha expira.</li>
        <li><strong>Privacidade:</strong> Nenhuma resposta √© armazenada ap√≥s a conclus√£o. Um PDF com suas respostas √© gerado apenas para download imediato.</li>
        <li><strong>Conduta Respeitosa:</strong> Recomenda-se linguagem cordial e respeitosa durante toda a jornada.</li>
      </ul>
      <p>Ao prosseguir, voc√™ confirma ci√™ncia e concord√¢ncia com todos os pontos apresentados.</p>
      <div class="footer-actions">
        <button class="btn btn-primary" data-action="next-senha">Avan√ßar</button>
      </div>
    </div>
  </section>

  <!-- Demais se√ß√µes (senha, guia, selfie, perguntas, final) permanecem iguais -->
  <section id="section-perguntas" class="j-section hidden">
    <div class="progress-container" style="margin-bottom:12px;">
      <div id="jprog-pct" class="progress-badge">0% conclu√≠do</div>
      <div class="progress-bar" style="width:100%;height:8px;background:#e5e7eb;border-radius:4px;margin-top:8px">
        <div id="jprog-fill" style="height:100%;background:#6b21a8;border-radius:4px;width:0%"></div>
      </div>
      <div id="j-meta" style="opacity:.7;margin-top:6px"></div>
    </div>
    <div id="perguntas-container"></div>
    <div class="footer-actions" style="margin-top:14px">
      <button class="btn btn-primary" data-action="next">Avan√ßar</button>
    </div>
  </section>

  <script>
  (function(){
    /* restaura exibi√ß√£o permanente da pergunta acima da caixa */
    window.loadDynamicBlocks=function(){
      const content=document.getElementById('perguntas-container');
      if(!content)return;
      const blocks=window.JORNADA_BLOCKS||[];
      content.innerHTML='';
      blocks.forEach((block,bIdx)=>{
        const bloco=document.createElement('section');
        bloco.className='j-bloco';bloco.dataset.bloco=bIdx;bloco.dataset.video=block.video_after||'';
        (block.questions||[]).forEach((q,qIdx)=>{
          const label=typeof q==='string'?q:q.label||q.text||'';
          const div=document.createElement('div');
          div.className='j-pergunta';div.dataset.pergunta=qIdx;
          div.innerHTML=`<label class="pergunta-enunciado">Pergunta ${qIdx+1}: ${label}</label><textarea rows="4" class="input" placeholder="Digite sua resposta..."></textarea>`;
          bloco.appendChild(div);
        });
        content.appendChild(bloco);
      });
      const first=content.querySelector('.j-pergunta');
      if(first) first.classList.add('active');
    };

    document.addEventListener('click',ev=>{
      if(ev.target.closest('[data-action="next-termos2"]')){ev.preventDefault();document.getElementById('section-termos').classList.add('hidden');document.getElementById('section-termos2').classList.remove('hidden');}
    });
  })();
  </script>
<script>
// ==== Complemento: perguntas vis√≠veis + fluxo e fallback de blocos ====
(function(){
  window.loadDynamicBlocks = function(){
    const content=document.getElementById('perguntas-container');
    if(!content) return;
    const blocks = window.JORNADA_BLOCKS || [
      {title:'Bloco 1 ‚Äî Ra√≠zes',questions:[{label:'Quem √© voc√™ hoje?'},{label:'O que te trouxe at√© aqui?'},{label:'Seu maior sonho espiritual?'}]},
      {title:'Bloco 2 ‚Äî Reflex√µes',questions:[{label:'Seus maiores desafios atuais?'},{label:'Como lida com o medo ou a d√∫vida?'},{label:'O que √© "luz" pra voc√™?'}]},
      {title:'Bloco 3 ‚Äî Crescimento',questions:[{label:'O que voc√™ quer mudar na sua vida?'},{label:'Quem te inspira e por qu√™?'},{label:'Como pratica gratid√£o no dia a dia?'}]},
      {title:'Bloco 4 ‚Äî Integra√ß√£o',questions:[{label:'Qual li√ß√£o voc√™ leva dessa jornada?'},{label:'Como vai aplicar isso no futuro?'},{label:'Uma mensagem para seu eu futuro.'}]}
    ];
    content.innerHTML='';
    blocks.forEach((block,bIdx)=>{
      const bloco=document.createElement('section');
      bloco.className='j-bloco'; bloco.dataset.bloco=bIdx; bloco.style.display=bIdx===0?'block':'none';
      (block.questions||[]).forEach((q,qIdx)=>{
        const label=typeof q==='string'? q : (q.label||q.text||'');
        const div=document.createElement('div'); div.className='j-pergunta'; div.dataset.pergunta=qIdx;
        div.innerHTML = `<label class="pergunta-enunciado">Pergunta ${qIdx+1}: ${label}</label>
<textarea rows="4" class="input" placeholder="Digite sua resposta..."></textarea>`;
        bloco.appendChild(div);
      });
      content.appendChild(bloco);
    });
    const first = content.querySelector('.j-bloco .j-pergunta');
    if(first) first.classList.add('active');
    updateProgress();
  };

  function updateProgress(){
    const perguntas=document.querySelectorAll('.j-pergunta');
    const answered=[...perguntas].filter(p=> (p.querySelector('textarea')?.value.trim()||'')!=='').length;
    const total=perguntas.length||1; const pct=Math.round((answered/total)*100);
    const fill=document.getElementById('jprog-fill'); if(fill) fill.style.width=pct+'%';
    const badge=document.getElementById('jprog-pct'); if(badge) badge.textContent=pct+'% conclu√≠do';
    const meta=document.getElementById('j-meta'); if(meta) meta.textContent=`Respondidas: ${answered} de ${total}`;
  }

  document.addEventListener('click',ev=>{
    if(ev.target.closest('[data-action="next-termos"]')){
      ev.preventDefault();
      document.getElementById('section-intro')?.classList.add('hidden');
      document.getElementById('section-termos')?.classList.remove('hidden');
    }
    if(ev.target.closest('[data-action="next-termos2"]')){
      ev.preventDefault();
      document.getElementById('section-termos')?.classList.add('hidden');
      document.getElementById('section-termos2')?.classList.remove('hidden');
    }
    if(ev.target.closest('[data-action="next-senha"]')){
      ev.preventDefault();
      document.getElementById('section-termos2')?.classList.add('hidden');
      document.getElementById('section-perguntas')?.classList.remove('hidden');
      if(typeof window.loadDynamicBlocks==='function') window.loadDynamicBlocks();
    }
    if(ev.target.closest('[data-action="next"]')){
      ev.preventDefault();
      const current = document.querySelector('.j-pergunta.active');
      if(!current){ const first=document.querySelector('.j-pergunta'); if(first) first.classList.add('active'); return; }
      const bloco = current.closest('.j-bloco');
      const perguntas=[...bloco.querySelectorAll('.j-pergunta')];
      const idx=perguntas.indexOf(current);
      current.classList.remove('active');
      if(idx+1<perguntas.length){ perguntas[idx+1].classList.add('active'); updateProgress(); return; }
      const blocos=[...document.querySelectorAll('.j-bloco')];
      const bi=blocos.indexOf(bloco);
      if(bi+1<blocos.length){ blocos.forEach(b=>b.style.display='none'); const nb=blocos[bi+1]; nb.style.display='block'; const first=nb.querySelector('.j-pergunta'); if(first){ first.classList.add('active'); } updateProgress(); }
    }
  });

  document.addEventListener('input',ev=>{ if(ev.target.closest('.j-pergunta textarea')) updateProgress(); });
})();
</script>
<script>
// ===== Acessibilidade, perguntas vis√≠veis, microfone e TTS =====
(function(){
  /* Estado de idioma e TTS */
  const langSel = document.getElementById('idiomaSelect');
  const ttsBtn = document.getElementById('ttsToggle');
  window.JLANG = langSel?.value || 'pt-BR';
  window.JTTS_ON = false;
  langSel?.addEventListener('change', ()=>{ window.JLANG = langSel.value; });
  ttsBtn?.addEventListener('click',()=>{ window.JTTS_ON=!window.JTTS_ON; ttsBtn.setAttribute('aria-pressed', String(window.JTTS_ON)); ttsBtn.textContent = (window.JTTS_ON? 'üîä Lendo perguntas' : 'üîá Ler perguntas'); });

  // Bot√µes de idioma (BRA/USA/ES) ‚Äî estilo pedra
  document.querySelectorAll('.lang-pill').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const lang = btn.dataset.lang; window.JLANG = lang;
      document.querySelectorAll('.lang-pill').forEach(b=>b.setAttribute('aria-pressed', String(b===btn)));
    });
  }); ttsBtn.textContent = (window.JTTS_ON? 'üîä Lendo perguntas' : 'üîá Ler perguntas'); });

  function speak(text){
    try{ if(!window.JTTS_ON) return; const u = new SpeechSynthesisUtterance(text); u.lang = window.JLANG||'pt-BR'; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);}catch(_){/* sem suporte */}
  }

  /* Microfone (STT) usando Web Speech API */
  function startDictation(target){
    try{
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition; if(!SR){ alert('Reconhecimento de voz n√£o suportado neste navegador.'); return; }
      const rec = new SR(); rec.lang = window.JLANG||'pt-BR'; rec.interimResults = true; rec.continuous = false;
      target.dataset.listening = 'true';
      rec.onresult = (e)=>{ let txt=''; for(let i=0;i<e.results.length;i++){ txt += e.results[i][0].transcript; } target.value = txt; target.dispatchEvent(new Event('input',{bubbles:true})); };
      rec.onend = ()=>{ delete target.dataset.listening; };
      rec.start();
    }catch(err){ console.error(err); alert('N√£o foi poss√≠vel iniciar o microfone.'); }
  }

  /* Substitui o loadDynamicBlocks para incluir bot√µes üéôÔ∏è e üîä e painel de devolutiva */
  const prevLDB = window.loadDynamicBlocks;
  window.loadDynamicBlocks = function(){
    if(typeof prevLDB==='function'){ /* deixa criar se j√° existir */ }
    const content=document.getElementById('perguntas-container'); if(!content) return;

    const blocks = window.JORNADA_BLOCKS || [
      {title:'Bloco 1 ‚Äî Ra√≠zes',questions:[{label:'Quem √© voc√™ hoje?'},{label:'O que te trouxe at√© aqui?'},{label:'Seu maior sonho espiritual?'}]},
      {title:'Bloco 2 ‚Äî Reflex√µes',questions:[{label:'Seus maiores desafios atuais?'},{label:'Como lida com o medo ou a d√∫vida?'},{label:'O que √© "luz" pra voc√™?'}]},
      {title:'Bloco 3 ‚Äî Crescimento',questions:[{label:'O que voc√™ quer mudar na sua vida?'},{label:'Quem te inspira e por qu√™?'},{label:'Como pratica gratid√£o no dia a dia?'}]},
      {title:'Bloco 4 ‚Äî Integra√ß√£o',questions:[{label:'Qual li√ß√£o voc√™ leva dessa jornada?'},{label:'Como vai aplicar isso no futuro?'},{label:'Uma mensagem para seu eu futuro.'}]}
    ];

    content.innerHTML='';
    blocks.forEach((block,bIdx)=>{
      const bloco=document.createElement('section'); bloco.className='j-bloco'; bloco.dataset.bloco=bIdx; bloco.style.display=bIdx===0?'block':'none';
      (block.questions||[]).forEach((q,qIdx)=>{
        const label = typeof q==='string'? q : (q.label||q.text||'');
        const div = document.createElement('div'); div.className='j-pergunta'; div.dataset.pergunta=qIdx;
        div.innerHTML = `
          <label class="pergunta-enunciado">Pergunta ${qIdx+1}: ${label}</label>
          <div class="input-row" style="display:flex;gap:8px;align-items:flex-start;">
            <textarea rows="4" class="input" placeholder="Fale ou digite sua resposta..."></textarea>
            <div class="tools" style="display:flex;flex-direction:column;gap:6px;min-width:120px;">
              <button type="button" class="btn btn-secondary mic-btn">üéôÔ∏è Ditado</button>
              <button type="button" class="btn btn-secondary speak-btn">üîä Ouvir</button>
            </div>
          </div>
          <div class="devolutiva" aria-live="polite" aria-atomic="true" hidden></div>`;
        bloco.appendChild(div);
      });
      content.appendChild(bloco);
    });

    const first = content.querySelector('.j-bloco .j-pergunta'); if(first) first.classList.add('active');
    updateProgress();
  };

  function updateProgress(){
    const perguntas=document.querySelectorAll('.j-pergunta');
    const answered=[...perguntas].filter(p=> (p.querySelector('textarea')?.value.trim()||'')!=='').length;
    const total=perguntas.length||1; const pct=Math.round((answered/total)*100);
    document.getElementById('jprog-fill')?.style && (document.getElementById('jprog-fill').style.width=pct+'%');
    const badge=document.getElementById('jprog-pct'); if(badge) badge.textContent=pct+'% conclu√≠do';
    const meta=document.getElementById('j-meta'); if(meta) meta.textContent=`Respondidas: ${answered} de ${total}`;
  }

  // Navega√ß√£o e corre√ß√£o do seletor "next-senha"
  document.addEventListener('click',ev=>{
    if(ev.target.closest('[data-action="next-termos"]')){
      ev.preventDefault();
      document.getElementById('section-intro')?.classList.add('hidden');
      document.getElementById('section-termos')?.classList.remove('hidden');
    }
    if(ev.target.closest('[data-action="next-termos2"]')){
      ev.preventDefault();
      document.getElementById('section-termos')?.classList.add('hidden');
      document.getElementById('section-termos2')?.classList.remove('hidden');
    }
    if(ev.target.closest('[data-action="next-senha"]')){ // <‚Äî corrigido (sem escapes)
      ev.preventDefault();
      document.getElementById('section-termos2')?.classList.add('hidden');
      document.getElementById('section-perguntas')?.classList.remove('hidden');
      window.loadDynamicBlocks();
      // fala a primeira pergunta se TTS ativo
      const active=document.querySelector('.j-pergunta');
      const text=active?.querySelector('.pergunta-enunciado')?.textContent||''; speak(text);
    }
    if(ev.target.closest('[data-action="next"]')){
      ev.preventDefault();
      const current = document.querySelector('.j-pergunta.active');
      if(!current){ const first=document.querySelector('.j-pergunta'); if(first){ first.classList.add('active'); speak(first.querySelector('.pergunta-enunciado')?.textContent||''); } return; }
      const bloco = current.closest('.j-bloco');
      const perguntas=[...bloco.querySelectorAll('.j-pergunta')];
      const idx=perguntas.indexOf(current);
      current.classList.remove('active');
      if(idx+1<perguntas.length){
        const nxt = perguntas[idx+1]; nxt.classList.add('active'); updateProgress(); speak(nxt.querySelector('.pergunta-enunciado')?.textContent||''); return;
      }
      const blocos=[...document.querySelectorAll('.j-bloco')];
      const bi=blocos.indexOf(bloco);
      if(bi+1<blocos.length){
        blocos.forEach(b=>b.style.display='none');
        const nb=blocos[bi+1]; nb.style.display='block';
        const first=nb.querySelector('.j-pergunta'); if(first){ first.classList.add('active'); speak(first.querySelector('.pergunta-enunciado')?.textContent||''); }
        updateProgress();
      } else {
        // fim ‚Äî aqui podemos exibir a p√°gina final depois
      }
    }

    // Bot√µes por pergunta
    const mic = ev.target.closest('.mic-btn');
    if(mic){ ev.preventDefault(); const ta = mic.closest('.j-pergunta').querySelector('textarea'); if(ta) startDictation(ta); }
    const spk = ev.target.closest('.speak-btn');
    if(spk){ ev.preventDefault(); const text = spk.closest('.j-pergunta').querySelector('.pergunta-enunciado')?.textContent||''; speak(text); }
  });

  document.addEventListener('input',ev=>{ if(ev.target.closest('.j-pergunta textarea')) updateProgress(); });

  // (Opcional) Fullscreen para v√≠deos ‚Äî se existir um <video> no documento
  document.addEventListener('click',ev=>{
    const v = ev.target.closest('video'); if(!v) return;
    if(document.fullscreenElement) return; // j√° est√° em FS
    if(v.requestFullscreen){ v.requestFullscreen().catch(()=>{}); }
  }, {capture:true});
})();
</script>
</body>
</html>
