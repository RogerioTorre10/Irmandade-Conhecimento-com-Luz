<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jornada Conhecimento com Luz</title>
  <meta name="description" content="Jornada guiada com estilo pergaminho vertical e horizontal conforme a etapa.">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/styles-base.css" />
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link rel="stylesheet" href="/assets/css/brilho-texturas.css" />
  <link rel="stylesheet" href="/assets/css/j-panel-glow.css" />
  <link rel="stylesheet" href="/assets/css/chama.css" />
  <link rel="stylesheet" href="/assets/css/styles-intro.css" />
  <link rel="stylesheet" href="/assets/css/styles-termos1.css" />
  <link rel="stylesheet" href="/assets/css/styles-termos2.css" />
  <link rel="stylesheet" href="/assets/css/styles-senha.css" />
  <link rel="stylesheet" href="/assets/css/styles-guia.css" />
  <link rel="stylesheet" href="/assets/css/styles-selfie.css" />
  <link rel="stylesheet" href="/assets/css/styles-card.css" />
  <link rel="stylesheet" href="/assets/css/styles-perguntas.css" />
  <link rel="stylesheet" href="/assets/css/styles-final.css" />
  <link rel="stylesheet" href="/assets/css/styles-layout.css" />


  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cardo:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
  <div id="videoOverlay" class="video-overlay" style="display:none;">
  <video id="videoTransicao" playsinline preload="auto" style="max-width:100%;"></video>
</div>

<body> 
  <header class="site-header">
    <div id="chama-header" class="chama-icone" aria-hidden="true">
      <div class="chama-vela chama-lg">
        <div class="brasa"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="brilho"></div>
      </div>
    </div>
    <h1>Jornada Essencial</h1>
  </header> 
  <main class="container">
    <section id="jornada-canvas" class="card pergaminho pergaminho-v">
      <div id="section-conteudo" class="conteudo-pergaminho">
        <div id="aria-pergunta" class="sr-only" aria-live="polite"></div>
        <div id="jornada-content-wrapper"></div>
      </div>
    </section>
    <div id="flame-top-left" class="flame-corner flame-top-left">
      <div class="chama-vela chama-md">
        <div class="brasa"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="brilho"></div>
      </div>
    </div>
    <div id="flame-bottom-right" class="flame-corner flame-bottom-right">
      <div class="chama-vela chama-md">
        <div class="brasa"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="lingua"></div>
        <div class="brilho"></div>
      </div>
    </div>
  </main>
   <footer class="site-footer">
  <small data-i18n="footer.copyright">© 2025 Irmandade Conhecimento com Luz</small>
  <div id="envTag" style="margin-top:2px;opacity:.55;font-size:12px;padding:4px 0;background:transparent;text-align:center;line-height:1.1">
   </div>
</footer>

  <!-- Scripts -->
  <script src="/assets/js/i18n.js" defer></script>
  <script src="/assets/js/config.js" defer></script>
  <script src="/assets/js/toast-safe.js" defer></script>
  <script src="/assets/js/jornada-shims.js" defer></script>
  <script src="/assets/js/jornada-utils.js" defer></script>
  <script src="/assets/js/api.js" defer></script>
  <script src="/assets/js/jornada-core.js" defer></script>
  <script src="/assets/js/jornada-loader.js" defer></script>
  <script src="/assets/js/jornada-render.js" defer></script>
  <script src="/assets/js/jornada-secoes.js" defer></script>
  <script src="/assets/js/jornada-chama.js" defer></script>
  <script src="/assets/js/jornada-auth.js" defer></script>
  <script src="/assets/js/jornada-paper-qa.js" defer></script>
  <script src="/assets/js/j-panel-glow.js" defer></script>
  <script src="/assets/js/jornada-progress-inline.js" defer></script>
  <script src="/assets/js/jornada-typing-font.js" defer></script>
  <script src="/assets/js/jornada-typing-bridge.js" defer></script>
  <script src="/assets/js/jornada-micro.js" defer></script>
  <script src="/assets/js/navigation.js" defer></script>
  <script src="/assets/js/journey.js" defer></script>
  <script src="/assets/js/jornada-controller.js" defer></script>
  <script src="/assets/js/jornada-bootstrap.js" defer></script>
  <script src="/assets/js/video-player.js" defer></script>
  <script src="/assets/js/video-transicao.js" defer></script>
  <script src="/assets/js/section-intro.js" defer></script>
  <script src="/assets/js/section-termos1.js" defer></script>
  <script src="/assets/js/section-termos2.js" defer></script>
  <script src="/assets/js/section-senha.js" defer></script>
  <script src="/assets/js/section-guia.js" defer></script>
  <script src="/assets/js/section-selfie.js" defer></script>
  <script src="/assets/js/section-card.js" defer></script>
  <script src="/assets/js/section-perguntas.js" defer></script>
  <script src="/assets/js/section-final.js" defer></script>
  <script src="/assets/js/main.js" defer></script>

  
  <!-- Inicialização -->
 <script>
  window.addEventListener('load', () => {
    let attempts = 0;
    const maxAttempts = 80;
    const interval = 250;

    const check = () => {
      const ready =
        typeof window.JC?.init === 'function' &&
        typeof window.carregarEtapa === 'function';

      if (ready) {
        try {
          window.JC.init();
          console.log('[Init] JC.init executado');
        } catch (e) {
          console.error('[Init] Erro no JC.init:', e);
        }
        return;
      }

      attempts++;
      if (attempts >= maxAttempts) {
        console.error('[Init] Scripts não ficaram prontos a tempo (JC.init / carregarEtapa)');
        return;
      }

      setTimeout(check, interval);
    };

    check();
  });
</script>


  <noscript>
    <p style="text-align:center; padding:12px">Ative o JavaScript para usar esta página.</p>
  </noscript>

  
<script>
     // Função central de tradução (igual à sua, mas protegida)
    const traduzirTudo = () => {
      if (!window.i18n?.ready) return;
      const wrapper = document.getElementById('jornada-content-wrapper') || document.body;
      window.i18n.apply(wrapper);

      // Atualiza título da página
      const title = window.i18n.t('page.title') || 'Jornada Essencial';
      const site = window.i18n.t('site.title') || 'Irmandade Conhecimento com Luz';
      document.title = `${title} • ${site}`;
    };

    // Verifica se idioma já está travado (não faz nada se estiver)
    const isLocked = () => localStorage.getItem('i18n_locked') === '1';

    // 1. Sincroniza idioma no <html> e título ao carregar (sempre, mas só se não travado)
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await window.i18n?.waitForReady?.(8000).catch(() => {});

        if (!isLocked()) {
          // Só sincroniza seletor se não travado (e se ele existir)
          const langSelect = document.getElementById('language-select');
          if (langSelect) {
            langSelect.value = window.i18n.lang;
            langSelect.disabled = false;
          }
        } else {
          // Se travado, desabilita ou remove o seletor global
          const langSelect = document.getElementById('language-select');
          if (langSelect) {
            langSelect.disabled = true;
            langSelect.style.pointerEvents = 'none';
            langSelect.style.opacity = '0.6';
            // langSelect.remove();  // descomente se quiser remover de vez
          }
        }

        document.documentElement.lang = window.i18n.lang;
        traduzirTudo();
      } catch (err) {
        console.warn('[Global i18n Sync] Erro no load:', err);
      }
    });

    // 2. Listener de mudança NO SELECT (só se NÃO travado e elemento existir)
    document.addEventListener('DOMContentLoaded', () => {
      const langSelect = document.getElementById('language-select');
      if (!langSelect || isLocked()) return;

      langSelect.addEventListener('change', async (e) => {
        const lang = e.target.value;
        if (!lang) return;

        try {
          document.documentElement.lang = lang.split('-')[0];
          await window.i18n.setLang(lang);
          traduzirTudo();
        } catch (err) {
          console.error('[Global Lang Change] Erro:', err);
        }
      });
    });

    // 3. Observer de conteúdo dinâmico (com debounce e verificação de lock)
    let debounceTimer = null;
    const observer = new MutationObserver(() => {
      if (debounceTimer) clearTimeout(debounceTimer);

      debounceTimer = setTimeout(() => {
        if (window.__JC_IS_TYPING) return; // evita traduzir durante typing
        traduzirTudo();
      }, 80);
    });

    // Observa só quando o wrapper existir
    document.addEventListener('DOMContentLoaded', () => {
      const wrapper = document.getElementById('jornada-content-wrapper');
      if (wrapper) {
        observer.observe(wrapper, {
          childList: true,
          subtree: true
        });
      }
    });

    // 4. Reforço no evento section:shown (já existe no controller)
    document.addEventListener('section:shown', () => {
      setTimeout(traduzirTudo, 100);
    });

    // 5. Quando travar idioma (opcional: reforço extra)
    document.addEventListener('i18n:changed', (e) => {
      if (e.detail?.locked) {
        // Remove ou desabilita seletor global
        const sel = document.getElementById('language-select');
        if (sel) {
          sel.remove(); // ou sel.disabled = true; sel.style.display = 'none';
        }
      }
    });
  </script>
</body>
</html>
