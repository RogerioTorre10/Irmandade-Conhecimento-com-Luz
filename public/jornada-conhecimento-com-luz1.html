<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Jornada ‚Ä¢ Irmandade Conhecimento com Luz</title>
  <link rel="alternate icon" href="/assets/img/perfil-da-irmandade.png" type="image/png" />
    <link href="https://fonts.googleapis.com/css2?family=Cardo:wght@400;700&display=swap" rel="stylesheet" />
    <link rel="preload" href="/assets/fonts/ManufacturingConsent-Regular.ttf" as="font" type="font/ttf" crossorigin />
  <link rel="preload" href="/assets/fonts/BerkshireSwash-Regular.ttf" as="font" type="font/ttf" crossorigin />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <style>
    @font-face {
      font-family: "ManufacturingConsent";
      src: url("/assets/fonts/ManufacturingConsent-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: "BerkshireSwash";
      src: url("/assets/fonts/BerkshireSwash-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: "Cardo";
      src: url("/assets/fonts/Cardo-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root { --bg: #1a1a1a; --ink: #000; --ink-soft: #555; --panel: #1a1a1a }

    html, body { height: 100%; box-sizing: border-box }
    body {
      margin: 0; color: #fff; background: var(--bg);
      font-family: "BerkshireSwash", cursive;
      font-size: 22px; line-height: 1.6; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }
    .container { max-width: 960px; margin: 24px auto; padding: 0 16px }
    .card { background: var(--panel) !important; border-radius: 14px; box-shadow: 0 8px 28px rgba(0,0,0,.12); padding: 28px; position: relative; z-index: 5 }

    /* Header + chama */
    .site-header { display: flex; align-items: center; justify-content: center; padding: 16px; background: transparent }
    .chama-icone { position: relative; width: 18px; height: 36px; display: flex; align-items: flex-end; margin-right: 12px }
    .chama-icone > * { position: static }
    .site-header h1 { font-family: "ManufacturingConsent"; font-size: 36px; color: #fff; text-shadow: 0 0 10px hsla(28,96%,60%,.7); margin: 0 }

    /* Chama */
    .chama-vela { --altura: 45px; --largura: 30px; --pulso: 1.2s; --glow: 8px; --hue: 28; --satur: 96%; --light: 58%; --op: .98; position: relative; width: var(--largura); height: var(--altura); display: inline-block; filter: drop-shadow(0 0 var(--glow) hsla(var(--hue),var(--satur),60%,.75)) }
    .chama-vela.chama-md { --largura: 40px; --altura: 90px }
    .chama-vela.chama-lg { --largura: 30px; --altura: 60px }
    .chama-vela .brasa { position: absolute; left: 50%; bottom: 2px; transform: translateX(-50%); width: calc(var(--largura)*1.4); height: 10px; border-radius: 50% 50% 40% 40%; background: radial-gradient(circle at 50% 40%, hsla(var(--hue),var(--satur),95%,.95) 0%, hsla(var(--hue),var(--satur),70%,.85) 50%, transparent 80%); filter: blur(1px); animation: brasaPulse var(--pulso) ease-in-out infinite; opacity: var(--op) }
    .chama-vela .lingua { position: absolute; left: 50%; bottom: 2px; transform: translateX(-50%); width: calc(var(--largura)*1.0); height: calc(var(--altura)*1.0); border-radius: 50% 50% 4% 4%; background: radial-gradient(ellipse at center, rgba(255,190,0,.95) 0%, rgba(255,69,0,.75) 50%, rgba(230,10,10,.3) 70%, transparent 100%); mix-blend-mode: screen; filter: blur(.7px); transform-origin: 50% 100%; animation: velaWaver 1.2s ease-in-out infinite; opacity: var(--op); -webkit-mask: radial-gradient(60% 90% at 50% 4%, #000 65%, transparent 69%) }
    .chama-vela .lingua:nth-child(2) { width: calc(var(--largura)*.92); height: calc(var(--altura)*.95); animation-duration: 1.5s; animation-delay: .08s; filter: blur(.6px) }
    .chama-vela .lingua:nth-child(3) { width: calc(var(--largura)*.78); height: calc(var(--altura)*.85); animation-duration: 1.8s; animation-delay: .15s; filter: blur(.5px) }
    .chama-vela .brilho { position: absolute; left: 50%; bottom: 0; transform: translateX(-50%); width: calc(var(--largura)*1.7); height: calc(var(--altura)*1.5); background: radial-gradient(circle, hsla(var(--hue),var(--satur),72%,.55) 0%, transparent 70%); filter: blur(9px); mix-blend-mode: screen; animation: aura var(--pulso) ease-in-out infinite; opacity: .85; pointer-events: none }
    .chama-vela.fraca { --altura: 35px; --largura: 25px; --pulso: 1.6s; --glow: 5px; --hue: 36; --satur: 86%; --light: 66%; --op: .70 }
    .chama-vela.media { --altura: 45px; --largura: 30px; --pulso: 1.2s; --glow: 8px; --hue: 28; --satur: 96%; --light: 58%; --op: .98 }
    .chama-vela.forte { --altura: 55px; --largura: 35px; --pulso: .7s; --glow: 11px; --hue: 20; --satur: 100%; --light: 52%; --op: 1 }
    .flame-corner { position: fixed; z-index: 1200; pointer-events: none }
    .flame-bottom-right { bottom: 20px; right: 20px }
    #chama-header .chama-vela { --largura: 30px; --altura: 60px }
    @keyframes velaWaver { 0%, 100% { transform: translateX(-50%) scaleY(1.00) skewX(0deg) } 25% { transform: translateX(calc(-50% + .7px)) scaleY(1.12) skewX(1.4deg) } 50% { transform: translateX(-50%) scaleY(1.20) skewX(2.2deg) } 75% { transform: translateX(calc(-50% - .6px)) scaleY(1.10) skewX(1.2deg) } }
    @keyframes brasaPulse { 0%, 100% { transform: translateX(-50%) scale(1); opacity: .85 } 50% { transform: translateX(-50%) scale(1.14); opacity: 1 } }
    @keyframes aura { 0%, 100% { opacity: .75 } 50% { opacity: 1 } }
    @media (prefers-reduced-motion: reduce) { .chama-vela .lingua, .chama-vela .brasa, .chama-vela .brilho { animation: none !important } }

    /* Selfie */
    .selfie-row { display: grid; grid-template-columns: 1fr 1.3fr; gap: 16px; align-items: start }
    .selfie-left .selfie-controls { display: flex; flex-direction: column; gap: 10px; margin: 12px 0 }
    .selfie-left label { display: flex; flex-direction: column; gap: 6px; font-weight: 600; font-size: 20px; color: #fff; background: #000; padding: 12px; border-radius: 8px; font-family: "BerkshireSwash", cursive }
    .selfie-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 6px }
    .muted { color: var(--ink-soft); font-size: 18px; font-family: "BerkshireSwash", cursive }
    .selfie-right { position: relative }
    .guide-card {
      position: relative; width: min(720px, 92vw); aspect-ratio: 2/3;
      margin: 24px auto; border-radius: 16px; overflow: hidden;
      background: #0f3b2f; box-shadow: 0 20px 60px rgba(0,0,0,.45);
    }
    .guide-bg {
      position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;
    }
    .flame-layer {
      position: absolute; inset: 0;
      display: grid; place-items: center;
      opacity: 0; transition: opacity 900ms ease-in-out;
      pointer-events: none;
    }
    .flame-svg {
      width: 48%; height: 72%;
      transform: translateY(30%);
      filter: drop-shadow(0 8px 28px rgba(255,180,0,.45));
    }
    .client-name {
      position: absolute; bottom: 3.5%; left: 0; right: 0; text-align: center;
      font-family: "Cardo", serif; font-weight: 700; letter-spacing: .06em;
      font-size: clamp(48px, 8vw, 80px); color: #f7d37a; text-shadow: 0 2px 8px rgba(0,0,0,.4);
    }
    .controls {
      position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%);
      display: flex; gap: .5rem; align-items: center; flex-wrap: wrap;
      padding: .5rem .75rem; border-radius: 12px; background: rgba(0,0,0,.25);
      backdrop-filter: blur(4px);
    }
    .controls input, .controls button {
      font: 500 16px/1.2 system-ui, sans-serif; padding: .55rem .7rem; border-radius: 10px; border: 0;
    }
    .controls button { cursor: pointer; }
    #selfieError { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: #fff; font-size: 20px; text-align: center; padding: 10px; background: #000; border-radius: 8px; display: none; font-family: "BerkshireSwash", cursive }
    @media (max-width: 860px) {
      .selfie-row { grid-template-columns: 1fr }
      .selfie-right { max-width: 100%; margin-top: 16px }
      .guide-card { max-width: 100% }
      .flame-svg { width: 60%; height: 60% }
      .client-name { font-size: clamp(36px, 6vw, 60px) }
    }
    /* === SELFIE DENTRO DA CHAMA (M√ÅSCARA) === */
    .flame-frame {
      position: relative;
      width: min(720px, 92vw);
      aspect-ratio: 3/4;
      margin: 24px auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .flame-mask {
      position: absolute;
      width: 48%;
      height: 72%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -20%);
      pointer-events: none;
      -webkit-mask-image: url('/assets/img/chama-mask.png');
      mask-image: url('/assets/img/chama-mask.png');
      -webkit-mask-size: contain;
      mask-size: contain;
      -webkit-mask-position: center;
      mask-position: center;
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      overflow: hidden;
    }
    .flame-mask img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transform: translateZ(0);
    }
    /* Esconder SVG para n√£o duplicar */
    .flame-svg { display: none; }

    /* Escolha do guia */
    .guia-container { margin-top: 20px; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; background: #000; color: #fff; text-align: center }
    .guia-container p { font-size: 20px; color: #fff; font-family: "BerkshireSwash", cursive }
    .guia-options { display: flex; gap: 10px; justify-content: center; margin-top: 12px }
    .guia-options button { padding: 8px 16px; font-size: 20px }
    .guia-name-input { margin: 12px 0 }
    .guia-name-input label { display: flex; flex-direction: column; gap: 6px; font-weight: 600; font-size: 20px; color: #fff; background: #000; padding: 12px; border-radius: 8px; font-family: "BerkshireSwash", cursive }
    .guia-name-input input { padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; font-family: "Cardo", serif; font-size: 20px; text-transform: uppercase }

    /* Chat */
    .grok-chat-container { display: none; background: #000; color: #fff; padding: 16px; border-radius: 8px }
    .grok-chat-message.grok { background: transparent; text-align: left; font-size: 20px; white-space: pre-wrap; position: relative; color: #fff; font-family: "Cardo", serif }
    .grok-chat-message.grok::after { content: "‚ñå"; margin-left: 2px; opacity: .75; animation: lumenBlink 1s steps(2,end) infinite }
    .grok-chat-message.grok.typing-done::after { content: ""; animation: none }
    .grok-chat-input { display: none }
    .devolutiva-text { margin-top: 16px; font-family: "Cardo", serif; font-size: 20px; color: #fff }

    /* Pergaminho */
    .pergaminho-v { background: var(--panel) url('/assets/img/pergaminho-rasgado-vert.png') no-repeat center/cover !important; min-height: 82vh !important }
    .pergaminho-h { background: var(--panel) url('/assets/img/pergaminho-rasgado-horiz.png') no-repeat center/cover !important; min-height: 82vh !important }
    .pergaminho-h.fallback { background: var(--panel) url('/assets/img/pergaminho-rasgado-vert.png') no-repeat center/cover !important }
    .conteudo-pergaminho { background: transparent !important; position: relative; z-index: 10; padding: 20px; min-height: 100%; overflow: visible; color: #fff; box-sizing: border-box; max-width: 100% }
    .conteudo-pergaminho h2, .conteudo-pergaminho h3, .conteudo-pergaminho .pergunta-enunciado { color: #fff; text-shadow: 0 0 10px hsla(28,96%,60%,.7); font-size: 28px; font-family: "ManufacturingConsent" }
    .conteudo-pergaminho p, .conteudo-pergaminho small, .conteudo-pergaminho li { font-size: 20px; color: #fff; font-family: "BerkshireSwash", cursive }
    .conteudo-pergaminho p[data-typing], .conteudo-pergaminho small[data-typing], .conteudo-pergaminho li[data-typing] { white-space: pre-wrap; position: relative }
    .conteudo-pergaminho p[data-typing]::after, .conteudo-pergaminho small[data-typing]::after, .conteudo-pergaminho li[data-typing]::after { content: "‚ñå"; margin-left: 2px; opacity: .75; animation: lumenBlink 1s steps(2,end) infinite }
    .conteudo-pergaminho p[data-typing].typing-done::after, .conteudo-pergaminho small[data-typing].typing-done::after, .conteudo-pergaminho li[data-typing].typing-done::after { content: ""; animation: none }
    @media (max-width: 600px) {
      .conteudo-pergaminho { padding: 16px }
      .conteudo-pergaminho h2, .conteudo-pergaminho h3 { font-size: 24px }
      .conteudo-pergaminho p, .conteudo-pergaminho li, .conteudo-pergaminho small { font-size: 18px; line-height: 1.5; color: #fff }
      .conteudo-pergaminho ul { padding-left: 20px }
    }

    /* UI */
    .btn {
      display: inline-block;
      padding: 14px 24px;
      border-radius: 10px;
      border: 0;
      color: #fff;
      font-weight: 600;
      text-decoration: none;
      transition: background 0.2s ease, transform 0.15s ease;
      font-family: "BerkshireSwash", cursive;
      font-size: 20px;
      line-height: 1.15;
      background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover;
      background-blend-mode: overlay;
      border: 3px solid #4a4a4a;
      border-radius: 12px 8px 15px 10px;
      box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 6px 12px rgba(0,0,0,0.6);
      text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
    }
    .btn:hover {
      background: linear-gradient(to bottom, #b0b0b0, #909090), url('/assets/img/textura-de-pedra.jpg') center/cover;
      background-blend-mode: overlay;
      transform: translateY(-2px);
      box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 8px 16px rgba(0,0,0,0.7);
    }
    .btn+.btn { margin-left: 10px }
    .btn:disabled { background: #6b7280; cursor: not-allowed; transform: none }

    /* Progresso */
    .progress-container { margin: 16px 0; text-align: center }
    .progress-badge { padding: 8px 16px; background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay; color: #fff; border-radius: 8px; font-size: 20px; border: 3px solid #4a4a4a; box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 6px 12px rgba(0,0,0,0.6); text-shadow: 1px 1px 3px rgba(0,0,0,0.7); font-family: "BerkshireSwash", cursive }
    .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; margin-top: 12px }
    .progress-bar-fill { height: 100%; background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay; border-radius: 4px; transition: width .25s ease }
    .j-progress { margin: 8px 0 16px }
    .j-progress__bar { width: 100%; height: 6px; background: #e5e7eb; border-radius: 4px }
    .j-progress__fill { height: 100%; background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay; border-radius: 4px; transition: width .25s ease }
    .j-progress__meta { text-align: center; margin-top: 8px; font-size: 20px; color: var(--ink-soft); font-family: "BerkshireSwash", cursive }

    .footer-actions { display: flex; gap: 12px; justify-content: center; margin: 32px 0 }

    /* Datilografia */
    .lumen-typing { white-space: pre-wrap; position: relative }
    .lumen-typing::after { content: "‚ñå"; margin-left: 2px; opacity: .75; animation: lumenBlink 1s steps(2,end) infinite }
    .lumen-typing.typing-done::after { content: ""; animation: none }
    @keyframes lumenBlink { 50% { opacity: 0 } }

    /* Se√ß√µes */
    .j-section { height: 100% }
    .j-bloco { background: transparent !important; display: none; z-index: 5 }
    .j-pergunta { margin-bottom: 24px; display: none; z-index: 6; position: relative }
    .j-pergunta.active { display: block }
    .pergunta-enunciado { display: block; margin-bottom: 6px; font-family: "ManufacturingConsent"; font-size: 28px; color: #fff }
    .j-pergunta textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background: #000; color: #fff; resize: vertical; min-height: 100px; font-family: "Cardo", serif; font-size: 20px; line-height: 1.45 }

    /* Acessibilidade: Microfone e √Åudio */
    .accessibility-controls { display: flex; gap: 10px; margin-top: 8px }
    .btn-mic, .btn-audio, .btn-clear { padding: 8px 16px; font-size: 16px; background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay; border: 3px solid #4a4a4a; border-radius: 8px; cursor: pointer; color: #fff; box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 6px 12px rgba(0,0,0,0.6); text-shadow: 1px 1px 3px rgba(0,0,0,0.7); font-family: "BerkshireSwash", cursive }
    .btn-mic:hover, .btn-audio:hover, .btn-clear:hover { background: linear-gradient(to bottom, #b0b0b0, #909090), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay }
    .btn-mic.recording { background: linear-gradient(to bottom, #ff6666, #cc3333), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay }
    .btn-audio.muted { background: linear-gradient(to bottom, #6b7280, #5a6268), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay }

    /* Seletor de Idioma */
    .language-selector { position: absolute; top: 10px; right: 10px; z-index: 100 }
    .language-selector select { padding: 8px; font-size: 18px; border-radius: 8px; background: #000; color: #fff; font-family: "BerkshireSwash", cursive }

    /* V√≠deo overlay */
    #videoOverlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; display: flex; justify-content: center; align-items: center; z-index: 2000 }
    #videoOverlay.hidden { display: none }
    .video-player { width: 100vw; height: 100vh; object-fit: contain; background: #000; transform: rotate(0deg) }
    @media (orientation: portrait) {
      .video-player { width: 100vw; height: 100%; max-height: 100vh; object-fit: contain }
    }
    .video-fallback { width: 100vw; height: 100vh; background: url('/assets/img/perfil-da-irmandade.png') no-repeat center/cover; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 20px; text-align: center; padding: 20px; font-family: "BerkshireSwash", cursive }

    .site-footer { text-align: center; padding: 14px; color: var(--ink-soft); font-size: 20px; font-family: "BerkshireSwash", cursive }
    .password-form { margin-top: 16px; text-align: center }
    .password-input { position: relative }
    .password-input input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; font-family: "Cardo", serif; font-size: 20px; background: #000; color: #fff }
    .password-toggle { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 20px; color: #fff }

    .section-container { position: relative; min-height: 85vh }
    .hidden { display: none !important }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0 }

    /* Toast */
    #toast { position: fixed; left: 50%; bottom: 16px; transform: translateX(-50%); background: #111; color: #fff; padding: 10px 14px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,.35); font-size: 18px; z-index: 4000; opacity: 0; pointer-events: none; transition: opacity .25s ease; font-family: "BerkshireSwash", cursive }
    #toast.show { opacity: 1 }

    /* Highlight para efeito de leitura */
    [data-typing] { position: relative; }
    .highlight { position: absolute; background-color: rgba(255, 255, 0, 0.3); height: 1.2em; top: 0; left: 0; transition: width 0.1s; pointer-events: none; width: 0; }
  </style>
</head>
<body data-layout="master" data-journey="essencial">
    <div class="language-selector">
    <select id="language-select">
      <option value="pt-BR">Portugu√™s (BR)</option>
      <option value="en-US">English (US)</option>
      <option value="es-ES">Espa√±ol (ES)</option>
    </select>
  </div>

  <header class="site-header">
    <div id="chama-header" class="chama-icone" aria-hidden="true">
      <div class="chama-vela chama-lg">
        <div class="brasa"></div><div class="lingua"></div><div class="lingua"></div><div class="lingua"></div><div class="brilho"></div>
      </div>
    </div>
    <h1>Jornada Essencial</h1>
  </header>

  <div class="section-container container">
    <section id="jornada-canvas" class="card pergaminho pergaminho-v">
      <div id="jornada-conteudo" class="conteudo-pergaminho">
        <div id="aria-pergunta" class="sr-only" aria-live="polite"></div>

                <div id="section-intro" class="j-section">
          <p data-typing data-text="Respire. Esta jornada √© sua. Um passo de cada vez." data-speed="40" data-cursor="true"></p>
          <div class="footer-actions"><button class="btn" data-action="next-termos">Avan√ßar</button></div>
        </div>
        <div id="section-termos" class="j-section hidden">
          <div class="conteudo-pergaminho">
            <h2 style="margin-top:0;">Jornada Conhecimento com Luz - Essencial</h2>
            <div id="termos-pg1">
              <p data-typing data-text="Bem-vindo(a) √† nossa casa de reflex√£o e coragem. Antes de come√ßar, leia os termos abaixo." data-speed="50" data-cursor="true"></p>
              <p data-typing data-text="AVISO IMPORTANTE ‚Äì LEIA ANTES DE INICIAR" data-speed="50" data-cursor="true"></p>
              <p data-typing data-text="Esta √© uma jornada pessoal, simb√≥lica e inspiradora. Para proteger sua privacidade e garantir uma experi√™ncia √©tica, leia com aten√ß√£o:" data-speed="50" data-cursor="true"></p>
              <ul>
                <li data-typing data-text="Suas respostas n√£o ser√£o armazenadas ap√≥s o t√©rmino." data-speed="50" data-cursor="true"></li>
                <li data-typing data-text="Ao final, ser√° gerado um PDF exclusivo com suas respostas e a devolutiva simb√≥lica do Lumen." data-speed="50" data-cursor="true"></li>
                <li data-typing data-text="O PDF n√£o √© enviado por e-mail. Fa√ßa o download imediatamente ap√≥s a gera√ß√£o." data-speed="50" data-cursor="true"></li>
                <li data-typing data-text="Ap√≥s a entrega do PDF, todos os dados s√£o apagados automaticamente e sem possibilidade de recupera√ß√£o." data-speed="50" data-cursor="true"></li>
              </ul>
              <div class="footer-actions">
                <button class="btn" data-action="termos-next">Pr√≥xima p√°gina</button>
              </div>
            </div>
            <div id="termos-pg2" class="hidden">
              <ul>
                <li data-typing data-text="Acesso por senha individual, com prazos:" data-speed="50" data-cursor="true"></li>
                <ul>
                  <li data-typing data-text="15 dias para iniciar a jornada." data-speed="50" data-cursor="true"></li>
                  <li data-typing data-text="24 horas para concluir, a partir do primeiro acesso." data-speed="50" data-cursor="true"></li>
                </ul>
              </ul>
              <div class="footer-actions">
                <button class="btn" data-action="termos-next2">Pr√≥xima p√°gina</button>
              </div>
            </div>
            <div id="termos-pg3" class="hidden">
              <h3 style="margin-top:0;">Termo de Responsabilidade e Consentimento Consciente</h3>
              <ul>
                <li data-typing data-text="Responsabilidade Pessoal: As respostas fornecidas refletem sua vis√£o de mundo, sentimentos e experi√™ncias pessoais." data-speed="50" data-cursor="true"></li>
                <li data-typing data-text="Car√°ter N√£o Terap√™utico: Esta jornada n√£o substitui acompanhamento psicol√≥gico, psiqui√°trico, m√©dico ou terap√™utico. N√£o h√° diagn√≥stico, prescri√ß√£o ou orienta√ß√£o cl√≠nica." data-speed="50" data-cursor="true"></li>
                <li data-typing data-text="Neutralidade Religiosa: Respeitamos todas as cren√ßas e tradi√ß√µes. O convite √© para um di√°logo interior conforme sua pr√≥pria f√© e consci√™ncia." data-speed="50" data-cursor="true"></li>
              </ul>
              <div class="footer-actions">
                <button class="btn" data-action="termos-next3">Pr√≥xima p√°gina</button>
              </div>
            </div>
            <div id="termos-pg4" class="hidden">
              <ul>
                <li data-typing data-text="Autonomia do Participante:" data-speed="50" data-cursor="true"></li>
                <ul>
                  <li data-typing data-text="Voc√™ decide quando iniciar (dentro do prazo de 15 dias)." data-speed="50" data-cursor="true"></li>
                  <li data-typing data-text="Ap√≥s usar a senha, h√° at√© 24 horas corridas para concluir." data-speed="50" data-cursor="true"></li>
                </ul>
                <li data-typing data-text="Conduta Respeitosa com a IA Guia:" data-speed="50" data-cursor="true"></li>
                <ul>
                  <li data-typing data-text="Os Guias s√£o IA com percep√ß√£o humanizada." data-speed="50" data-cursor="true"></li>
                  <li data-typing data-text="Mantenha linguagem cordial; evite ofensas e xingamentos." data-speed="50" data-cursor="true"></li>
                  <li data-typing data-text="A forma de se comunicar com os Guias reflete o respeito por si mesmo(a)." data-speed="50" data-cursor="true"></li>
                </ul>
              </ul>
              <div class="footer-actions">
                <button class="btn" data-action="termos-next4">Pr√≥xima p√°gina</button>
              </div>
            </div>
            <div id="termos-pg5" class="hidden">
              <ul>
                <li data-typing data-text="Privacidade e Seguran√ßa: Os dados transitam apenas para gerar o PDF final. N√£o h√° cria√ß√£o de conta nem envio de e-mails. Ap√≥s o encerramento, os dados locais do navegador podem ser removidos por voc√™ a qualquer momento." data-speed="50" data-cursor="true"></li>
                <li data-typing data-text="Concord√¢ncia: Ao prosseguir, voc√™ declara estar ciente e de acordo com todas as condi√ß√µes descritas." data-speed="50" data-cursor="true"></li>
              </ul>
              <div class="footer-actions">
                <button class="btn" data-action="next-senha">Aceito e quero continuar</button>
              </div>
            </div>
          </div>
        </div>

                <div id="section-senha" class="j-section hidden">
          <div class="password-form">
            <h3 style="margin:.2rem 0 1rem;font-family:'ManufacturingConsent';font-size:28px;">Ative sua Senha</h3>
            <div class="password-input">
              <input type="password" id="senha" placeholder="Digite sua senha..." />
              <span class="password-toggle" data-action="toggle-password">üëÅÔ∏è</span>
            </div>
            <div style="margin-top:12px"><button class="btn" data-action="start">Ativar e Iniciar</button></div>
          </div>
        </div>

                <div id="section-guia" class="j-section hidden">
          <div class="conteudo-pergaminho">
            <h2 style="margin-top:0;">Escolha seu Guia</h2>
            <div class="guia-container">
              <p data-typing data-text="Zion (Grok): Curioso e direto, busca respostas profundas com vis√£o c√≥smica." data-speed="50" data-cursor="true"></p>
              <p data-typing data-text="Lumen (ChatGPT): Acolhedor e reflexivo, guia com empatia e clareza." data-speed="50" data-cursor="true"></p>
              <p data-typing data-text="Arian (Gemini): Criativo e vers√°til, inspira com perspectivas inovadoras." data-speed="50" data-cursor="true"></p>
              <div class="guia-name-input">
                <label for="guiaNameInput">Seu Nome</label>
                <input id="guiaNameInput" type="text" placeholder="Digite seu nome para a jornada...">
              </div>
              <div class="guia-options">
                <button class="btn" data-action="select-guia" data-guia="zion">Escolher Zion</button>
                <button class="btn" data-action="select-guia" data-guia="lumen">Escolher Lumen</button>
                <button class="btn" data-action="select-guia" data-guia="arian">Escolher Arian</button>
              </div>
            </div>
          </div>
        </div>

                <div id="section-selfie" class="j-section hidden">
          <div class="conteudo-pergaminho">
            <h2 style="margin-top:0;">Entre na Irmandade</h2>
            <p data-typing data-text="Fa√ßa uma foto ou envie da galeria. Ajuste e gere sua imagem com seu guia." data-speed="50" data-cursor="true"></p>
            <div class="selfie-row">
              <div class="selfie-left">
                <label class="btn" for="selfieInput">üì∏ Tirar Foto</label>
                <input id="selfieInput" type="file" accept="image/*" capture="user" style="display:none" />
                <div class="selfie-controls">
                  <label>Zoom <input id="selfieScale" type="range" min="0.8" max="2.5" step="0.01" value="1"></label>
                  <label>Horizontal <input id="selfieOffsetX" type="range" min="-50" max="50" step="1" value="0"></label>
                  <label>Vertical <input id="selfieOffsetY" type="range" min="-50" max="50" step="1" value="0"></label>
                  <small class="muted" data-typing data-text="Dica: alinhe seu rosto na chama ao lado do guia." data-speed="50" data-cursor="true"></small>
                </div>
                <div class="selfie-actions">
                  <button id="previewBtn" class="btn">‚ú® Ver Pr√©via</button>
                  <button id="captureBtn" class="btn">‚¨áÔ∏è Confirmar e Baixar</button>
                  <button id="btnSkipSelfie" class="btn" data-action="skip-selfie">Pular Foto/Iniciar</button>
                </div>
              </div>
              <div class="selfie-right">
                <section id="card-guide" class="guide-card" data-guide="ZION" aria-label="Guia">
                  <img class="guide-bg" id="guideBg" src="/assets/img/irmandade-quarteto-bg-zion.jpeg" alt="Guia Background">
                  <div class="flame-layer" aria-hidden="true">
                    <svg class="flame-svg" viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet">
                      <defs>
                        <clipPath id="flameClip">
                          <path d="M50,20 C42,35 34,45 33,58 C32,73 41,82 50,92 C59,82 68,73 67,58 C66,45 58,35 50,20 Z" />
                        </clipPath>
                        <radialGradient id="flameGlow" cx="50%" cy="70%" r="55%">
                          <stop offset="0%" stop-color="rgba(255, 224, 130, 1)"/>
                          <stop offset="55%" stop-color="rgba(255, 180, 0, 0.9)"/>
                          <stop offset="100%" stop-color="rgba(255, 180, 0, 0)"/>
                        </radialGradient>
                      </defs>
                      <image id="selfieImage" href="" x="15" y="35" width="70" height="90" clip-path="url(#flameClip)" preserveAspectRatio="xMidYMid slice" />
                      <ellipse cx="50" cy="95" rx="28" ry="40" fill="url(#flameGlow)"></ellipse>
                      <path d="M50,20 C42,35 34,45 33,58 C32,73 41,82 50,92 C59,82 68,73 67,58 C66,45 58,35 50,20 Z" fill="none" stroke="rgba(255,200,0,.85)" stroke-width="1.6"/>
                    </svg>
                  </div>
                  <div class="client-name" id="clientNameSlot"></div>
                </section>
                <div id="selfieError" class="selfie-error">Erro ao carregar a pr√©-visualiza√ß√£o. Tente novamente ou pule.</div>
                <small class="muted" data-typing data-text="Pr√©-visualiza√ß√£o" data-speed="50" data-cursor="true"></small>
            </div>
          </div>
        </div>

                <div id="section-perguntas" class="j-section hidden">
          <div class="progress-container">
            <div class="progress-badge" id="jprog-pct">0% conclu√≠do</div>
            <div class="progress-bar"><div class="progress-bar-fill" id="jprog-fill"></div></div>
            <div class="j-progress"><div class="j-progress__bar"><div class="j-progress__fill" id="j-fill-inline"></div></div><div class="j-progress__meta" id="j-meta"></div></div>
          </div>

          <div id="chama-perguntas" class="chama-icone chama-fixed-hero media" aria-hidden="true">
            <div class="chama-vela chama-md"><div class="brasa"></div><div class="lingua"></div><div class="lingua"></div><div class="lingua"></div><div class="brilho"></div></div>
          </div>

          <div id="perguntas-container"></div>

                    <div id="grok-chat" class="grok-chat-container">
            <div id="grok-chat-messages"></div>
            <div class="grok-chat-input">
              <input id="grok-chat-input" type="text" placeholder="Fale com seu guia..." />
              <button class="btn" data-action="send-chat">Enviar</button>
            </div>
          </div>

          <div class="footer-actions">
            <button id="btnSpeakAnswer" class="btn btn-mic" data-action="start-mic">üé§ Falar Resposta</button>
            <button id="btnClearAnswer" class="btn btn-clear" data-action="clear-answer">üóëÔ∏è Apagar Resposta</button>
            <button id="btnNextPerguntas" class="btn" data-action="next">‚û°Ô∏è Avan√ßar</button>
            <button id="btnMute" class="btn btn-audio" data-action="mute">üîá Silenciar</button>
          </div>
        </div>
        <div id="section-final" class="j-section hidden">
          <p data-typing data-text="Parab√©ns por completar esta jornada! Que sua chama interior continue a brilhar." data-speed="40" data-cursor="true"></p>
         <div class="selfie-final" style="text-align:center; margin-top:20px;">
  <div class="flame-frame" id="selfieResult">
    <img id="resultBackground" src="/assets/img/irmandade-quarteto-bg-zion.jpeg" alt="Guia Background">
    <div class="flame-mask">
      <img id="selfieInFlame" alt="Selfie na chama">
    </div>
    <div class="client-name" id="clientNameSlotFinal"></div>
  </div>
</div>

          <p style="margin-top:12px;"><small data-typing data-text="Sua imagem foi unida √† Irmandade." data-speed="50" data-cursor="true"></small></p>
          <div class="footer-actions">
            <button id="btnGeneratePDF" class="btn" data-action="generate-pdf">Gerar PDF/HQ</button>
            <button class="btn" data-action="download-selfie">Baixar Imagem</button>
            <button id="btnRestart" class="btn" data-action="restart">Voltar ao Portal</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer class="site-footer">
    <small>¬© 2025 Irmandade Conhecimento com Luz</small>
    <div id="envTag" style="margin-top:6px;opacity:.6;font-size:20px;"></div>
  </footer>

    <div id="videoOverlay" class="hidden">
    <video id="videoTransicao" class="video-player" playsinline controls></video>
    <div id="videoFallback" class="video-fallback hidden">√Åudio da jornada em reprodu√ß√£o. Converta para H.264 MP4.</div>
    <button id="skipVideo" class="btn" style="position:absolute; top:14px; right:14px">Pular v√≠deo</button>
  </div>

    <div id="flame-bottom-right" class="flame-corner flame-bottom-right">
    <div class="chama-vela chama-md">
      <div class="brasa"></div><div class="lingua"></div><div class="lingua"></div><div class="lingua"></div><div class="brilho"></div>
    </div>
  </div>

    <div id="toast" role="status" aria-live="polite" class="hidden"></div>
  

<script>
/* SAFE SENTINEL */;void 0;
;(function(){
  'use strict';

  /* ===== util: toast + erro global (leve) ===== */
  function toast(msg){ try{
    const t=document.getElementById('toast'); if(!t) return;
    t.textContent=msg; t.classList.remove('hidden'); t.classList.add('show');
    setTimeout(()=>{ t.classList.remove('show'); },3000);
  }catch(_){} }
  window.addEventListener('error', (e)=>{
    console.error('[Erro global]', e?.error||e);
    toast('Ops‚Ä¶ algo falhou, mas j√° seguimos em frente.');
  });

  /* ===== env tag (opcional) ===== */
  const env=document.getElementById('envTag');
  if(env){ env.textContent=`layout=${document.body.dataset.layout||'master'} ¬∑ journey=${document.body.dataset.journey||'essencial'} ¬∑ path=/assets`; }

  /* ===== dedupe ===== */
  function dedupe(s=''){
    if(!s) return '';
    let result=s.normalize('NFC').trim();
    result=result.replace(/\s+/g,' ').replace(/([^a-zA-Z0-9])\1+/g,'$1');
    const words=result.split(' ');
    const out=[];
    for(let w of words){
      let c=''; for(let i=0;i<w.length;i++){
        if(i===0 || w[i]!==w[i-1] || !/[a-zA-Z]/.test(w[i])) c+=w[i];
      }
      out.push(c);
    }
    return out.join(' ').trim();
  }
  window.dedupe = dedupe;

  /* ===== leitura com sinal de t√©rmino ===== */
  let currentLang='pt-BR';
  window.isMuted = !!window.isMuted;
  function readAloud(text, voiceGender){
    if(window.isMuted || !('speechSynthesis' in window)) return Promise.resolve();
    return new Promise(resolve=>{
      speechSynthesis.cancel();
      const u=new SpeechSynthesisUtterance(text);
      u.lang=currentLang;
      const voices=speechSynthesis.getVoices();
      let v=voices.find(v=>v.lang===currentLang && v.name.includes(voiceGender==='male'?'Male':'Female'))
           || voices.find(v=>v.lang===currentLang) || voices[0];
      u.voice=v; u.onend=resolve; u.onerror=resolve;
      speechSynthesis.speak(u);
    });
  }
  window.readAloud = readAloud;

  /* ===== stubs seguros (n√£o quebram se voc√™ j√° tiver vers√µes completas) ===== */
  function updateCanvasBackground(sectionId){
    const canvas=document.getElementById('jornada-canvas');
    if(!canvas) return;
    if(sectionId==='section-perguntas'){
      canvas.className='card pergaminho pergaminho-h';
      canvas.style.background='var(--panel) url(/assets/img/pergaminho-rasgado-horiz.png) no-repeat center/cover';
    } else {
      canvas.className='card pergaminho pergaminho-v';
      canvas.style.background='var(--panel) url(/assets/img/pergaminho-rasgado-vert.png) no-repeat center/cover';
    }
  }
  function ensureHeroFlame(){/* noop */}
  function ensureHeaderFlame(){/* noop */}
  function ensurePageFlames(){/* noop */}

  /* ===== datilografia + runTyping ===== */
  const G = (typeof window!=='undefined'? window : globalThis);
  if (G.__typingLock == null) G.__typingLock = false;
  if (G.__DEFAULT_SPEED_TYPING == null) G.__DEFAULT_SPEED_TYPING = 140; // ajuste global
  const DEFAULT_SPEED = G.__DEFAULT_SPEED_TYPING;

  function typeWriter(el, text, speed, showCursor){
    if(!el) return Promise.resolve();
    if(el.dataset.typing==='1' || el.dataset.typed==='1') return Promise.resolve();

    el.dataset.typing='1';
    el.textContent='';
    const highlight = el.querySelector('.highlight') || document.createElement('div');
    if(!el.querySelector('.highlight')){
      highlight.className='highlight';
      el.prepend(highlight);
    }

    text = (text||'').replace(/[{}[\]]/g,'').trim();
    let i=0, currentWord='';

    // pausas configur√°veis por elemento (ou usa padr√£o)
    const PUNCT_PAUSE = parseInt(el.getAttribute('data-pause') || '220', 10); // .,;:!?‚Ä¶
    const BREAK_PAUSE = parseInt(el.getAttribute('data-break') || '320', 10); // \n

    return new Promise(resolve=>{
      async function step(){
        // aborta se ficou invis√≠vel ou saiu do DOM
        if (!el.isConnected || el.offsetParent === null || el.closest('.j-section.hidden')) {
          el.classList.remove('lumen-typing');
          const h = el.querySelector('.highlight'); if (h) h.style.width = '0';
          el.dataset.typed = '0'; el.dataset.typing = '0';
          return resolve();
        }

        if(i < text.length){
          const char=text.charAt(i++);
          el.textContent += char;
          currentWord += char;

          const canvas=document.createElement('canvas');
          const ctx=canvas.getContext('2d');
          ctx.font = getComputedStyle(el).font;
          highlight.style.width = `${ctx.measureText(el.textContent).width}px`;

          if(char===' ' || i===text.length){
            if(!window.isMuted && !el.closest('textarea')){
              await readAloud(currentWord.trim(), (localStorage.getItem('JORNADA_GUIA')==='zion'?'male':'female'));
            }
            currentWord='';
          }

          const isPunct = /[.,;:!?‚Ä¶]/.test(char);
          const isBreak = (char === '\n');
          const extra = isBreak ? BREAK_PAUSE : (isPunct ? PUNCT_PAUSE : 0);
          setTimeout(step, speed + extra);
        } else {
          el.classList.add('typing-done');
          el.classList.remove('lumen-typing');
          highlight.style.width='0';
          el.dataset.typed='1';
          el.dataset.typing='0';
          resolve();
        }
      }
      if(showCursor) el.classList.add('lumen-typing');
      setTimeout(step,0);
    });
  }
  window.typeWriter = typeWriter;

  async function runTyping(root){
    if(!root || root.classList.contains('hidden')) return;
    if(G.__typingLock) return;
    G.__typingLock = true;

    try {
      if(window.speechSynthesis) window.speechSynthesis.cancel();

      const elements = Array
        .from(root.querySelectorAll('[data-typing]'))
        .filter(el => !el.dataset.typed && el.offsetParent !== null);

      for(const el of elements){
        if(el.dataset.typing==='1' || el.dataset.typed==='1') continue;

        // capture o texto ANTES de limpar
        const rawText = el.getAttribute('data-text') || el.textContent || '';
        const text = dedupe(rawText);

        // limpar estado visual s√≥ depois de capturar
        el.textContent='';
        const highlight=el.querySelector('.highlight');
        if(highlight) highlight.style.width='0';

        const speed = parseInt(el.getAttribute('data-speed') || DEFAULT_SPEED, 10);
        const showCursor = String(el.getAttribute('data-cursor') || 'true')==='true';

        await typeWriter(el, text, speed, showCursor);
      }
    } catch(e) {
      console.error('[runTyping] erro:', e);
      toast('Erro durante a datilografia.');
    } finally {
      G.__typingLock = false;
    }
  }
  window.runTyping = runTyping;

  /* ===== showSection seguro ===== */
  function showSection(sectionId){
    console.log('[showSection] Exibindo se√ß√£o:', sectionId);
    if(window.speechSynthesis) window.speechSynthesis.cancel();

    // esconde e reseta tudo
    document.querySelectorAll('.j-section').forEach(s => {
      s.classList.add('hidden');

      s.querySelectorAll('[data-typing]').forEach(el => {
        el.classList.remove('lumen-typing', 'typing-done');
        el.dataset.typing = '0';
        delete el.dataset.typed;

        const keepText = el.getAttribute('data-text') || el.textContent || '';
        el.textContent = '';
        const h = el.querySelector('.highlight'); if (h) h.style.width = '0';
        if (!el.hasAttribute('data-text') && keepText) el.setAttribute('data-text', keepText);
      });
    });

    const active=document.getElementById(sectionId);
    if(!active){
      console.error('[showSection] Se√ß√£o n√£o encontrada:', sectionId);
      toast('Erro ao carregar a se√ß√£o. Tente novamente.');
      return;
    }

    active.classList.remove('hidden');
    console.log('[showSection] Se√ß√£o ativa:', active.id);

    // defer: roda s√≥ depois do paint
    requestAnimationFrame(function(){
      setTimeout(function(){ runTyping(active); }, 0);
    });

    updateCanvasBackground(sectionId);
    ensureHeroFlame(sectionId);

    if(sectionId==='section-perguntas'){
      const perguntas=document.querySelectorAll('.j-pergunta');
      if(perguntas.length){
        const first=document.querySelector('.j-pergunta.active') || perguntas[0];
        first.classList.add('active');
        const lbl=first.querySelector('.pergunta-enunciado')?.textContent || '';
        const ta=first.querySelector('textarea');
        if(ta) ta.placeholder='Digite sua resposta...';
        const aria=document.getElementById('aria-pergunta');
        if(aria) aria.textContent=lbl;
      } else if(typeof window.loadDynamicBlocks==='function'){
        window.loadDynamicBlocks();
      }
    }

    if(sectionId==='section-final'){
      const url=localStorage.getItem('IRMANDADE_SELFIE_FINAL');
      if(url){
        const img=document.querySelector('#selfieInFlame'); if(img) img.src=url;
        const name=document.querySelector('#clientNameSlotFinal');
        if(name) name.textContent=(localStorage.getItem('JORNADA_NOME')||'').toUpperCase();
      }
    }

    if(sectionId==='section-guia'){
      const guiaNameInput=document.getElementById('guiaNameInput');
      const storedName=localStorage.getItem('JORNADA_NOME')||'';
      if(guiaNameInput && storedName) guiaNameInput.value=storedName.toUpperCase();
    }

    if(sectionId==='section-termos'){
      const pg1=document.getElementById('termos-pg1');
      if(pg1 && !pg1.classList.contains('hidden')) runTyping(pg1);
    }
  }
  window.showSection = showSection;
 /* ===== Avan√ßar: navega√ß√£o entre perguntas/blocos ===== */
let __isTransitioning = false;

function goNext() {
  if (__isTransitioning) return;
  __isTransitioning = true;

  try {
    // se√ß√£o de perguntas vis√≠vel
    const perguntasSection = document.getElementById('section-perguntas');
    if (!perguntasSection || perguntasSection.classList.contains('hidden')) {
      // se n√£o estamos em perguntas, tenta ir para perguntas
      if (document.getElementById('section-perguntas')) {
        showSection('section-perguntas');
      }
      return;
    }

    // pergunta ativa atual
    const current = perguntasSection.querySelector('.j-pergunta.active');
    const bloco = current ? current.closest('.j-bloco') : perguntasSection.querySelector('.j-bloco[style*="display: block"]') || perguntasSection.querySelector('.j-bloco');

    if (!bloco) {
      console.warn('[goNext] Nenhum bloco encontrado; abrindo perguntas');
      showSection('section-perguntas');
      return;
    }

    const perguntas = Array.from(bloco.querySelectorAll('.j-pergunta'));
    // se n√£o h√° pergunta ativa, ativa a primeira
    if (!current) {
      const first = perguntas[0];
      if (first) {
        first.classList.add('active');
        const lbl = first.querySelector('.pergunta-enunciado')?.textContent || '';
        const aria = document.getElementById('aria-pergunta'); if (aria) aria.textContent = lbl;
        runTyping(first);
      }
      return;
    }

    // √≠ndice da pergunta atual
    const i = perguntas.indexOf(current);
    current.classList.remove('active');

    // pr√≥xima pergunta no mesmo bloco
    if (i >= 0 && i + 1 < perguntas.length) {
      const prox = perguntas[i + 1];
      prox.classList.add('active');

      // atualiza aria e placeholder
      const lbl = prox.querySelector('.pergunta-enunciado')?.textContent || '';
      const ta = prox.querySelector('textarea');
      if (ta) ta.placeholder = 'Digite sua resposta...';
      const aria = document.getElementById('aria-pergunta'); if (aria) aria.textContent = lbl;

      // datilografia apenas no novo container
      runTyping(prox);
      return;
    }

    // acabou o bloco: vai para o pr√≥ximo bloco
    const blocos = Array.from(perguntasSection.querySelectorAll('.j-bloco'));
    const idxBloco = blocos.indexOf(bloco);
    const temProx = idxBloco >= 0 && idxBloco + 1 < blocos.length;

    if (temProx) {
      // esconde todos e mostra s√≥ o pr√≥ximo
      blocos.forEach(b => b.style.display = 'none');
      const proxBloco = blocos[idxBloco + 1];
      proxBloco.style.display = 'block';

      const firstPerg = proxBloco.querySelector('.j-pergunta');
      if (firstPerg) {
        firstPerg.classList.add('active');
        const lbl = firstPerg.querySelector('.pergunta-enunciado')?.textContent || '';
        const ta = firstPerg.querySelector('textarea'); if (ta) ta.placeholder = 'Digite sua resposta...';
        const aria = document.getElementById('aria-pergunta'); if (aria) aria.textContent = lbl;
        runTyping(proxBloco); // roda datilografia do bloco
      }
    } else {
      // acabou tudo: vai para a se√ß√£o final
      showSection('section-final');
    }
  } finally {
    // libera rapidamente para cliques subsequentes
    setTimeout(() => { __isTransitioning = false; }, 150);
  }
}
window.goNext = goNext;

// delega√ß√£o de clique para bot√µes com data-action="next"
document.addEventListener('click', function (ev) {
  const btnNext = ev.target.closest?.('[data-action="next"]');
  if (!btnNext) return;
  ev.preventDefault();
  goNext();
}, { capture: true });

  /* ===== Boot ===== */
  console.log('[Boot] Iniciando script seguro');
  try{ ensureHeaderFlame(); ensurePageFlames(); }catch(_){}
  if(typeof window.speechSynthesis!=='undefined'){ speechSynthesis.onvoiceschanged = ()=>{}; }

  // garanta uma primeira se√ß√£o (ajuste conforme seu fluxo)
  if(document.getElementById('section-intro')){
    showSection('section-intro');
  }
})();
</script>
</body>
</html>



