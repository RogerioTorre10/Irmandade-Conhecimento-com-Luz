<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Jornada • Irmandade Conhecimento com Luz</title>
  <link rel="icon" href="/assets/img/perfil-da-irmandade.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <script src="https://unpkg.com/typewriter-effect@latest/dist/core.js"></script>
    
  <script type="module" src="/assets/js/i18n.js?v=6" onload="console.log('[LOAD] i18n.js carregado')" onerror="console.error('[LOAD] Erro ao carregar i18n.js')"></script>
  <script defer src="/assets/js/config.js?v=6" onload="console.log('[LOAD] config.js carregado')" onerror="console.error('[LOAD] Erro ao carregar config.js')"></script>
  <script defer src="/assets/js/jornada-utils.js?v=6" onload="console.log('[LOAD] jornada-utils.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-utils.js')"></script>
  <script defer src="/assets/js/jornada-core.js?v=6" onload="console.log('[LOAD] jornada-core.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-core.js')"></script>
  <script type="module" src="/assets/js/jornada-typing.js?v=6" onload="console.log('[LOAD] jornada-typing.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-typing.js')"></script>
  <script type="module" src="/assets/js/jornada-typing-bridge.js?v=1" onload="console.log('[LOAD] jornada-typing-bridge.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-typing-bridge.js')"></script>
  <script type="module" src="/assets/js/jornada-controller.js?v=6" onload="console.log('[LOAD] jornada-controller.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-controller.js')"></script>
  <script type="module" src="/assets/js/jornada-bootstrap.js?v=6" onload="console.log('[LOAD] jornada-bootstrap.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-bootstrap.js')"></script>
  <script type="module" src="/assets/js/jornada-paper-qa.js?v=6" onload="console.log('[LOAD] jornada-paper-qa.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-paper-qa.js')"></script>
  <script defer src="/assets/js/toast-safe.js?v=6" onload="console.log('[LOAD] toast-safe.js carregado')" onerror="console.error('[LOAD] Erro ao carregar toast-safe.js')"></script>
  <script defer src="/assets/js/jornada-shims.js?v=6" onload="console.log('[LOAD] jornada-shims.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-shims.js')"></script>
  <script defer src="/assets/js/jornada-chama.js?v=6" onload="console.log('[LOAD] jornada-chama.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-chama.js')"></script>
  <script defer src="/assets/js/jornada-auth.js?v=6" onload="console.log('[LOAD] jornada-auth.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-auth.js')"></script>
  <script defer src="/assets/js/jornada-render.js?v=6" onload="console.log('[LOAD] jornada-render.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-render.js')"></script>
  <script defer src="/assets/js/jornada-micro.js?v=6" onload="console.log('[LOAD] jornada-micro.js carregado')" onerror="console.error('[LOAD] Erro ao carregar jornada-micro.js')"></script>
  <script defer src="/assets/js/api.js?v=6" onload="console.log('[LOAD] api.js carregado')" onerror="console.error('[LOAD] Erro ao carregar api.js')"></script>

  <style>
    @font-face {
      font-family: "ManufacturingConsent";
      src: url("/assets/fonts/ManufacturingConsent-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: "BerkshireSwash";
      src: url("/assets/fonts/BerkshireSwash-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: "Cardo";
      src: url("/assets/fonts/Cardo-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root { --bg:#1a1a1a; --ink:#000; --ink-soft:#555; --panel:#1a1a1a }

    html,body{height:100%;box-sizing:border-box}
    body{
      margin:0;color:#fff;background:var(--bg);
      font-family:"ManufacturingConsent",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      font-size:20px;line-height:1.6;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility
    }
    .container{max-width:960px;margin:24px auto;padding:0 16px}
    .card{background:var(--panel)!important;border-radius:14px;box-shadow:0 8px 28px rgba(0,0,0,.12);padding:28px;position:relative;z-index:5}

    /* Header + chama */
    .site-header{display:flex;align-items:center;justify-content:center;padding:16px;background:transparent}
    .chama-icone{position:relative;width:18px;height:36px;display:flex;align-items:flex-end;margin-right:12px}
    .chama-icone>*{position:static}
    .site-header h1{font-family:"Berkshire Swash",cursive;font-size:32px;color:#fff;text-shadow:0 0 10px hsla(28,96%,60%,.7);margin:0}

    /* Chama */
    .chama-vela{--altura:45px;--largura:30px;--pulso:1.2s;--glow:8px;--hue:28;--satur:96%;--light:58%;--op:.98;position:relative;width:var(--largura);height:var(--altura);display:inline-block;filter:drop-shadow(0 0 var(--glow) hsla(var(--hue),var(--satur),60%,.75))}
    .chama-vela.chama-md{--largura:40px;--altura:90px}
    .chama-vela.chama-lg{--largura:30px;--altura:60px}
    .chama-vela .brasa{position:absolute;left:50%;bottom:2px;transform:translateX(-50%);width:calc(var(--largura)*1.4);height:10px;border-radius:50% 50% 40% 40%;background:radial-gradient(circle at 50% 40%,hsla(var(--hue),var(--satur),95%,.95) 0%,hsla(var(--hue),var(--satur),70%,.85) 50%,transparent 80%);filter:blur(1px);animation:brasaPulse var(--pulso) ease-in-out infinite;opacity:var(--op)}
    .chama-vela .lingua{position:absolute;left:50%;bottom:2px;transform:translateX(-50%);width:calc(var(--largura)*1.0);height:calc(var(--altura)*1.0);border-radius:50% 50% 4% 4%;background:radial-gradient(ellipse at center,rgba(255,190,0,.95) 0%,rgba(255,69,0,.75) 50%,rgba(230,10,10,.3) 70%,transparent 100%);mix-blend-mode:screen;filter:blur(.7px);transform-origin:50% 100%;animation:velaWaver 1.2s ease-in-out infinite;opacity:var(--op);-webkit-mask:radial-gradient(60% 90% at 50% 4%,#000 65%,transparent 69%)}
    .chama-vela .lingua:nth-child(2){width:calc(var(--largura)*.92);height:calc(var(--altura)*.95);animation-duration:1.5s;animation-delay:.08s;filter:blur(.6px)}
    .chama-vela .lingua:nth-child(3){width:calc(var(--largura)*.78);height:calc(var(--altura)*.85);animation-duration:1.8s;animation-delay:.15s;filter:blur(.5px)}
    .chama-vela .brilho{position:absolute;left:50%;bottom:0;transform:translateX(-50%);width:calc(var(--largura)*1.7);height:calc(var(--altura)*1.5);background:radial-gradient(circle,hsla(var(--hue),var(--satur),72%,.55) 0%,transparent 70%);filter:blur(9px);mix-blend-mode:screen;animation:aura var(--pulso) ease-in-out infinite;opacity:.85;pointer-events:none}
    .chama-vela.fraca{--altura:35px;--largura:25px;--pulso:1.6s;--glow:5px;--hue:36;--satur:86%;--light:66%;--op:.70}
    .chama-vela.media{--altura:45px;--largura:30px;--pulso:1.2s;--glow:8px;--hue:28;--satur:96%;--light:58%;--op:.98}
    .chama-vela.forte{--altura:55px;--largura:35px;--pulso:.7s;--glow:11px;--hue:20;--satur:100%;--light:52%;--op:1}
    .flame-corner{position:fixed;z-index:1200;pointer-events:none}
    .flame-bottom-right{bottom:20px;right:20px}
    #chama-header .chama-vela{--largura:30px;--altura:60px}
    @keyframes velaWaver{0%,100%{transform:translateX(-50%) scaleY(1.00) skewX(0deg)}25%{transform:translateX(calc(-50% + .7px)) scaleY(1.12) skewX(1.4deg)}50%{transform:translateX(-50%) scaleY(1.20) skewX(2.2deg)}75%{transform:translateX(calc(-50% - .6px)) scaleY(1.10) skewX(1.2deg)}}
    @keyframes brasaPulse{0%,100%{transform:translateX(-50%) scale(1);opacity:.85}50%{transform:translateX(-50%) scale(1.14);opacity:1}}
    @keyframes aura{0%,100%{opacity:.75}50%{opacity:1}}
    @media (prefers-reduced-motion: reduce){.chama-vela .lingua,.chama-vela .brasa,.chama-vela .brilho{animation:none!important}}

    /* Selfie */
    .selfie-row{display:grid;grid-template-columns:1fr 1.3fr;gap:16px;align-items:start}
    .selfie-left .selfie-controls{display:flex;flex-direction:column;gap:10px;margin:12px 0}
    .selfie-left label{display:flex;flex-direction:column;gap:6px;font-weight:600;font-size:18px}
    .selfie-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    .muted{color:var(--ink-soft);font-size:16px}
    .selfie-right{position:relative}
    .guide-card{position:relative;width:100%;max-width:600px;margin:0 auto}
    .guide-bg{width:100%;height:auto;border-radius:12px}
    .flame-layer{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;transition:opacity 0.5s}
    .flame-svg{position:absolute;top:40%;left:50%;width:40%;height:60%;transform:translate(-50%,-6%)}
    .guide-name{position:absolute;top:2%;left:50%;transform:translateX(-50%);color:#f7d37a;font-family:"Cardo",serif;font-size:2.5rem;font-weight:bold;text-align:center}
    .user-name{position:absolute;bottom:2%;left:50%;transform:translateX(-50%);color:#f7d37a;font-family:"Cardo",serif;font-size:2rem;font-weight:bold;text-align:center}
    .controls{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    #selfieError{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:18px;text-align:center;padding:10px;background:rgba(0,0,0,0.7);border-radius:8px;display:none}
    @media (max-width:860px){
      .selfie-row{grid-template-columns:1fr}
      .selfie-right{max-width:100%;margin-top:16px}
      .guide-card{max-width:100%}
      .flame-svg{top:40%;width:50%;height:50%}
      .guide-name{font-size:1.8rem}
      .user-name{font-size:1.5rem}
    }

    /* Escolha do guia */
    .guia-container{margin-top:20px;padding:10px;border:1px solid #d1d5db;border-radius:8px;background:var(--panel);text-align:center}
    .guia-container p{font-size:18px}
    .guia-options{display:flex;gap:10px;justify-content:center;margin-top:12px}
    .guia-options button{padding:8px 16px;font-size:18px}

    /* Chat */
    .grok-chat-container{display:none}
    .grok-chat-message.grok{background:transparent;text-align:left;font-size:18px;white-space:pre-wrap;position:relative}
    .grok-chat-message.grok::after{content:"▌";margin-left:2px;opacity:.75;animation:lumenBlink 1s steps(2,end) infinite}
    .grok-chat-message.grok.typing-done::after{content:"";animation:none}
    .grok-chat-input{display:none}

    /* Pergaminho */
    .pergaminho-v{background:var(--panel) url('/assets/img/pergaminho-rasgado-vert.png') no-repeat center/cover!important;min-height:82vh!important}
    .pergaminho-h{background:var(--panel) url('/assets/img/pergaminho-rasgado-horiz.png') no-repeat center/cover!important;min-height:82vh!important}
    .pergaminho-h.fallback{background:var(--panel) url('/assets/img/pergaminho-rasgado-vert.png') no-repeat center/cover!important}
    .conteudo-pergaminho{background:transparent!important;position:relative;z-index:10;padding:20px;min-height:100%;overflow:visible;color:#fff;box-sizing:border-box;max-width:100%}
    .conteudo-pergaminho h2,.conteudo-pergaminho h3,.conteudo-pergaminho .pergunta-enunciado{color:#fff;text-shadow:0 0 10px hsla(28,96%,60%,.7);font-size:24px}
    .conteudo-pergaminho p,.conteudo-pergaminho small{font-size:18px}
    @media (max-width:600px){
      .conteudo-pergaminho{padding:16px}
      .conteudo-pergaminho h2,.conteudo-pergaminho h3{font-size:20px}
      .conteudo-pergaminho p,.conteudo-pergaminho li,.conteudo-pergaminho small{font-size:16px;line-height:1.5}
      .conteudo-pergaminho ul{padding-left:20px}
    }

    /* UI */
    .btn {
      display: inline-block;
      padding: 12px 22px;
      border-radius: 10px;
      border: 0;
      color: #fff;
      font-weight: 600;
      text-decoration: none;
      transition: background 0.2s ease, transform 0.15s ease;
      font-family: "Berkshire Swash", cursive;
      font-size: 18px;
      line-height: 1.15;
      background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover;
      background-blend-mode: overlay;
      border: 3px solid #4a4a4a;
      border-radius: 12px 8px 15px 10px;
      box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 6px 12px rgba(0,0,0,0.6);
      text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
      padding: 14px 26px;
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
    }
    .btn:hover {
      background: linear-gradient(to bottom, #b0b0b0, #909090), url('/assets/img/textura-de-pedra.jpg') center/cover;
      background-blend-mode: overlay;
      transform: translateY(-2px);
      box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 8px 16px rgba(0,0,0,0.7);
    }
    .btn+.btn{margin-left:10px}
    .btn:disabled{background:#6b7280;cursor:not-allowed;transform:none}

    /* Progresso */
    .progress-container{margin:16px 0;text-align:center}
    .progress-badge{padding:8px 16px;background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover;background-blend-mode: overlay;color:#fff;border-radius:8px;font-size:18px;border: 3px solid #4a4a4a;box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 6px 12px rgba(0,0,0,0.6);text-shadow: 1px 1px 3px rgba(0,0,0,0.7)}
    .progress-bar{width:100%;height:8px;background:#e5e7eb;border-radius:4px;margin-top:12px}
    .progress-bar-fill{height:100%;background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover;background-blend-mode: overlay;border-radius:4px;transition:width .25s ease}
    .j-progress{margin:8px 0 16px}
    .j-progress__bar{width:100%;height:6px;background:#e5e7eb;border-radius:4px}
    .j-progress__fill{height:100%;background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover;background-blend-mode: overlay;border-radius:4px;transition:width .25s ease}
    .j-progress__meta{text-align:center;margin-top:8px;font-size:18px;color:var(--ink-soft)}

    .footer-actions{display:flex;gap:12px;justify-content:center;margin:18px 0}

    /* Datilografia */
    .lumen-typing{white-space:pre-wrap;position:relative}
    .lumen-typing::after{content:"▌";margin-left:2px;opacity:.75;animation:lumenBlink 1s steps(2,end) infinite}
    .lumen-typing.typing-done::after{content:"";animation:none}
    @keyframes lumenBlink{50%{opacity:0}}

    /* Seções */
    .j-section{display:none}
    .j-section:not(.hidden){display:block}
    .j-bloco{background:transparent!important;display:none;z-index:5}
    .j-pergunta{margin-bottom:24px;display:none;z-index:6;position:relative}
    .j-pergunta.active{display:block}
    .pergunta-enunciado{display:block;margin-bottom:6px;font-family:"Berkshire Swash",cursive;font-size:22px;color:#fff}
    .j-pergunta textarea{width:100%;padding:12px;border-radius:8px;border:1px solid #d1d5db;background:rgba(255,255,255,.85);resize:vertical;min-height:100px;font-family:"Cardo",serif;font-size:18px;line-height:1.45}

    /* Acessibilidade: Microfone e Áudio */
    .accessibility-controls { display: flex; gap: 10px; margin-top: 8px; }
    .btn-mic, .btn-audio { padding: 8px 16px; font-size: 16px; background: linear-gradient(to bottom, #a0a0a0, #808080), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay; border: 3px solid #4a4a4a; border-radius: 8px; cursor: pointer; color: #fff; box-shadow: inset 0 3px 6px rgba(0,0,0,0.4), 0 6px 12px rgba(0,0,0,0.6); text-shadow: 1px 1px 3px rgba(0,0,0,0.7); }
    .btn-mic:hover, .btn-audio:hover { background: linear-gradient(to bottom, #b0b0b0, #909090), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay; }
    .btn-mic.recording { background: linear-gradient(to bottom, #ff6666, #cc3333), url('/assets/img/textura-de-pedra.jpg') center/cover; background-blend-mode: overlay; }

    /* Seletor de Idioma */
    .language-selector { position: absolute; top: 10px; right: 10px; z-index: 100; }
    .language-selector select { padding: 8px; font-size: 16px; border-radius: 8px; }

    /* Vídeo overlay */
    #videoOverlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.95);display:flex;justify-content:center;align-items:center;z-index:2000}
    #videoOverlay.hidden{display:none}
    .video-player{width:100vw;height:100vh;object-fit:contain;background:#000;transform:rotate(0deg)}
    @media (orientation: portrait){
      .video-player{width:100vw;height:100%;max-height:100vh;object-fit:contain}
    }
    .video-fallback{width:100vw;height:100vh;background:url('/assets/img/perfil-da-irmandade.png') center/cover no-repeat;display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px;text-align:center;padding:20px;font-family:"Berkshire Swash",cursive}

    .site-footer{text-align:center;padding:14px;color:var(--ink-soft);font-size:18px}
    .password-form{margin-top:16px;text-align:center}
    .password-input{position:relative}
    .password-input input{width:100%;padding:12px;border-radius:8px;border:1px solid #d1d5db;font-family:"Cardo",serif;font-size:18px}
    .password-toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:18px}

    .section-container{position:relative;min-height:85vh}
    .hidden{display:none!important}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* Toast */
    #toast{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.35);font-size:16px;z-index:4000;opacity:0;pointer-events:none;transition:opacity .25s ease}
    #toast.show{opacity:1}
  </style>
</head>

<body data-layout="master" data-journey="essencial">
  <!-- Seletor de Idioma -->
  <div class="language-selector">
    <select id="language-select">
      <option value="pt-BR">Português (BR)</option>
      <option value="en-US">English (US)</option>
      <option value="es-ES">Español (ES)</option>
    </select>
  </div>

  <header class="site-header">
    <div id="chama-header" class="chama-icone" aria-hidden="true">
      <div class="chama-vela chama-lg">
        <div class="brasa"></div><div class="lingua"></div><div class="lingua"></div><div class="lingua"></div><div class="brilho"></div>
      </div>
    </div>
    <h1>Jornada Essencial</h1>
  </header>

  <div class="section-container container">
    <section id="jornada-canvas" class="card pergaminho pergaminho-v">
      <div id="jornada-conteudo" class="conteudo-pergaminho">
        <div id="aria-pergunta" class="sr-only" aria-live="polite"></div>

        <!-- INTRO -->
        <div id="section-intro" class="j-section">
          <p data-typing="true" data-text="Respire. Esta jornada é sua. Um passo de cada vez." data-speed="40" data-cursor="true"></p>
          <p data-typing="true" data-text="Bem-vindo(a) à nossa casa de reflexão e coragem. Antes de começar, leia os termos abaixo." data-speed="50" data-cursor="true"></p>
          <div class="footer-actions"><button class="btn btn-avancar" data-action="avancar">Avançar</button></div>
        </div>

        <!-- TERMOS -->
        <div id="section-termos" class="j-section hidden">
          <div class="conteudo-pergaminho">
            <h2 style="margin-top:0;" data-typing="true" data-text="Jornada Conhecimento com Luz - Essencial " data-speed="40" data-cursor="true"></h2>
            <div id="termos-pg1">
              <p data-typing="true" data-text="AVISO IMPORTANTE – LEIA ANTES DE INICIAR" data-speed="40" data-cursor="true"></p>
              <p data-typing="true" data-text="Esta é uma jornada pessoal, simbólica e inspiradora. Para proteger sua privacidade e garantir uma experiência ética, leia com atenção:" data-speed="40" data-cursor="true"></p>
              <ul>
                <li data-typing="true" data-text="Suas respostas não serão armazenadas após o término." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="Ao final, será gerado um PDF exclusivo com suas respostas e a devolutiva simbólica do Guia I A." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="O PDF não é enviado por e-mail. Faça o download imediatamente após a geração." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="Após a entrega do PDF, todos os dados são apagados automaticamente e sem possibilidade de recuperação." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="Acesso por senha individual, com prazos:" data-speed="40" data-cursor="true"></li>
                <ul>
                  <li data-typing="true" data-text="15 dias para iniciar a jornada." data-speed="40" data-cursor="true"></li>
                  <li data-typing="true" data-text="24 horas para concluir, a partir do primeiro acesso." data-speed="40" data-cursor="true"></li>
                </ul>
              </ul>
              <div class="footer-actions">
                <button class="btn" data-action="termos-next">Próxima página</button>
              </div>
            </div>
            <div id="termos-pg2" class="hidden">
              <h3 style="margin-top:0;" data-typing="true" data-text="Termo de Responsabilidade e Consentimento Consciente" data-speed="40" data-cursor="true"></h3>
              <ul>
                <li data-typing="true" data-text="Responsabilidade Pessoal: As respostas fornecidas refletem sua visão de mundo, sentimentos e experiências pessoais." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="Caráter Não Terapêutico: Esta jornada não substitui acompanhamento psicológico, psiquiátrico, médico ou terapêutico. Não há diagnóstico, prescrição ou orientação clínica." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="Neutralidade Religiosa: Respeitamos todas as crenças e tradições. O convite é para um diálogo interior conforme sua própria fé e consciência." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="Autonomia do Participante:" data-speed="40" data-cursor="true">
                  <ul>
                    <li data-typing="true" data-text="Você decide quando iniciar (dentro do prazo de 15 dias)." data-speed="40" data-cursor="true"></li>
                    <li data-typing="true" data-text="Após usar a senha, há até 24 horas corridas para concluir." data-speed="40" data-cursor="true"></li>
                  </ul>
                </li>
                <li data-typing="true" data-text="Conduta Respeitosa com o Guia I A:" data-speed="40" data-cursor="true">
                  <ul>
                    <li data-typing="true" data-text="O Guia é uma Inteligêmçia Artificial com percepção humanizada." data-speed="40" data-cursor="true"></li>
                    <li data-typing="true" data-text="Mantenha linguagem cordial; evite ofensas e xingamentos." data-speed="40" data-cursor="true"></li>
                    <li data-typing="true" data-text="A forma de se comunicar com o Guia I A reflete o respeito por si mesmo(a)." data-speed="40" data-cursor="true"></li>
                  </ul>
                </li>
                <li data-typing="true" data-text="Privacidade e Segurança: Os dados transitam apenas para gerar o PDF final. Não há criação de conta nem envio de e-mails. Após o encerramento, os dados locais do navegador podem ser removidos por você a qualquer momento." data-speed="40" data-cursor="true"></li>
                <li data-typing="true" data-text="Concordância: Ao prosseguir, você declara estar ciente e de acordo com todas as condições descritas." data-speed="40" data-cursor="true"></li>
              </ul>
              <div class="footer-actions">
                <button class="btn" data-action="termos-prev">Voltar</button>
                <button class="btn btn-avancar" data-action="avancar">Aceito e quero continuar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- SENHA -->
        <div id="section-senha" class="j-section hidden">
          <div class="password-form">
            <h3 style="margin:.2rem 0 1rem;font-family:'Berkshire Swash',cursive;font-size:22px;" data-typing="true" data-text="Ative sua Senha" data-speed="40" data-cursor="true">Ative sua Senha</h3>
            <div class="password-input">
              <input type="password" id="senhaInput" placeholder="Digite sua senha..." />
              <span class="password-toggle" data-action="toggle-password">👁️</span>
            </div>
            <div style="margin-top:12px"><button class="btn" id="iniciar" data-action="start">Ativar e Iniciar</button></div>
          </div>
        </div>

        <!-- GUIA -->
        <div id="section-guia" class="j-section hidden">
          <div class="conteudo-pergaminho">
            <h2 style="margin-top:0;" data-typing="true" data-text="Escolha seu Guia ✨" data-speed="40" data-cursor="true">Escolha seu Guia ✨</h2>
            <div class="guia-container">
              <p data-typing="true" data-text="Zion (Grok) • Lumen (ChatGPT) • Arian (Gemini)" data-speed="40" data-cursor="true">Zion (Grok) • Lumen (ChatGPT) • Arian (Gemini)</p>
              <div class="guia-options">
                <button class="btn" data-action="select-guia" data-guia="zion">Escolher Zion</button>
                <button class="btn" data-action="select-guia" data-guia="lumen">Escolher Lumen</button>
                <button class="btn" data-action="select-guia" data-guia="arian">Escolher Arian</button>
              </div>
            </div>
            <div class="footer-actions">
              <button class="btn btn-avancar" data-action="avancar">Avançar</button>
            </div>
          </div>
        </div>

        <!-- SELFIE -->
        <div id="section-selfie" class="j-section hidden">
          <div class="conteudo-pergaminho">
            <h2 style="margin-top:0;" data-typing="true" data-text="Entre na Irmandade " data-speed="40" data-cursor="true">Entre na Irmandade ✨</h2>
            <p data-typing="true" data-text="Faça uma foto ou envie da galeria. Ajuste e gere sua imagem com seu guia." data-speed="40" data-cursor="true">Faça uma foto ou envie da galeria. Ajuste e gere sua imagem com seu guia.</p>
            <div class="selfie-row">
              <div class="selfie-left">
                <label class="btn" for="selfieInput">Tirar Foto</label>
                <input id="selfieInput" type="file" accept="image/*" capture="user" style="display:none" />
                <div class="selfie-controls">
                  <label>Nome <input id="nameInput" type="text" placeholder="Digite seu nome"></label>
                  <label>Zoom <input id="selfieScale" type="range" min="0.6" max="2.0" step="0.01" value="1"></label>
                  <label>Horizontal <input id="selfieOffsetX" type="range" min="-300" max="300" step="1" value="0"></label>
                  <label>Vertical <input id="selfieOffsetY" type="range" min="-300" max="300" step="1" value="0"></label>
                  <small class="muted">Dica: alinhe seu rosto na chama ao lado do guia.</small>
                </div>
                <div class="selfie-actions">
                  <button id="previewBtn" class="btn">Ver Prévia</button>
                  <button id="captureBtn" class="btn">Confirmar e Baixar</button>
                  <button id="btnSkipSelfie" class="btn" data-action="avancar">Pular Foto</button>
                  <button id="btnStartJourney" class="btn" data-action="avancar">Entrar na Jornada</button>
                </div>
              </div>
              <div class="selfie-right">
                <section id="card-guide" class="guide-card" data-guide="ZION" aria-label="Guia">
                  <img class="guide-bg" id="guideBg" src="/assets/img/irmandade-quarteto-bg-zion.png" alt="Guia Background">
                  <div class="flame-layer" aria-hidden="true">
                    <svg class="flame-svg" viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet">
                      <defs>
                        <clipPath id="flameClip">
                          <path d="M50,20 C42,35 34,45 33,58 C32,73 41,82 50,92 C59,82 68,73 67,58 C66,45 58,35 50,20 Z" />
                        </clipPath>
                        <radialGradient id="flameGlow" cx="50%" cy="70%" r="55%">
                          <stop offset="0%" stop-color="rgba(255, 224, 130, 1)"/>
                          <stop offset="55%" stop-color="rgba(255, 180, 0, 0.9)"/>
                          <stop offset="100%" stop-color="rgba(255, 180, 0, 0)"/>
                        </radialGradient>
                      </defs>
                      <image id="selfieImage" href="" x="15" y="35" width="70" height="90" clip-path="url(#flameClip)" preserveAspectRatio="xMidYMid slice" />
                      <ellipse cx="50" cy="95" rx="28" ry="40" fill="url(#flameGlow)"></ellipse>
                      <path d="M50,20 C42,35 34,45 33,58 C32,73 41,82 50,92 C59,82 68,73 67,58 C66,45 58,35 50,20 Z" fill="none" stroke="rgba(255,200,0,.85)" stroke-width="1.6"/>
                    </svg>
                  </div>
                  <div class="guide-name" id="guideNameSlot"></div>
                  <div class="user-name" id="userNameSlot">NOME</div>
                </section>
                <div id="selfieError" class="selfie-error">Erro ao carregar a pré-visualização. Tente novamente ou pule.</div>
                <small class="muted">Pré-visualização</small>
              </div>
            </div>
          </div>
        </div>

        <!-- PERGUNTAS -->
        <div id="section-perguntas" class="j-section hidden">
          <div class="progress-container">
            <div class="progress-badge" id="jprog-pct">0% concluído</div>
            <div class="progress-bar"><div class="progress-bar-fill" id="jprog-fill"></div></div>
            <div class="j-progress"><div class="j-progress__bar"><div class="j-progress__fill" id="j-fill-inline"></div></div><div class="j-progress__meta" id="j-meta"></div></div>
          </div>

          <div id="chama-perguntas" class="chama-icone chama-fixed-hero media" aria-hidden="true">
            <div class="chama-vela chama-md"><div class="brasa"></div><div class="lingua"></div><div class="lingua"></div><div class="lingua"></div><div class="brilho"></div></div>
          </div>

          <div id="perguntas-container"></div>

          <div class="footer-actions">
            <button id="btnNextPerguntas" class="btn btn-avancar" data-action="avancar">Avançar</button>
          </div>
        </div>

        <!-- FINAL -->
        <div id="section-final" class="j-section hidden">
          <p data-typing="true" data-text="Parabéns por completar esta jornada! Que sua chama interior continue a brilhar." data-speed="40" data-cursor="true"></p>
          <div class="selfie-final" style="text-align:center; margin-top:20px;">
            <img id="minhaFotoFinal" alt="Minha foto com a Irmandade" style="max-width:80%; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.3)" />
          </div>
          <p style="margin-top:12px;"><small data-typing="true" data-text="Sua imagem foi unida à Irmandade. " data-speed="40" data-cursor="true"></small></p>
          <div class="footer-actions">
            <button id="btnGeneratePDF" class="btn" data-action="generate-pdf">Gerar PDF/HQ</button>
            <button id="btnRestart" class="btn" data-action="restart">Voltar ao Portal</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer class="site-footer">
    <small>© 2025 Irmandade Conhecimento com Luz</small>
    <div id="envTag" style="margin-top:6px;opacity:.6;font-size:18px;"></div>
  </footer>

  <!-- Vídeo overlay -->
  <div id="videoOverlay" class="hidden">
    <video id="videoTransicao" class="video-player" playsinline controls></video>
    <div id="videoFallback" class="video-fallback hidden">Áudio da jornada em reprodução. Converta para H.264 MP4.</div>
    <button id="skipVideo" class="btn" style="position:absolute; top:14px; right:14px">Pular vídeo</button>
  </div>

  <!-- Chama inferior -->
  <div id="flame-bottom-right" class="flame-corner flame-bottom-right">
    <div class="chama-vela chama-md">
      <div class="brasa"></div><div class="lingua"></div><div class="lingua"></div><div class="lingua"></div><div class="brilho"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite" class="hidden"></div>

 <!-- Utils -->
  <script>
  (function() {
    window.utils = window.utils || {
      dedupe: str => str ? String(str).replace(/\s+/g, ' ').trim() : ''
    };
    console.log('[Utils] Bloco carregado');
  })();
  </script>

  <!-- Toast -->
  <script>
  (function() {
    window.toast = function(msg, time = 3000) {
      const t = document.getElementById('toast');
      if (!t) return;
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), time);
    };
    console.log('[Toast] Bloco carregado');
  })();
  </script>

  <!-- TTS -->
  <script>
  (function() {
    if (!window.JORNADA) window.JORNADA = {};
    window.JORNADA.tts = window.JORNADA.tts || { enabled: true, readingMode: 'after' };
    window.isMuted = window.isMuted || false;

    window.speak = window.speak || function(text) {
      if (window.isMuted || !window.JORNADA.tts.enabled) return Promise.resolve();
      if (!window.speechSynthesis) {
        console.warn('[speak] SpeechSynthesis não suportado no navegador');
        return Promise.resolve();
      }
      return new Promise(resolve => {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = i18n?.lang || 'pt-BR';
        utterance.onend = resolve;
        utterance.onerror = () => resolve();
        window.speechSynthesis.speak(utterance);
      });
    };
    console.log('[TTS] Bloco carregado');
  })();
  </script>

  <!-- Datilografia -->
  <script>
  (function() {
    const G = (typeof window !== 'undefined' ? window : globalThis);
    if (G.__typingLock == null) G.__typingLock = false;
    if (G.__DEFAULT_SPEED_TYPING == null) G.__DEFAULT_SPEED_TYPING = 80;
    window.G = G;
    console.log('[Datilografia] Bloco carregado');
  })();
  </script>

  <!-- Senha -->
  <script>
  (function() {
    const log = (...a) => { try { console.log('[Senha v4]', ...a); } catch (_) {} };
    const VALID_PASSWORD = 'luz123';

    function getSenhaSection() {
      return document.getElementById('section-senha') || document.querySelector('[data-section="senha"], .section-senha') || document;
    }

    function getSenhaInput() {
      const root = getSenhaSection();
      const tries = [
        '#senhaInput', '#iniciar', 'input[data-role="senha"]', 'input[name="senha"]',
        'input[name*="senha" i]', 'input[id*="senha" i]', 'input[type="password"]',
        'input[type="text"][name*="senha" i]', 'input[type="text"][id*="senha" i]',
        '.senha input', '.senha-input'
      ];
      for (const sel of tries) {
        const el = root.querySelector(sel);
        if (el) return el;
      }
      return root.querySelector('input');
    }

    window.toggleSenha = function() {
      const input = getSenhaInput();
      if (!input) {
        log('[Senha] input não encontrado');
        window.toast && window.toast('Campo de senha não encontrado.');
        return;
      }
      input.type = (input.type === 'password' ? 'text' : 'password');
      const eye = getSenhaSection().querySelector('[data-action="toggle-password"]');
      if (eye) {
        eye.classList.toggle('on');
        log('[Senha] Visibilidade da senha alternada');
      } else {
        log('[Senha] Olho mágico não encontrado');
        window.toast && window.toast('Botão de visibilidade não encontrado.');
      }
    };

    let lastStartJourney = 0;
    window.startJourney = function() {
      const now = performance.now();
      if (now - lastStartJourney < 1000) {
        log('[startJourney] Debounce: evitando chamada repetida');
        return;
      }
      lastStartJourney = now;

      const inputSenha = getSenhaInput();
      const inputNome = getSenhaSection().querySelector('#nameInput, [data-role="nome"], input[name="nome"]');
      const senha = (inputSenha && inputSenha.value || '').trim().toLowerCase();
      const nome = (inputNome && inputNome.value || '').trim();

      log('[startJourney] Senha fornecida:', senha ? '[oculta]' : 'nenhuma', 'Nome:', nome || 'nenhum');

      if (!senha) {
        window.toast && window.toast('Digite a senha para continuar.');
        if (inputSenha) inputSenha.focus();
        log('[startJourney] Senha não fornecida');
        return;
      }

      if (senha !== VALID_PASSWORD) {
        window.toast && window.toast('Senha incorreta. Tente novamente.');
        if (inputSenha) inputSenha.focus();
        log('[startJourney] Senha inválida:', senha);
        return;
      }

      if (nome) {
        try { localStorage.setItem('JORNADA_NOME', nome); } catch (_) {}
      }
      window.speak && window.speak('');

      const hasGuia = document.getElementById('section-guia');
      if (!hasGuia) {
        console.error('[startJourney] Seção section-guia não encontrada');
        window.toast && window.toast('Seção de guia não encontrada.');
        return;
      }

      if (window.JC) {
        window.JC.nextSection = 'section-guia';
        window.playVideo('/assets/img/conhecimento-com-luz-jardim.mp4');
        log('[startJourney] Reproduzindo vídeo conhecimento-com-luz-jardim antes de section-guia');
      } else {
        console.error('[startJourney] window.JC não definido');
        window.toast && window.toast('Erro ao inicializar jornada. Tente recarregar a página.');
      }
    };
    console.log('[Senha] Bloco carregado');
  })();
  </script>

  <!-- showSection -->
  <script>
  (function() {
    const HIDE_CLASS = 'hidden';
    let lastShowSection = 0;

    window.showSection = function(id) {
      const now = performance.now();
      if (now - lastShowSection < 500) {
        console.log('[showSection] Debounce: evitando chamada repetida');
        return;
      }
      lastShowSection = now;

      try {
        const all = Array.from(document.querySelectorAll('div[id^="section-"]'));
        const target = document.getElementById(id);
        if (!target) {
          console.warn('[showSection] Seção não encontrada:', id);
          window.toast && window.toast(`Seção ${id} não encontrada.`);
          return;
        }
        all.forEach(s => s.classList.add(HIDE_CLASS));
        target.classList.remove(HIDE_CLASS);
        target.classList.add('active');
        window.__currentSectionId = id;
        console.log('[showSection] Exibindo seção:', id);

        window.G = window.G || {};
        window.G.__typingLock = false;

        setTimeout(() => {
          const textElements = target.querySelectorAll('[data-typing="true"]:not(.hidden)');
          if (textElements.length === 0) {
            console.warn('[showSection] Nenhum elemento de digitação encontrado em:', id);
          }
          textElements.forEach(el => {
            if (!el || !(el instanceof Element)) {
              console.error('[showSection] Elemento de digitação inválido:', el);
              return;
            }
            const selector = el.id ? `#${el.id}` : `.${el.className.split(' ')[0] || 'text'}`;
            window.runTyping(selector, () => {
              console.log('[showSection] Digitação concluída para:', selector);
              const text = el.getAttribute('data-text') || el.textContent;
              window.speak && window.speak(text);
            });
            console.log('[showSection] Iniciando runTyping para:', id, 'Seletor:', selector);
          });

          const btns = target.querySelectorAll(
            '[data-action="avancar"], .btn-avancar, #iniciar, [data-action="skip-selfie"], [data-action="select-guia"], #btnSkipSelfie, #btnStartJourney'
          );
          btns.forEach(btn => {
            if (!btn.dataset.clickAttached) {
              btn.addEventListener(
                'click',
                (e) => {
                  e.preventDefault();
                  console.log('[showSection] Botão clicado:', btn.id || btn.className);
                  if (window.JC && window.JC.goNext) {
                    window.JC.goNext();
                  } else {
                    console.error('[showSection] window.JC.goNext não definido');
                    window.toast && window.toast('Erro ao navegar. Tente recarregar.');
                  }
                },
                { once: true }
              );
              btn.dataset.clickAttached = '1';
              console.log('[showSection] Evento de clique adicionado ao botão em:', id, 'Botão:', btn.id || btn.className);
            }
          });
        }, 100);
      } catch (e) {
        console.error('[showSection] Erro:', e);
        window.toast && window.toast('Erro ao exibir seção');
      }
      console.log('[showSection] Bloco carregado');
    };

    document.addEventListener('DOMContentLoaded', () => {
      window.showSection('section-intro');
    });
  })();
  </script>
  <script type="module">
    import i18n from '/public/assets/js/i18n.js';
    document.addEventListener('DOMContentLoaded', () => {
        const btns = document.querySelectorAll('.btn-avancar');
        btns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('[showSection] Botão clicado:', btn.id || btn.className);
                if (window.JC?.goNext) {
                    window.JC.goNext();
                    btn.innerHTML = 'Carregando...';
                } else {
                    console.warn('[showSection] window.JC.goNext não definido, aguardando...');
                    setTimeout(() => {
                        if (window.JC?.goNext) {
                            window.JC.goNext();
                            btn.innerHTML = 'Carregando...';
                        } else {
                            console.error('[showSection] JC ainda não inicializado');
                            const current = document.querySelector('.active');
                            const nextSection = document.getElementById('section-termos');
                            if (current && nextSection) {
                                current.classList.remove('active');
                                current.classList.add('hidden');
                                nextSection.classList.add('active');
                                nextSection.classList.remove('hidden');
                                console.log('[showSection] Fallback: Avançou para section-termos');
                                window.runTyping && window.runTyping('#termos-pg1');
                            }
                        }
                    }, 1000);
                }
            }, { once: false });
        });

        // Habilita botão após i18n
        i18n.init().then(() => {
            document.querySelectorAll('.btn-avancar').forEach(btn => {
                btn.removeAttribute('disabled');
                btn.innerHTML = 'Avançar';
            });
        }).catch(() => {
            document.querySelectorAll('.btn-avancar').forEach(btn => {
                btn.removeAttribute('disabled');
                btn.innerHTML = 'Avançar';
            });
        });
    });
</script>
  <!-- Navegação de Termos -->
  <script>
  (function() {
    const showPage = (pg) => {
      const pages = ['termos-pg1', 'termos-pg2'];
      pages.forEach(p => {
        const el = document.getElementById(p);
        if (el) el.classList.add('hidden');
      });
      const target = document.getElementById(pg);
      if (target) {
        target.classList.remove('hidden');
        window.runTyping && window.runTyping(`#${pg}`, () => {
          console.log('[Termos] Digitação concluída para:', pg);
          const text = target.getAttribute('data-text') || target.textContent;
          window.speak && window.speak(text);
        });
        console.log('[Termos] Exibindo página:', pg);
      }
    };

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-action="termos-next"], [data-action="termos-prev"], [data-action="termos-accept"]');
      if (btn) {
        e.preventDefault();
        if (btn.dataset.action === 'termos-next') {
          showPage('termos-pg2');
        } else if (btn.dataset.action === 'termos-prev') {
          showPage('termos-pg1');
        } else if (btn.dataset.action === 'termos-accept') {
          if (window.JC) {
            window.JC.nextSection = 'section-senha';
            window.showSection && window.showSection('section-senha');
            console.log('[Termos] Navegação para section-senha');
          } else {
            console.error('[Termos] window.JC não definido');
            window.toast && window.toast('Erro ao navegar para a senha.');
          }
        }
      }
    });
    console.log('[Termos] Bloco carregado');
  })();
  </script>

  <!-- Vídeo Transição -->
  <script>
  (function() {
    window.playVideo = function(videoSrc) {
      console.log('[playVideo] Reproduzindo vídeo:', videoSrc);
      const overlay = document.getElementById('videoOverlay');
      const video = document.getElementById('videoTransicao');
      const fallback = document.getElementById('videoFallback');
      if (!overlay || !video) {
        console.error('[playVideo] Elementos de vídeo não encontrados');
        window.toast && window.toast('Erro ao reproduzir vídeo.');
        return;
      }
      fetch(videoSrc, { method: 'HEAD' })
        .then(res => {
          if (!res.ok) throw new Error(`Vídeo não encontrado: ${videoSrc}`);
          video.src = videoSrc;
          video.onended = () => {
            overlay.classList.add('hidden');
            video.src = '';
            if (window.JC && window.JC.nextSection) {
              window.showSection && window.showSection(window.JC.nextSection);
            }
          };
          video.onerror = () => {
            console.error('[playVideo] Erro ao carregar vídeo:', videoSrc);
            if (fallback) {
              fallback.classList.remove('hidden');
              video.classList.add('hidden');
              setTimeout(() => {
                overlay.classList.add('hidden');
                fallback.classList.add('hidden');
                video.classList.remove('hidden');
                if (window.JC && window.JC.nextSection) {
                  window.showSection && window.showSection(window.JC.nextSection);
                }
              }, 3000);
            }
          };
          overlay.classList.remove('hidden');
          video.load();
          video.play().catch(e => {
            console.error('[playVideo] Erro ao reproduzir vídeo:', e);
            window.toast && window.toast('Erro ao reproduzir vídeo');
            if (fallback) {
              fallback.classList.remove('hidden');
              video.classList.add('hidden');
            }
          });
        })
        .catch(err => {
          console.error('[playVideo] Erro ao verificar vídeo:', err);
          window.toast && window.toast('Vídeo não disponível');
          if (fallback) {
            fallback.classList.remove('hidden');
            video.classList.add('hidden');
          }
        });
    };

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('#skipVideo');
      if (btn) {
        const overlay = document.getElementById('videoOverlay');
        const video = document.getElementById('videoTransicao');
        if (overlay && video) {
          video.pause();
          video.src = '';
          overlay.classList.add('hidden');
          if (window.JC && window.JC.nextSection) {
            window.showSection && window.showSection(window.JC.nextSection);
          }
        }
      }
    });
    console.log('[Video] Bloco carregado');
  })();
  </script>

  <!-- Guia Seleção -->
  <script>
  (function() {
    window.JORNADA = window.JORNADA || {};
    window.JORNADA.selectedGuia = window.JORNADA.selectedGuia || null;

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-action="select-guia"]');
      if (btn) {
        e.preventDefault();
        const guia = btn.dataset.guia;
        window.JORNADA.selectedGuia = guia;
        console.log('[Guia] Guia selecionado:', guia);
        const guideBg = document.getElementById('guideBg');
        if (guideBg) {
          guideBg.src = `/assets/img/irmandade-quarteto-bg-${guia}.png`;
        }
        const guideNameSlot = document.getElementById('guideNameSlot');
        if (guideNameSlot) {
          guideNameSlot.textContent = guia.charAt(0).toUpperCase() + guia.slice(1);
        }
        if (window.JC && window.playVideo) {
          window.JC.nextSection = 'section-selfie';
          window.playVideo('/assets/img/filme-0-ao-encontro-da-jornada.mp4');
          console.log('[Guia] Reproduzindo vídeo filme-0-ao-encontro-da-jornada antes de section-selfie');
        } else {
          window.showSection && window.showSection('section-selfie');
          console.log('[Guia] Navegação direta para section-selfie');
        }
      }
    });
    console.log('[Guia] Bloco carregado');
  })();
  </script>

  <!-- Selfie -->
  <script>
  (function() {
  let lastPreview = 0;
  let lastCapture = 0;

  const $ = (sel, root = document) => root.querySelector(sel);

  // Ajuda: seta src/href conforme seja <img> ou <image> (SVG)
  function setImageSource(el, dataUrl) {
    if (!el) return;
    const tag = (el.tagName || '').toLowerCase();
    if (tag === 'img') {
      el.src = dataUrl;
    } else {
      // <image> (SVG)
      el.setAttribute('href', dataUrl);
      // compat xlink se precisar:
      el.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', dataUrl);
    }
  }

  // 1) INPUT DE ARQUIVO (selfie)
  document.addEventListener('change', (e) => {
    const input = e.target.closest('#selfieInput');
    if (!input || !input.files || !input.files[0]) return;

    const reader = new FileReader();
    reader.onload = (ev) => {
      const img = $('#selfieImage');
      setImageSource(img, ev.target.result);

      // NÃO usar optional chaining na esquerda de uma atribuição:
      const flameLayer = $('.flame-layer');
      if (flameLayer && flameLayer.style) {
        flameLayer.style.opacity = '1';
      }

      console.log('[Selfie] Imagem carregada');
    };
    reader.readAsDataURL(input.files[0]);
  });

  // 2) CONTROLES (nome, escala, offsets)
  document.addEventListener('input', (e) => {
    const input = e.target.closest('#nameInput, #selfieScale, #selfieOffsetX, #selfieOffsetY');
    if (!input) return;

    const img = $('#selfieImage');
    const nameSlot = $('#userNameSlot');
    if (!img || !nameSlot) return;

    if (input.id === 'nameInput') {
      nameSlot.textContent = input.value || 'NOME';
      return;
    }

    const scale   = parseFloat($('#selfieScale')?.value || '1') || 1;
    const offsetX = parseFloat($('#selfieOffsetX')?.value || '0') || 0;
    const offsetY = parseFloat($('#selfieOffsetY')?.value || '0') || 0;

    // Se for IMG, use transform CSS; se for SVG <image>, use atributos x/y/width/height (ajuste conforme seu SVG)
    const tag = (img.tagName || '').toLowerCase();
    if (tag === 'img') {
      img.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
      img.style.transformOrigin = 'center center';
    } else {
      // <image> no SVG
      const baseW = parseFloat(img.getAttribute('data-base-w') || img.getAttribute('width') || '300') || 300;
      const baseH = parseFloat(img.getAttribute('data-base-h') || img.getAttribute('height') || '300') || 300;
      img.setAttribute('x', String(offsetX));
      img.setAttribute('y', String(offsetY));
      img.setAttribute('width',  String(baseW * scale));
      img.setAttribute('height', String(baseH * scale));
    }
  });
})();

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('#previewBtn, #captureBtn, #btnSkipSelfie, #btnStartJourney');
      if (btn) {
        e.preventDefault();
        const now = performance.now();
        if (btn.id === 'previewBtn') {
          if (now - lastPreview < 1000) return;
          lastPreview = now;
          const img = document.getElementById('selfieImage');
          if (img && img.getAttribute('href')) {
            document.querySelector('.flame-layer')?.style.opacity = '1';
            window.toast && window.toast('Pré-visualização atualizada!');
            console.log('[Selfie] Pré-visualização atualizada');
          } else {
            window.toast && window.toast('Selecione uma imagem primeiro.');
            console.log('[Selfie] Nenhuma imagem selecionada para pré-visualização');
          }
        } else if (btn.id === 'captureBtn') {
          if (now - lastCapture < 1000) return;
          lastCapture = now;
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          const img = document.getElementById('selfieImage');
          const bg = document.getElementById('guideBg');
          const nameSlot = document.getElementById('userNameSlot');
          const guideNameSlot = document.getElementById('guideNameSlot');
          if (!img || !bg || !nameSlot || !guideNameSlot) {
            window.toast && window.toast('Erro ao capturar imagem.');
            console.log('[Selfie] Elementos de imagem, fundo ou nomes não encontrados');
            return;
          }
          canvas.width = bg.width;
          canvas.height = bg.height;
          ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
          const scale = document.getElementById('selfieScale')?.value || 1;
          const offsetX = document.getElementById('selfieOffsetX')?.value || 0;
          const offsetY = document.getElementById('selfieOffsetY')?.value || 0;
          ctx.save();
          ctx.translate(15 + parseFloat(offsetX), 35 + parseFloat(offsetY));
          ctx.scale(scale, scale);
          ctx.drawImage(img, 0, 0, 70, 90);
          ctx.restore();
          ctx.font = 'bold 2.5rem Cardo, serif';
          ctx.fillStyle = '#f7d37a';
          ctx.textAlign = 'center';
          ctx.fillText(guideNameSlot.textContent, canvas.width / 2, canvas.height * 0.02 + 30);
          ctx.font = 'bold 2rem Cardo, serif';
          ctx.fillText(nameSlot.textContent, canvas.width / 2, canvas.height * 0.98 - 10);
          const link = document.createElement('a');
          link.download = 'selfie-irmandade.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
          console.log('[Selfie] Imagem baixada');
          try {
            localStorage.setItem('JORNADA_SELFIE', link.href);
          } catch (_) {}
        } else if (btn.id === 'btnSkipSelfie' || btn.id === 'btnStartJourney') {
          if (window.JC) {
            window.JC.nextSection = 'section-perguntas';
            if (window.playVideo && window.JORNADA_VIDEOS && window.JORNADA_VIDEOS.afterBlocks[0]) {
              window.playVideo('/assets/img/filme-1-entrando-na-jornada.mp4');
              console.log('[Selfie] Reproduzindo vídeo filme-1 antes de section-perguntas');
            } else {
              window.showSection('section-perguntas');
              console.log('[Selfie] Navegação direta para section-perguntas');
            }
          } else {
            console.error('[Selfie] window.JC não definido');
            window.toast && window.toast('Erro ao navegar para as perguntas.');
          }
        }
      }
    });
    console.log('[Selfie] Bloco carregado');
  })();
  </script>

  <!-- loadDynamicBlocks -->
  <script>
  (function() {
    const VIDEO_BASE = '/assets/img/';
    window.JORNADA_VIDEOS = {
      intro: VIDEO_BASE + 'conhecimento-com-luz-jardim.mp4',
      afterBlocks: {
        0: VIDEO_BASE + 'filme-1-entrando-na-jornada.mp4',
        1: VIDEO_BASE + 'filme-2-dentro-da-jornada.mp4',
        2: VIDEO_BASE + 'filme-3-traumas-na-jornada.mp4',
        3: VIDEO_BASE + 'filme-4-aproximando-do-final.mp4'
      },
      final: VIDEO_BASE + 'filme-5-fim-da-jornada.mp4'
    };
    window.JORNADA_FINAL_VIDEO = window.JORNADA_VIDEOS.final;

    window.loadDynamicBlocks = async function() {
      try {
        await i18n.waitForReady(10000);
        if (!i18n.ready) throw new Error('i18n não inicializado');
        const currentLang = i18n.lang || 'pt-BR';
        const content = document.getElementById('perguntas-container');
        if (!content) {
          console.error('[loadDynamicBlocks] Container de perguntas não encontrado');
          window.toast && window.toast('Erro ao carregar perguntas.');
          return;
        }

        content.innerHTML = '';
        content.classList.remove('hidden');
        const blocks = window.JORNADA_BLOCKS || [];
        if (!blocks.length) {
          console.error('[loadDynamicBlocks] JORNADA_BLOCKS não definido ou vazio');
          window.toast && window.toast('Nenhum bloco de perguntas encontrado.');
          return;
        }

        blocks.forEach((block, bIdx) => {
          const bloco = document.createElement('div');
          bloco.className = 'j-bloco';
          bloco.id = `bloco-${bIdx}`;
          bloco.dataset.bloco = bIdx;
          bloco.dataset.video = block.video_after || '';
          bloco.style.display = bIdx === window.JC.currentBloco ? 'block' : 'none';

          if (block.title) {
            const title = document.createElement('h3');
            title.className = 'pergunta-enunciado text';
            title.id = `bloco-title-${bIdx}`;
            title.dataset.typing = 'true';
            title.dataset.text = block.title;
            title.dataset.speed = '36';
            title.dataset.cursor = 'true';
            title.textContent = block.title;
            bloco.appendChild(title);
          }

          (block.questions || []).forEach((q, qIdx) => {
            const label = typeof q === 'string' ? q : (q.label || q.text || '');
            const div = document.createElement('div');
            div.className = 'j-pergunta';
            div.id = `pergunta-${bIdx}-${qIdx}`;
            div.dataset.pergunta = qIdx;
            div.style.display = bIdx === window.JC.currentBloco && qIdx === window.JC.currentPergunta ? 'block' : 'none';
            div.innerHTML = `
              <label class="pergunta-enunciado text" 
                     id="pergunta-label-${bIdx}-${qIdx}" 
                     data-typing="true" 
                     data-text="Pergunta ${qIdx + 1}: ${label}" 
                     data-speed="36" 
                     data-cursor="true">${label}</label>
              <textarea rows="4" class="input" id="pergunta-input-${bIdx}-${qIdx}" data-i18n-placeholder="resposta_placeholder" placeholder="Digite sua resposta..."></textarea>
              <div class="accessibility-controls">
                <button class="btn-mic" data-action="start-mic">🎤 Falar Resposta</button>
                <button class="btn-audio" data-action="read-question">🔊 Ler Pergunta</button>
                <button class="btn btn-avancar" data-action="avancar">Avançar</button>
              </div>
            `;
            bloco.appendChild(div);
          });

          content.appendChild(bloco);
        });

        const firstBloco = content.querySelector('.j-bloco');
        if (firstBloco) {
          firstBloco.style.display = 'block';
          window.JC.currentBloco = 0;
          window.JC.currentPergunta = 0;
          const first = firstBloco.querySelector('.j-pergunta');
          if (first) {
            first.classList.add('active');
            first.style.display = 'block';
            setTimeout(() => window.runTyping && window.runTyping(`#${first.id}`), 100);
          }
        } else {
          console.error('[loadDynamicBlocks] Nenhum bloco criado');
          window.toast && window.toast('Erro ao criar blocos de perguntas.');
        }

        if (window.loadAnswers) window.loadAnswers();
        const firstTa = document.querySelector('.j-bloco .j-pergunta textarea');
        if (firstTa && window.handleInput) window.handleInput(firstTa);
        console.log('[loadDynamicBlocks] Blocos carregados com sucesso');
      } catch (error) {
        console.error('[loadDynamicBlocks] Erro:', error);
        window.toast && window.toast('Erro ao carregar blocos de perguntas');
      }
    };

    document.addEventListener('change', (e) => {
      if (e.target.id === 'language-select') {
        i18n.setLang(e.target.value).then(() => {
          window.loadDynamicBlocks();
          console.log('[loadDynamicBlocks] Idioma alterado, blocos recarregados');
        });
      }
    });

    console.log('[loadDynamicBlocks] Bloco carregado');
  })();
  </script>

</body>
</html>
