<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jornada • Irmandade Conhecimento com Luz</title>
  <link rel="alternate icon" href="/assets/img/perfil-da-irmandade.png" type="image/png">
  <style>
    :root { --bg:#0b1020; --fg:#eef2ff; --muted:#aab4d4; --primary:#6aa7ff; --card:#121832; --card-2:#0e1428; --radius:16px; }
    *{box-sizing:border-box}
    html,body{height:100%}

    @font-face{
      font-family:'ManufacturingConsent';
      src:url('/assets/fonts/ManufacturingConsent-Regular.ttf') format('truetype');
      font-weight:400; font-style:normal; font-display:swap;
    }
    @font-face{
      font-family:'BerkshireSwash';
      src:url('/assets/fonts/BerkshireSwash-Regular.ttf') format('truetype');
      font-weight:400; font-style:normal; font-display:swap;
    }
    @font-face{
      font-family:'Cardo';
      src:url('/assets/fonts/Cardo-Regular.ttf') format('truetype');
      font-weight:400; font-style:normal; font-display:swap;
    }
    @font-face{
      font-family:'Cardo';
      src:url('/assets/fonts/Cardo-Italic.ttf') format('truetype');
      font-weight:400; font-style:italic; font-display:swap;
    }
    @font-face{
      font-family:'Cardo';
      src:url('/assets/fonts/Cardo-Bold.ttf') format('truetype');
      font-weight:700; font-style:normal; font-display:swap;
    }

    body{margin:0;font-family:'BerkshireSwash',cursive;background:var(--bg);color:var(--fg);line-height:1.5;}
    h1,h2,h3,h4,h5,h6,.site-header h1,.card h2,.section-title,.bloco-titulo,.card-pergunta h3,.jornada-header h1{font-family:'ManufacturingConsent',serif;letter-spacing:1px;text-transform:none;font-weight:400;}
    label,.pergunta-enunciado,.texto-guia,.orientacoes,.contrato,p{font-family:'BerkshireSwash',cursive;}
    input,textarea,select,.resposta,.jornada-resposta,.devolutiva,#acolh,#jornada-conteudo textarea,#jornada-conteudo input[type="text"],#jornada-conteudo input[type="email"],#jornada-conteudo input[type="number"],#form-perguntas textarea,#form-perguntas input[type="text"],#form-perguntas input[type="email"],#form-perguntas input[type="number"]{font-family:'Cardo',serif;}
    .site-header,.site-footer{padding:24px 16px;text-align:center}
    .container{max-width:920px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:16px}
    .motto{opacity:.8;margin-top:8px;text-align:center;letter-spacing:.1em}
    .card{background:linear-gradient(180deg,var(--card),var(--card-2));padding:20px;border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(106,167,255,.15);color:var(--primary);font-weight:600}
    .small{font-size:.875rem;opacity:.9}
    hr{border:0;border-top:1px solid rgba(255,255,255,.15);margin:16px 0}
    .input, textarea{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0c1330;color:var(--fg)}
    label{font-weight:600;margin:6px 0 4px;display:block}
    .senha-wrap{position:relative;display:flex;align-items:center}
    .senha-wrap .input{padding-right:42px}
    .senha-eye{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:28px;height:28px;border:0;background:transparent;color:var(--muted);display:flex;align-items:center;justify-content:center;cursor:pointer}
    .senha-eye:hover{color:var(--fg)}
    .senha-eye svg{width:20px;height:20px}
    body.jornada-active #page-shell,body.jornada-active header.site-header,body.jornada-active footer.site-footer {display:none !important;}
    body.jornada-active #jornada-canvas {display:block !important;}
    .pergaminho{margin:12px auto;padding:0;border-radius:18px;overflow:hidden;background-repeat:no-repeat;background-position:center;background-size:100% 100%;}
    :root{--pergV-ratio: 2/3; --pergH-ratio: 3/2;}
    .pergaminho-v{background-image:url("/assets/img/pergaminho-rasgado-vert.png");height:92vh;width:calc(92vh * var(--pergV-ratio));max-width:96vw;}
    .pergaminho-h{background-image:url("/assets/img/pergaminho-rasgado-horiz.png");width:96vw;height:calc(96vw / var(--pergH-ratio));max-height:82vh;}
    .conteudo-pergaminho{padding:clamp(12px,3vw,28px);line-height:1.55;}
    .jornada #jornada-canvas.pergaminho{display:block;}
    .j-bloco{display:none;}
    .j-pergunta{display:none;}
    .video-overlay{position:fixed; inset:0; background:rgba(0,0,0,.85);display:flex; align-items:center; justify-content:center; z-index:9999;}
    .video-overlay.hidden{display:none;}
    .lumen-typing { white-space: pre-wrap; position: relative; }
    .lumen-typing::after { content: "▌"; margin-left: 2px; opacity: .75; animation: lumenBlink 1s steps(2, end) infinite; }
    .lumen-typing.typing-done::after { content: ""; animation: none; }
    @keyframes lumenBlink { 50% { opacity: 0; } }
    .chama.chama-viva span { animation: flicker-strong 0.85s infinite; filter: drop-shadow(0 0 12px rgba(255,140,0,.55)); }
    .chama.chama-pulse span { animation: flicker-strong 0.6s infinite; }
    .chama { width: 24px; height: 60px; }
    .chama.chama-md { width: 22px; height: 54px; }
    .chama.chama-lg { width: 36px; height: 88px; }
    @media (max-width: 600px) {
      .chama { width: 20px; height: 50px; }
      .chama.chama-md { width: 18px; height: 44px; }
      .chama.chama-lg { width: 28px; height: 72px; }
      #chama-perguntas { margin: 6px 0 10px; }
    }
    .chama-fixed-top { position: absolute; top: 10px; right: 14px; z-index: 60; }
    .chama-fixed-hero { position: absolute; top: -8px; left: -8px; z-index: 60; }
    .mark-emocao { background: linear-gradient(90deg, rgba(255,196,0,.35), rgba(255,140,0,.2)); border-radius: 4px; padding: 0 2px; }
    .j-progress { margin:6px 0 14px; }
    .j-progress__bar { width:100%; height:10px; border-radius:999px; background:rgba(255,255,255,.14); overflow:hidden; }
    .j-progress__fill{ height:100%; width:0%; transition:width .25s ease; background:linear-gradient(90deg,#f59e0b,#fde68a); }
    .j-progress__meta{ margin-top:6px; font-size:.95rem; opacity:.9; display:flex; justify-content:space-between; gap:8px; }
    .j-progress__meta b { font-weight:700; }
    .progress-badge { position:absolute; top:8px; right:16px; background:rgba(0,0,0,0.7); color:#fff; font-size:.9rem; padding:4px 8px; border-radius:8px; font-family:'Cardo', serif; z-index:10; }
    .progress-bar { width:100%; height:8px; background:rgba(255,255,255,0.2); border-radius:4px; overflow:hidden; margin:10px 0; }
    .progress-bar-fill { height:100%; width:0; background:linear-gradient(90deg,#ffcf70,#ff8c00); transition:width .5s ease-out; }
    nav a, a.btn, .site-header p { letter-spacing:.5px; }
    .video-overlay { position:fixed; inset:0; background:#000; display:flex; justify-content:center; align-items:center; z-index:9999; }
    .video-overlay.hidden { display:none; }
    .video-player { max-width:100%; max-height:100%; }
    .lang-switch { display:flex; gap:6px; align-items:center; }
    .lang-btn { font-family:'ManufacturingConsent', serif; font-size:.85rem; padding:.25rem .5rem; border-radius:.5rem; border:1px solid rgba(255,255,255,.2); background:transparent; color:#e8ecf4; cursor:pointer; }
    .lang-btn:hover { background:rgba(255,255,255,.1); }
    .j-bloco { display: none; }
    .j-pergunta { display: none; }
    .video-overlay { position:fixed; inset:0; background:rgba(0,0,0,.85); display:flex; align-items:center; justify-content:center; z-index:9999; }
    .video-overlay.hidden { display:none; }
    .jornada #jornada-canvas.pergaminho { }
    .jornada .j-progress { }
    .jornada .footer-actions .btn { }
    .chama-viva .lingua{ animation-name: lingua, linguaJitter; }
    @keyframes linguaJitter{ 0%,100% { transform: translateX(-50%) scaleY(1) skewX(0deg); } 20% { transform: translateX(-50%) scaleY(1.03) skewX(.4deg) translateX(var(--jitter,0px)); } 50% { transform: translateX(-50%) scaleY(1.08) skewX(1deg) translateX(var(--jitter,0px)); } 80% { transform: translateX(-50%) scaleY(1.02) skewX(.2deg) translateX(var(--jitter,0px)); } }
    .chama-viva .lingua { animation-name: lingua, linguaJitter; animation-duration: 1.2s, 3s; animation-iteration-count: infinite, infinite; animation-timing-function: ease-in-out, ease-in-out; }
    .chama-viva .brilho{ animation: aura var(--pulso) infinite ease-in-out, brilhoJitter 2.2s infinite ease-in-out; }
    @keyframes brilhoJitter{ 0%,100%{filter: blur(12px)} 50%{filter: blur(14px)} }
    .chama-fixed-hero{ position:absolute; top:-8px; left:-8px; z-index:60 }

    /* Forçar visibilidade temporária para debug */
    #sec-wizard .j-bloco,
    #sec-wizard .j-pergunta {
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
    }
    /* Fallback para imagens */
    .pergaminho-v { background-image: url('/assets/img/pergaminho-rasgado-vert.png'); }
    .pergaminho-v:empty { background-color: #f6efe0; } /* Cor de fallback se imagem falhar */
    .pergaminho-h { background-image: url('/assets/img/pergaminho-rasgado-horiz.png'); }
    .pergaminho-h:empty { background-color: #f6efe0; } /* Cor de fallback se imagem falhar */
  </style>
</head>

<body data-layout="master" data-journey="essencial">
  <header class="site-header">
    <div class="chama-viva chama-lg chama-strong chama-fixed-hero" id="chama-intro">
      <div class="brasa"></div>
      <div class="lingua"></div>
      <div class="lingua"></div>
      <div class="lingua"></div>
      <div class="brilho"></div>
    </div>
    <h1>Jornada Essencial</h1>
  </header>

  <main id="page-shell" class="container">
    <div class="container">
      <a class="btn btn-primary" href="#sec-intro">Ir para Introdução</a>
      <a class="btn btn-secondary" href="/jornadas.html">← Voltar</a>
    </div>

    <div class="section-container">
      <section id="jornada-canvas" class="card pergaminho pergaminho-v">
        <div id="jornada-conteudo" class="conteudo-pergaminho">
          <!-- AUTENTICAÇÃO -->
          <div id="sec-auth" class="j-section">
            <div class="chama-viva chama-lg chama-strong chama-fixed-hero" id="chama-auth">
              <div class="brasa"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="brilho"></div>
            </div>
            <p data-typing data-text="Bem-vindo(a) à Jornada Essencial. Por favor, insira a senha para começar." data-speed="50" data-cursor="true"></p>
            <div class="password-form">
              <h3>Ative sua Senha</h3>
              <div class="senha-wrap">
                <input type="password" id="senha" class="input" placeholder="Digite sua senha...">
                <span class="senha-eye password-toggle" data-action="toggle-password">👁️</span>
              </div>
              <button id="btnEntrar" class="btn btn-primary" data-action="start">Entrar</button>
              <div id="authError" class="hidden text-red-500 mt-2">Senha incorreta.</div>
            </div>
          </div>

          <!-- INTRO -->
          <div id="sec-intro" class="j-section hidden">
            <div class="chama-viva chama-lg chama-strong chama-fixed-hero" id="chama-intro">
              <div class="brasa"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="brilho"></div>
            </div>
            <p data-typing data-text="Respire. Esta jornada é sua. Um passo de cada vez." data-speed="40" data-cursor="true"></p>
            <p data-typing data-text="Aceite os termos para iniciar." data-speed="50" data-cursor="true"></p>
            <div class="password-form">
              <label><input type="checkbox" id="chkTermo"> Concordo com os termos</label>
              <button id="btnIniciar" class="btn btn-primary" disabled>Iniciar</button>
            </div>
          </div>

          <!-- PERGUNTAS (WIZARD) -->
          <div id="sec-wizard" class="j-section hidden">
            <div class="chama-viva chama-md" id="chama-perguntas">
              <div class="brasa"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="brilho"></div>
            </div>
            <div id="perguntas-container"></div>
            <div class="footer-actions">
              <button id="btnLimparAtual" class="btn btn-secondary">Limpar</button>
              <button id="btnVoltar" class="btn btn-secondary" data-action="prev">Voltar</button>
              <button id="btnProxima" class="btn btn-primary" data-action="next">Próxima</button>
            </div>
          </div>

          <!-- FINAL -->
          <div id="sec-final" class="j-section hidden">
            <div class="chama-viva chama-lg chama-strong chama-fixed-hero" id="chama-final">
              <div class="brasa"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="lingua"></div>
              <div class="brilho"></div>
            </div>
            <p data-typing data-text="Parabéns por completar esta jornada! Que sua chama interior continue a brilhar." data-speed="40" data-cursor="true"></p>
            <div class="footer-actions">
              <button id="btnRevisar" class="btn btn-secondary">Revisar</button>
              <button id="btnGerarPDFHQ" class="btn btn-primary">Baixar PDF + HQ</button>
              <button id="btnNovaJornada" class="btn btn-secondary">Nova Jornada</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer class="site-footer">
      <small>© 2025 Irmandade Conhecimento com Luz</small>
      <div id="envTag"></div>
    </footer>
  </main>

  <!-- PROGRESS -->
  <div class="progress-badge" id="jprog-pct">0% concluído</div>
  <div class="progress-bar"><div class="progress-bar-fill" id="jprog-fill"></div></div>
  <div class="j-progress">
    <div class="j-progress__bar"><div class="j-progress__fill"></div></div>
    <div class="j-progress__meta" id="j-meta"></div>
  </div>

  <!-- OVERLAY VIDEO -->
  <div id="videoOverlay" class="video-overlay hidden">
    <video id="videoTransicao" class="video-player" playsinline preload="metadata" controls></video>
    <button id="skipVideo" class="btn btn-secondary">Pular vídeo</button>
  </div>

  <!-- GUIA ESPIRITUAL: chama flamejante livre -->
  <div id="guia-espiritual">
    <div id="chama-bola" class="chama-viva" style="position: fixed; bottom: 20px; right: 20px;">
      <div class="brasa"></div>
      <div class="lingua"></div>
      <div class="lingua"></div>
      <div class="lingua"></div>
      <div class="brilho"></div>
    </div>
  </div>

  <!-- Scripts inline consolidado -->
  <script>
    // Tag ambiente
    document.getElementById('envTag').textContent =
      `layout=${document.body.dataset.layout || 'master'} · journey=${document.body.dataset.journey || 'essencial'} · path=/public`;

    // Configuração local
    (function setupConfig() {
      const wantLocal = location.hostname === "localhost" || location.search.includes("useLocalApi=1");
      if (wantLocal) {
        window.APP_CONFIG = Object.assign(window.APP_CONFIG || {}, {
          API_BASE: "http://localhost:3000/api",
          ENV: "dev"
        });
        console.log("config.local.js aplicado: API_BASE = http://localhost:3000/api");
      } else {
        window.APP_CONFIG = Object.assign(window.APP_CONFIG || {}, {
          API_BASE: "https://conhecimento-com-luz-api.onrender.com",
          ENV: "prod"
        });
        console.log("config.prod.js aplicado: API_BASE = https://conhecimento-com-luz-api.onrender.com");
      }
    })();

    // Definições iniciais
    const EMO = {
      POS: {'feliz':2,'alegria':2,'amor':3,'sucesso':2,'esperança':3,'paz':2,'fé':3,'gratidão':2,'vitória':3,'superação':3,'luz':2,'deus':3,'coragem':2,'força':2,'confiança':2,'propósito':3},
      NEG: {'triste':-2,'dor':-3,'raiva':-2,'medo':-2,'frustracao':-2,'frustração':-2,'decepcao':-2,'decepção':-2,'perda':-3,'culpa':-2,'ansiedade':-2,'solidao':-2,'solidão':-2,'desespero':-3,'cansaco':-2,'cansaço':-2,'fracasso':-2,'trauma':-3,'duvida':-2,'dúvida':-2}
    };

    const PERGUNTAS = [
      'Quem é você hoje?',
      'O que a Luz te pede agora?',
      'Qual é o próximo passo concreto?',
      'Qual verdade você precisa admitir para seguir?',
      'O que precisa ser curado neste momento?'
      // TODO: Substituir pelas 32 oficiais
    ];

    // Utils
    const JORNADA_UTILS = {
      saveLocal: (key, value) => localStorage.setItem(key, JSON.stringify(value)),
      loadLocal: (key) => {
        try { return JSON.parse(localStorage.getItem(key) || "{}"); } catch (_) { return {}; }
      },
      clearLocal: (key) => localStorage.removeItem(key),
      el: (html) => {
        const d = document.createElement("div");
        d.innerHTML = (html || "").trim();
        return d.firstElementChild;
      },
      $: (sel, root = document) => root.querySelector(sel),
      $$: (sel, root = document) => Array.from(root.querySelectorAll(sel)),
      getApiBase: () => window.APP_CONFIG?.API_BASE || "https://conhecimento-com-luz-api.onrender.com",
      apiGet: async (path, opts = {}) => {
        const url = JORNADA_UTILS.getApiBase() + path;
        const res = await fetch(url, { method: "GET", headers: { Accept: "application/json" }, ...opts });
        if (!res.ok) throw new Error(`GET ${url} -> ${res.status}`);
        return res.headers.get("content-type")?.includes("application/json") ? res.json() : res.text();
      },
      apiPost: async (path, body = {}, opts = {}) => {
        const url = JORNADA_UTILS.getApiBase() + path;
        const res = await fetch(url, { method: "POST", headers: { "Content-Type": "application/json", Accept: "application/json, application/pdf" }, body: JSON.stringify(body), ...opts });
        if (!res.ok) throw new Error(`POST ${url} -> ${res.status}`);
        const ct = res.headers.get("content-type") || "";
        if (ct.includes("application/json")) return res.json();
        if (ct.includes("application/pdf")) return res.blob();
        return res.text();
      }
    };
    window.JORNADA_UTILS = JORNADA_UTILS;

    // State
    const JSTATE = {
      load: () => JORNADA_UTILS.loadLocal('jornada_state'),
      save: (data) => JORNADA_UTILS.saveLocal('jornada_state', data),
      clearAll: () => JORNADA_UTILS.clearLocal('jornada_state'),
      get: (k, fallback) => JSTATE.load()[k] ?? fallback,
      set: (k, v) => {
        const st = JSTATE.load();
        st[k] = v;
        JSTATE.save(st);
      }
    };
    window.JSTATE = JSTATE;

    // UI
    const UI = {
      qs: (sel, root = document) => root.querySelector(sel),
      qsa: (sel, root = document) => Array.from(root.querySelectorAll(sel)),
      showSection: (idOrSelector) => {
        const views = UI.qsa('section.card');
        const target = idOrSelector?.startsWith('#') || idOrSelector?.startsWith('[')
          ? idOrSelector
          : `#${idOrSelector}`;
        views.forEach(sec => {
          if (sec.matches(target)) sec.classList.remove('hidden');
          else sec.classList.add('hidden');
        });
      },
      setProgress: (percent) => {
        const bar = UI.qs('#progressBar');
        if (bar) bar.style.width = `${Math.max(0, Math.min(100, percent))}%`;
      },
      setPergunta: (index, total, perguntas) => {
        const titulo   = UI.qs('#perguntaTitulo');
        const etapaNum = UI.qs('#etapaNum');
        const etapaTot = UI.qs('#etapaTot');

        if (etapaTot) etapaTot.textContent = String(total || (perguntas?.length || 0));
        if (etapaNum) etapaNum.textContent = String((index ?? 0) + 1);

        if (titulo) {
          if (Array.isArray(perguntas)) {
            const item  = perguntas[index] ?? '';
            const texto = typeof item === 'string' ? item : (item?.titulo || item?.texto || '');
            titulo.textContent = texto || 'Pergunta';
          } else {
            titulo.textContent = 'Pergunta';
          }
        }
      },
      toast: (msg) => {
        const t = document.createElement('div');
        t.className = 'toast';
        t.textContent = msg;
        document.body.appendChild(t);
        requestAnimationFrame(() => t.classList.add('show'));
        setTimeout(() => { t.classList.remove('show'); t.remove(); }, 3000);
      },
      fadeOutIn: (fn) => {
        const root = UI.qs('#app') || document.body;
        root.classList.add('fade-out');
        setTimeout(() => {
          try { fn && fn(); }
          finally { root.classList.remove('fade-out'); }
        }, 220);
      },
      mountGlobalHandlers: () => {
        document.addEventListener('click', (e) => {
          if (e.target.matches('[data-once]')) {
            if (e.target.dataset._locked) { e.preventDefault(); return; }
            e.target.dataset._locked = '1';
          }
        });
      }
    };
    window.UI = UI;

    /* =========================
       EMOÇÃO E DATILOGRAFIA
    ==========================*/
    function analyzeSentiment(text) {
      let score = 0;
      const tokens = (text || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').split(/\s+/);
      for (const t of tokens) {
        if (EMO.POS[t] != null) score += EMO.POS[t];
        if (EMO.NEG[t] != null) score += EMO.NEG[t];
      }
      return score;
    }
    function typeWriter(el, text, speed, showCursor) {
      if (!el) return;
      el.textContent = '';
      if (showCursor) el.classList.add('lumen-typing');
      let i = 0;
      (function step() {
        if (i < text.length) {
          el.textContent += text.charAt(i++);
          setTimeout(step, speed);
        } else {
          el.classList.add('typing-done');
        }
      })();
    }
    function runTyping(root) {
      (root || document).querySelectorAll('[data-typing]').forEach(el => {
        if (el.dataset._typed) return;
        const t = el.getAttribute('data-text') || el.textContent || '';
        const spd = parseInt(el.getAttribute('data-speed') || '26', 10);
        const cur = String(el.getAttribute('data-cursor') || 'true') === 'true';
        el.dataset._typed = '1';
        typeWriter(el, t, spd, cur);
      });
    }

    /* =========================
       CHAMA
    ==========================*/
    const JORNADA_CHAMA = {
      analyzeSentiment: analyzeSentiment,
      updateChama: function(scoreNum, targetId = 'chama-perguntas') {
        const el = document.getElementById(targetId);
        if (!el) {
          console.error('Elemento', targetId, 'não encontrado!');
          return;
        }
        el.classList.add('chama-viva');
        const modo = (scoreNum <= -2) ? 'fraca' : (scoreNum >= 2) ? 'forte' : 'media';
        el.setAttribute('data-intensidade', modo);
        if (modo === 'forte') {
          el.classList.add('chama-pico');
          clearTimeout(el._pulse_t);
          el._pulse_t = setTimeout(() => el.classList.remove('chama-pico'), 700);
        } else {
          el.classList.remove('chama-pico');
        }
        const bola = document.getElementById('chama-bola');
        if (bola) {
          bola.classList.remove('fraca', 'media', 'forte');
          bola.classList.add(modo);
          bola.setAttribute('data-intensidade', modo);
        }
        console.log('Chama', targetId, 'atualizada para:', modo);
      },
      updateChamaFromText: function(text, targetId = 'chama-perguntas') {
        const score = analyzeSentiment(text);
        this.updateChama(score, targetId);
        return { score, intensidade: (score <= -2) ? 'fraca' : (score >= 2) ? 'forte' : 'media' };
      },
      setChamaIntensidade: function(target, modo) {
        const el = typeof target === 'string' ? document.getElementById(target) : target;
        if (!el) return;
        el.classList.add('chama-viva');
        el.setAttribute('data-intensidade', modo);
        if (!el.querySelector('.brasa')) {
          el.innerHTML = `
            <div class="brasa"></div>
            <div class="lingua"></div>
            <div class="lingua"></div>
            <div class="lingua"></div>
            <div class="brilho"></div>
          `;
        }
      },
      ensureHeroFlame: function(sectionId) {
        const introChama = document.getElementById('chama-intro');
        const finalChama = document.getElementById('chama-final');
        const perguntasChama = document.getElementById('chama-perguntas');
        if (introChama) introChama.style.visibility = (sectionId === 'sec-intro') ? 'visible' : 'hidden';
        if (finalChama) finalChama.style.visibility = (sectionId === 'sec-final') ? 'visible' : 'hidden';
        if (perguntasChama) perguntasChama.style.visibility = (sectionId === 'sec-wizard') ? 'visible' : 'hidden';
      },
      setChamaBola: function(intensidade, targetId = 'chama-bola') {
        const el = document.getElementById(targetId);
        if (el) {
          el.classList.remove('fraca', 'media', 'forte');
          el.classList.add(intensidade);
          el.setAttribute('data-intensidade', intensidade);
        }
      }
    };
    window.JORNADA_CHAMA = JORNADA_CHAMA;

    // micro-variação para cada chama
    document.querySelectorAll('#chama-intro, #chama-perguntas, #chama-final, #chama-bola')
      .forEach(f => {
        f.style.setProperty('--jitter', `${(Math.random() * 2 - 1).toFixed(2)}px`);
        f.querySelectorAll('.lingua').forEach((n, i) => {
          n.style.animationDelay = `${i * 0.07 + Math.random() * 0.08}s`;
        });
      });

    /* =========================
       PROGRESSO & STORAGE
    ==========================*/
    function updateProgress() {
      const perguntas = document.querySelectorAll('.j-pergunta');
      const respondidas = Array.from(perguntas).filter(p => p.querySelector('textarea').value.trim() !== '').length;
      const progresso = (respondidas / (perguntas.length || 1)) * 100;
      const fill = document.getElementById('jprog-fill');
      const badge = document.getElementById('jprog-pct');
      const jFill = document.querySelector('.j-progress__fill');
      const jMeta = document.getElementById('j-meta');
      if (fill) fill.style.width = `${progresso}%`;
      if (badge) badge.textContent = `${Math.round(progresso)}% concluído`;
      if (jFill) jFill.style.width = `${progresso}%`;
      if (jMeta) jMeta.textContent = `Respondidas: ${respondidas} de ${perguntas.length}`;
      console.log('Progresso atualizado:', progresso);
    }
    function saveAnswers() {
      const respostas = {};
      document.querySelectorAll('.j-pergunta textarea').forEach((input, idx) => { respostas[`q${idx+1}`] = input.value || ''; });
      JSTATE.set('respostas', respostas);
    }
    function loadAnswers() {
      try {
        const respostas = JSTATE.get('respostas', {});
        document.querySelectorAll('.j-pergunta textarea').forEach((input, idx) => {
          input.value = respostas[`q${idx+1}`] || '';
        });
      } catch (e) { console.warn('Falha ao carregar respostas:', e); }
      updateProgress();
    }

    /* =========================
       ROTEAMENTO, RENDER E CONTROLE
    ==========================*/
    function updateCanvasBackground(sectionId) {
      const canvas = document.getElementById('jornada-canvas');
      if (canvas) {
        if (sectionId === 'sec-wizard') {
          canvas.className = 'card pergaminho pergaminho-h';
          canvas.style.backgroundImage = 'url(/assets/img/pergaminho-rasgado-horiz.png)';
        } else {
          canvas.className = 'card pergaminho pergaminho-v';
          canvas.style.backgroundImage = 'url(/assets/img/pergaminho-rasgado-vert.png)';
        }
      }
    }
    function showSection(sectionId) {
      document.querySelectorAll('.j-section').forEach(s => s.classList.add('hidden'));
      const active = document.getElementById(sectionId);
      if (active) active.classList.remove('hidden');
      updateCanvasBackground(sectionId);
      if (window.JORNADA_CHAMA && typeof window.JORNADA_CHAMA.ensureHeroFlame === 'function') {
        window.JORNADA_CHAMA.ensureHeroFlame(sectionId);
      }
      if (sectionId === 'sec-wizard') {
        loadDynamicBlocks();
        setTimeout(() => {
          updateProgress();
          const perguntas = document.querySelectorAll('.j-pergunta');
          console.log('Perguntas encontradas no DOM após loadDynamicBlocks:', perguntas.length);
          if (perguntas.length) {
            const firstBloco = document.querySelector('.j-bloco');
            if (firstBloco) {
              firstBloco.style.display = 'block';
              console.log('Primeiro bloco ativado:', firstBloco);
            }
            console.log('Primeira pergunta ativa:', perguntas[0]);
            perguntas[0].classList.add('active');
            runTyping(perguntas[0]);
            perguntas[0].querySelector('textarea').focus();
          } else {
            console.error('Nenhuma pergunta encontrada em sec-wizard após loadDynamicBlocks! Verifique JORNADA_BLOCKS:', window.JORNADA_BLOCKS);
          }
        }, 100);
      }
    }

    function loadDynamicBlocks() {
      const content = document.getElementById('perguntas-container');
      if (!content) {
        console.error('Erro: #perguntas-container não encontrado no DOM!');
        return;
      }
      const respostas = JSTATE.get('respostas', {});
      let i = parseInt(sessionStorage.getItem('jornada.step') || '0', 10) || 0;
      if (!window.JORNADA_BLOCKS || !Array.isArray(window.JORNADA_BLOCKS) || window.JORNADA_BLOCKS.length === 0) {
        console.error('Erro: JORNADA_BLOCKS não definido, forçando uso de PERGUNTAS como único bloco...');
        window.JORNADA_BLOCKS = [{ questions: PERGUNTAS.map(q => ({ label: q })) }];
      }
      console.log('Conteúdo de JORNADA_BLOCKS após fallback:', window.JORNADA_BLOCKS);
      content.innerHTML = '';
      window.JORNADA_BLOCKS.forEach((block, idx) => {
        if (!block.questions || !Array.isArray(block.questions)) {
          console.warn(`Bloco ${idx} inválido: sem perguntas ou perguntas não é um array`);
          return;
        }
        const bloco = document.createElement('section');
        bloco.className = 'j-bloco';
        bloco.dataset.bloco = idx;
        bloco.dataset.video = block.video_after || '';
        bloco.style.display = idx === 0 ? 'block' : 'none';
        block.questions.forEach((q, qIdx) => {
          if (!q.label) {
            console.warn(`Pergunta ${qIdx} no bloco ${idx} inválida: sem label`);
            return;
          }
          const pergunta = document.createElement('div');
          pergunta.className = 'j-pergunta';
          pergunta.dataset.pergunta = qIdx;
          const name = `q${qIdx + 1}`;
          const val = respostas[name] || '';
          pergunta.innerHTML = `
            <div class="mb-4">
              <div class="flex justify-between text-xs opacity-70">
                <span>Etapa ${qIdx + 1}/${PERGUNTAS.length}</span><span>${Math.round(((qIdx + 1) / PERGUNTAS.length) * 100)}%</span>
              </div>
              <div class="h-2 bg-slate-700/50 rounded-full mt-1">
                <div class="h-2 bg-indigo-500 rounded-full" style="width:${Math.round(((qIdx + 1) / PERGUNTAS.length) * 100)}%"></div>
              </div>
            </div>
            <h2 class="text-xl font-semibold mb-4">Jornada Essencial</h2>
            <div class="mb-2 font-medium">${qIdx + 1}. ${q.label}</div>
            <textarea id="ans-${qIdx}" name="${name}" rows="6" class="w-full bg-slate-900/60 border border-slate-700 rounded-lg p-3" oninput="handleInput(this)">${val}</textarea>
            <div class="mt-6 flex flex-wrap items-center gap-3">
              <button id="btnVoltar-${qIdx}" class="px-4 py-2 rounded-lg border border-slate-700 ${qIdx === 0 ? 'opacity-40 cursor-not-allowed' : ''}">Voltar</button>
              <button id="btnAvancar-${qIdx}" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 ${qIdx === PERGUNTAS.length - 1 ? 'Finalizar' : 'Avançar'}"></button>
            </div>
            <p class="text-xs opacity-70 mt-3">Suas respostas permanecem somente no seu navegador até a geração do PDF.</p>
          `;
          bloco.appendChild(pergunta);

          // Adicionar eventos
          const ans = pergunta.querySelector(`#ans-${qIdx}`);
          ans?.addEventListener('input', () => {
            const name = `q${qIdx + 1}`;
            const v = ans.value || '';
            const respostas = JSTATE.get('respostas', {});
            respostas[name] = v;
            JSTATE.set('respostas', respostas);
          });

          const btnAvancar = pergunta.querySelector(`#btnAvancar-${qIdx}`);
          btnAvancar?.addEventListener('click', () => {
            const txt = (ans.value || '').trim();
            if (!txt) {
              ans.classList.add('field-error');
              ans.focus();
              return;
            }
            ans.classList.remove('field-error');
            saveAnswers();
            if (qIdx < PERGUNTAS.length - 1) {
              i = qIdx + 1;
              sessionStorage.setItem('jornada.step', String(i));
              loadDynamicBlocks();
            } else {
              showSection('sec-final');
            }
          });

          const btnVoltar = pergunta.querySelector(`#btnVoltar-${qIdx}`);
          btnVoltar?.addEventListener('click', () => {
            if (qIdx > 0) {
              i = qIdx - 1;
              sessionStorage.setItem('jornada.step', String(i));
              loadDynamicBlocks();
            }
          });
        });
        content.appendChild(bloco);
        console.log(`Bloco ${idx} criado com ${block.questions.length} perguntas`);
      });
      const firstBloco = content.querySelector('.j-bloco');
      if (firstBloco) {
        const firstPergunta = firstBloco.querySelector('.j-pergunta');
        if (firstPergunta) {
          firstPergunta.classList.add('active');
          runTyping(firstPergunta);
          const firstTa = firstPergunta.querySelector('textarea');
          if (firstTa) handleInput(firstTa);
        } else {
          console.error('Nenhuma primeira pergunta encontrada no primeiro bloco!');
        }
        loadAnswers();
      } else {
        console.error('Nenhum bloco criado após loadDynamicBlocks!');
      }
      console.log('Blocos carregados com sucesso!');
    }

    const JC = (window.JC = window.JC || {});
    const state = {
      blocoIndex: 0,
      perguntaIndex: parseInt(sessionStorage.getItem('jornada.step') || '0', 10) || 0,
      respostas: JSTATE.get('respostas', {}),
    };

    const S = {
      root: () => document.getElementById('jornada-canvas'),
      blocos: () => Array.from(document.querySelectorAll('.j-bloco,[data-bloco]')),
      blocoAtivo: () => S.blocos()[state.blocoIndex],
      perguntasDo: (blocoEl) => Array.from(blocoEl.querySelectorAll('.j-pergunta,[data-pergunta]')),
      btnPrev: () => document.getElementById('btnVoltar') || document.querySelector('[data-action="prev"]'),
      btnNext: () => document.getElementById('btnProxima') || document.querySelector('[data-action="next"]'),
      btnStart: () => document.getElementById('btnIniciar') || document.querySelector('[data-action="start"]'),
      meta: () => document.getElementById('j-meta'),
      progressFill: () => document.querySelector('.j-progress__fill'),
      overlay: () => document.getElementById('videoOverlay'),
      video: () => document.getElementById('videoTransicao'),
      skip: () => document.getElementById('skipVideo'),
    };

    const U = {
      show(el, disp = 'block') { if (el) el.style.display = disp; },
      hide(el) { if (el) el.style.display = 'none'; },
      clamp(n, a, b) { return Math.max(a, Math.min(b, n)); },
      key(b, q) { return `b${b}-q${q}`; },
      getAnswerEl(qEl) { return qEl?.querySelector?.('textarea, input[type="text"], input[type="email"], input[type="number"], input[type="search"]') || null; },
      getVal(el) { return (el && (el.value ?? '')).trim(); },
      setProgress(cur, total) {
        const pct = total ? Math.round((cur / total) * 100) : 0;
        const bar = S.progressFill();
        const meta = S.meta();
        if (bar) bar.style.width = pct + '%';
        if (meta) meta.innerHTML = `<b>${cur}</b> / ${total} (${pct}%)`;
      },
      analiseSentiment(texto) {
        const textoNormalizado = texto.toLowerCase().split(/\s+/);
        let posCount = 0, negCount = 0;
        textoNormalizado.forEach(word => {
          if (window.JORNADA_QA.positiveWords.includes(word)) posCount++;
          if (window.JORNADA_QA.negativeWords.includes(word)) negCount++;
        });
        return posCount > negCount ? "alegre" : (negCount > posCount ? "sofrida" : "neutra");
      }
    };

    function saveCurrentAnswer() {
      const bloco = S.blocoAtivo();
      if (!bloco) return;
      const perguntas = S.perguntasDo(bloco);
      const qEl = perguntas[state.perguntaIndex];
      if (!qEl) return;
      const input = U.getAnswerEl(qEl);
      if (input) {
        const k = U.key(state.blocoIndex, state.perguntaIndex);
        state.respostas[k] = U.getVal(input);
        JSTATE.set('respostas', state.respostas);
      }
    }

    function applyPergaminhoByRoute() {
      const route = (location.hash || '#sec-intro').slice(1);
      console.log('[JORNADA_CONTROLLER] Aplicando pergaminho por rota:', route);
      const canvas = document.getElementById('jornada-canvas');
      if (canvas) {
        if (route === 'sec-intro' || route === 'sec-final') {
          canvas.className = 'card pergaminho pergaminho-v';
          canvas.style.backgroundImage = 'url(/assets/img/pergaminho-rasgado-vert.png)';
        } else {
          canvas.className = 'card pergaminho pergaminho-h';
          canvas.style.backgroundImage = 'url(/assets/img/pergaminho-rasgado-horiz.png)';
        }
      }
    }

    function applyPergaminhoByBloco(blocoEl) {
      if (!blocoEl) {
        console.warn('Bloco não encontrado para aplicar pergaminho');
        return;
      }
      let modo = 'h';
      if (blocoEl.hasAttribute('data-pergaminho-h')) modo = 'h';
      else if (blocoEl.hasAttribute('data-pergaminho-v')) modo = 'v';
      else modo = blocoEl.getAttribute('data-pergaminho') || 'h';
      console.log('[JORNADA_CONTROLLER] Aplicando pergaminho para bloco:', modo, blocoEl);
      const canvas = document.getElementById('jornada-canvas');
      if (canvas) {
        if (modo === 'v') {
          canvas.className = 'card pergaminho pergaminho-v';
          canvas.style.backgroundImage = 'url(/assets/img/pergaminho-rasgado-vert.png)';
        } else {
          canvas.className = 'card pergaminho pergaminho-h';
          canvas.style.backgroundImage = 'url(/assets/img/pergaminho-rasgado-horiz.png)';
        }
      }
    }

    function render() {
      const root = S.root();
      if (!root) {
        console.warn('Root #jornada-canvas não encontrado');
        return;
      }
      U.show(root, 'block');
      const blocos = S.blocos();
      if (!blocos.length) {
        console.error('Nenhum bloco encontrado após loadDynamicBlocks!');
        return;
      }
      blocos.forEach(U.hide);
      const bloco = S.blocoAtivo();
      if (bloco) U.show(bloco);
      else {
        console.error('Bloco ativo não encontrado no índice:', state.blocoIndex);
        return;
      }
      const perguntas = S.perguntasDo(bloco);
      if (!perguntas.length) {
        console.error('Nenhuma pergunta encontrada no bloco ativo:', bloco);
        return;
      }
      perguntas.forEach(q => q.classList.remove('active')); // Remove active de todas
      state.perguntaIndex = U.clamp(state.perguntaIndex, 0, Math.max(0, perguntas.length - 1));
      const atual = perguntas[state.perguntaIndex];
      if (atual) {
        atual.classList.add('active'); // Mostra só a pergunta atual
        console.log('Exibindo pergunta:', state.perguntaIndex + 1, 'de', perguntas.length);
        const input = U.getAnswerEl(atual);
        if (input) {
          input.removeAttribute?.('hidden');
          input.style.display = 'block';
          input.style.visibility = 'visible';
          try { input.focus({ preventScroll: true }); } catch (e) { console.warn('Erro ao focar input:', e); }
        }
      } else {
        console.error('Pergunta atual não encontrada no índice:', state.perguntaIndex);
      }
      runTyping(atual);
      applyPergaminhoByBloco(bloco);
      U.setProgress(state.perguntaIndex + 1, perguntas.length);
      const prev = S.btnPrev();
      const next = S.btnNext();
      if (prev) prev.disabled = (state.perguntaIndex === 0);
      if (next) {
        const ultimaPergunta = state.perguntaIndex === perguntas.length - 1;
        next.textContent = ultimaPergunta ? 'Finalizar' : 'Avançar';
        next.disabled = !U.getVal(UI.qs(`#ans-${state.perguntaIndex}`));
      }
    }

    function goNext() {
      const bloco = S.blocoAtivo();
      const perguntas = S.perguntasDo(bloco);
      saveCurrentAnswer();
      if (state.perguntaIndex < perguntas.length - 1) {
        state.perguntaIndex++;
        sessionStorage.setItem('jornada.step', String(state.perguntaIndex));
        render();
        return;
      }
      showSection('sec-final');
    }

    function goPrev() {
      if (state.perguntaIndex > 0) {
        state.perguntaIndex--;
        sessionStorage.setItem('jornada.step', String(state.perguntaIndex));
        render();
      }
    }

    function startJourney() {
      const senhaInput = document.getElementById('senha');
      if (!senhaInput) {
        console.error('Campo senha não encontrado!');
        alert('Erro: Campo de senha não carregou. Recarregue a página.');
        return;
      }
      const senha = senhaInput.value || '';
      const senhasValidas = ['iniciar', 'olho magico', 'olho mágico'];
      if (senhasValidas.includes(senha.toLowerCase())) {
        JSTATE.set('auth', 'ok');
        showSection('sec-intro');
        console.log('Autenticação bem-sucedida, exibindo introdução');
      } else {
        alert('Senha incorreta. Tente novamente.');
      }
    }

    function playTransition(src, onEnd) {
      const overlay = S.overlay();
      const video = S.video();
      const skip = S.skip();
      if (!overlay || !video || !src) {
        console.warn('Overlay, vídeo ou src não disponível:', { overlay, video, src });
        onEnd && onEnd();
        return;
      }
      try { video.pause(); video.removeAttribute('src'); video.load(); } catch {}
      video.src = src;
      overlay.classList.remove('hidden');
      const cleanup = () => {
        try { video.pause(); } catch {}
        overlay.classList.add('hidden');
        try { video.removeAttribute('src'); video.load(); } catch {}
        onEnd && onEnd();
      };
      video.onended = cleanup;
      video.onerror = () => {
        console.warn('Vídeo não carregou:', src, 'Ignorando transição.');
        cleanup();
      };
      if (skip) skip.onclick = cleanup;
      try {
        video.muted = true;
        const p = video.play();
        if (p && p.catch) p.catch(() => {});
      } catch {}
    }

    function finalize() {
      saveCurrentAnswer();
      console.log('[JORNADA] Finalizado. Respostas:', state.respostas);
      const payload = { respostas: state.respostas, meta: { quando: new Date().toISOString() } };
      let pdfok = false;

      // Simulação local (sem backend)
      const pdfBlob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/pdf' });
      baixarArquivo(pdfBlob, `Jornada-Essencial_${stamp()}.pdf`);
      pdfok = true;

      // Limpeza e retorno
      if (pdfok) {
        JSTATE.clearAll();
        sessionStorage.removeItem('jornada.step');
        alert('Jornada concluída! Arquivo gerado localmente.');
        location.replace('/index.html');
      } else {
        alert('Não foi possível gerar o PDF agora. Tente novamente.');
      }
    }

    function handleInput(textarea) {
      console.log('Input detectado em:', textarea.placeholder);
      const score = analyzeSentiment(textarea.value);
      JORNADA_CHAMA.updateChama(score);
      saveAnswers();
      updateProgress();
      const qIdx = parseInt(textarea.id.replace('ans-', ''), 10);
      const btnAvancar = document.getElementById(`btnAvancar-${qIdx}`);
      if (btnAvancar) btnAvancar.disabled = !textarea.value.trim();
    }
    function toggleSenha() {
      const input = document.getElementById('senha');
      if (input) {
        input.type = input.type === 'password' ? 'text' : 'password';
        console.log('Toggle senha para:', input.type);
      } else {
        console.error('Campo senha não encontrado!');
      }
    }

    function baixarArquivo(blob, nome) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = nome;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function stamp() {
      const d = new Date(), p = n => String(n).padStart(2,'0');
      return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}_${p(d.getHours())}-${p(d.getMinutes())}-${p(d.getSeconds())}`;
    }

    JC.init = function initJornada() {
      const root = S.root();
      if (!root) {
        console.warn('Root #jornada-canvas não encontrado para inicialização');
        return;
      }
      applyPergaminhoByRoute();
      const startBtn = S.btnStart();
      if (startBtn) {
        startBtn.addEventListener('click', startJourney);
        console.log('Botão Iniciar inicializado em JC.init');
      } else {
        console.error('Botão #btnIniciar não encontrado no DOM durante JC.init!');
      }
      const prevBtn = S.btnPrev();
      const nextBtn = S.btnNext();
      if (nextBtn) nextBtn.addEventListener('click', goNext);
      if (prevBtn) prevBtn.addEventListener('click', goPrev);
      const chkTermo = document.getElementById('chkTermo');
      const btnIniciar = document.getElementById('btnIniciar');
      if (chkTermo && btnIniciar) {
        const toggleStart = () => { btnIniciar.disabled = !chkTermo.checked; };
        toggleStart();
        chkTermo.addEventListener('change', toggleStart);
      }
      const btnEntrar = document.getElementById('btnEntrar');
      if (btnEntrar) btnEntrar.addEventListener('click', startJourney);
      document.addEventListener('click', (e) => {
        const n = e.target.closest?.('[data-action="next"]');
        const p = e.target.closest?.('[data-action="prev"]');
        const s = e.target.closest?.('[data-action="start"]');
        if (n) { e.preventDefault(); goNext(); }
        if (p) { e.preventDefault(); goPrev(); }
        if (s) { e.preventDefault(); startJourney(); }
      });
      try {
        const stash = JSTATE.get('respostas', {});
        if (stash) state.respostas = stash;
        const auth = JSTATE.get('auth', '');
        if (auth !== 'ok') showSection('sec-auth');
        else if (state.respostas && Object.keys(state.respostas).length > 0) {
          state.perguntaIndex = parseInt(sessionStorage.getItem('jornada.step') || '0', 10) || 0;
          showSection('sec-wizard');
        } else {
          showSection('sec-intro');
        }
      } catch {}
      render();
    };

    const TAG = '[BOOT]';
    const log = (...a) => console.log(TAG, ...a);
    const warn = (...a) => console.warn(TAG, ...a);
    const error = (...a) => console.error(TAG, ...a);

    function routeFromHash() {
      return (location.hash || '#sec-intro').slice(1);
    }

    function dumpScriptsOnce() {
      if (dumpScriptsOnce._done) return;
      dumpScriptsOnce._done = true;
      try {
        const items = Array.from(document.scripts || []).map(s => ({
          defer: !!s.defer,
          src: s.src || '(inline)',
        }));
        log('scripts carregados (ordem):');
        console.table(items);
      } catch {}
    }

    function boot() {
      dumpScriptsOnce();
      const route = routeFromHash();
      log('tentando iniciar • rota:', route);

      try { document.body.classList.add('jornada-active'); } catch {}

      try {
        if (route === 'sec-intro') {
          log('→ renderIntro()');
          renderIntro();
        } else if (route === 'sec-wizard') {
          log('→ renderPerguntas(0)');
          renderPerguntas(0);
        } else if (route === 'sec-final') {
          log('→ renderFinal()');
          renderFinal();
        } else {
          log('→ rota desconhecida, caindo na intro');
          renderIntro();
        }
      } catch (e) {
        error('falha ao chamar renderer:', e);
      }

      applyPergaminhoByRoute();
      setTimeout(() => {
        if (window.JC?.init) {
          try { 
            log('acionando JC.init() (reforço)');
            window.JC.init();
          } catch (e) {
            warn('falha ao acionar JC.init():',
