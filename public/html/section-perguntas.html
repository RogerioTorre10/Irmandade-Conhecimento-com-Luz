<link rel="stylesheet" href="/assets/css/styles-base.css">
<link rel="stylesheet" href="/assets/css/brilho-texturas.css">
<link rel="stylesheet" href="/assets/css/styles-perguntas.css">
<script src="/assets/js/jornada-chama.js"></script>
<script src="/assets/js/jornada-micro.js"></script>
<script src="/assets/js/jornada-paper-qa.js"></script>

<section id="section-perguntas" class="section section-perguntas" data-section="perguntas">
  <div class="perguntas-wrap">

    <!-- === VÍDEO DE TRANSIÇÃO === -->
    <div id="videoOverlay" class="video-overlay" style="display:none;">
      <video id="videoTransicao" playsinline preload="auto" style="max-width:100%;"></video>
    </div>

    <!-- === RÉGUA SUPERIOR — BLOCOS (1 a 5) === -->
    <div class="progress-top">
      <div class="progress-label">Blocos</div>
      <div class="progress-bar gold" id="block-bar">
        <div id="progress-block-fill" class="progress-fill"></div>
        <div class="glow-line"></div>
      </div>
      <span id="progress-block-value" class="progress-value">1 de 5</span>
    </div>

    <!-- === AMPULHETA TOTAL COM AREIA === -->
    <div class="progress-total">
      <div class="hourglass-container">
        <span class="ampulheta">hourglass</span>
        <div class="sand-fill" id="sand-fill"></div>
      </div>
      <span id="progress-total-value" class="progress-value">1 / 50</span>
    </div>

    <!-- === TERMÔMETRO — PERGUNTAS DO BLOCO === -->
    <div class="thermometer-container">
      <div class="thermometer">
        <div class="mercury" id="progress-question-mercury"></div>
        <div class="glow" id="question-glow"></div>
        <div class="marks">
          <span>10</span><span>5</span><span>0</span>
        </div>
      </div>
      <div class="progress-label thermo-label">Pergunta <span id="progress-question-value">1</span> / 10</div>
    </div>

    <!-- === PERGAMINHO === -->
    <div class="perguntas-pergaminho">
      <div id="jp-question-typed" class="jp-question-typed" aria-live="polite">
        Carregando pergunta...
      </div>

      <div class="jp-answer-frame">
        <div class="jp-answer-bg"></div>
        <textarea id="jp-answer-input" class="jp-answer-input" rows="4"
                  placeholder="Digite sua resposta com verdade e calma..."></textarea>
      </div>

      <div id="jp-ai-response" class="jp-ai-response" hidden></div>
    </div>

    <!-- === CONTROLES === -->
    <div class="perguntas-controls">
      <button id="jp-btn-falar" class="btn-perguntas" data-action="start-mic">Falar</button>
      <button id="jp-btn-apagar" class="btn-perguntas" data-action="clear">Apagar</button>
      <button id="jp-btn-confirmar" class="btn-perguntas btn-confirm" data-action="confirm">
        Confirmar / Próxima
      </button>
    </div>

  </div>
</section>

<!-- === ESTILOS FORÇADOS (SOBRESCREVEM TUDO) === -->
<style>
  /* === FORÇA SOBRE CSS EXTERNO === */
  #section-perguntas .progress-top,
  #section-perguntas .progress-total,
  #section-perguntas .thermometer-container,
  #section-perguntas .progress-bar,
  #section-perguntas .progress-fill,
  #section-perguntas .progress-value {
    all: unset !important;
    display: revert !important;
  }

  /* === RÉGUA DOS BLOCOS === */
  #section-perguntas .progress-top {
    position: absolute !important;
    top: 20px !important;
    left: 5% !important;
    width: 90% !important;
    display: flex !important;
    align-items: center !important;
    gap: 10px !important;
    font-family: 'Cinzel', serif !important;
    color: #e8c87d !important;
    text-shadow: 0 1px 3px #000 !important;
    z-index: 100 !important;
  }

  #section-perguntas .progress-label {
    min-width: 70px !important;
    font-weight: 600 !important;
  }

  #section-perguntas .progress-bar.gold {
    flex: 1 !important;
    height: 10px !important;
    border-radius: 6px !important;
    background: rgba(0,0,0,0.5) !important;
    overflow: hidden !important;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.7) !important;
    border: 1px solid rgba(255,215,0,0.3) !important;
    position: relative !important;
  }

  #progress-block-fill {
    height: 100% !important;
    width: 20% !important;
    background: linear-gradient(90deg, #b8860b, #ffd700, #b8860b) !important;
    border-radius: 6px !important;
    position: relative !important;
    overflow: hidden !important;
    transform: translateZ(0) !important;
    will-change: width !important;
  }

  #section-perguntas .glow-line {
    position: absolute !important;
    top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent) !important;
    animation: shimmer 2.5s infinite !important;
    pointer-events: none !important;
  }

  /* === AMPULHETA === */
  #section-perguntas .progress-total {
    position: absolute !important;
    top: 18px !important;
    right: 24px !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    color: #ffd700 !important;
    font-weight: 700 !important;
    font-size: 1rem !important;
    text-shadow: 0 1px 3px #000 !important;
  }

  #section-perguntas .hourglass-container {
    position: relative !important;
    width: 28px !important;
    height: 38px !important;
  }

  #section-perguntas .ampulheta {
    font-size: 28px !important;
    animation: spinHourglass 3s infinite linear !important;
    filter: drop-shadow(0 0 8px #ffda6b) !important;
    display: block !important;
  }

  #sand-fill {
    position: absolute !important;
    bottom: 5px !important;
    left: 6px !important;
    width: 16px !important;
    height: 0% !important;
    background: linear-gradient(to top, #d4af37, #ffd700) !important;
    border-radius: 2px !important;
    transform: translateZ(0) !important;
    will-change: height !important;
  }

  /* === TERMÔMETRO === */
  #section-perguntas .thermometer-container {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    margin: 16px 0 !important;
    font-family: 'Cinzel', serif !important;
    color: #e8c87d !important;
  }

  #section-perguntas .thermometer {
    position: relative !important;
    width: 60px !important;
    height: 180px !important;
    background: rgba(255,255,255,0.1) !important;
    border-radius: 30px !important;
    overflow: hidden !important;
    border: 3px solid rgba(255,255,255,0.2) !important;
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.3), inset 0 0 15px rgba(0,0,0,0.5) !important;
  }

  #progress-question-mercury {
    position: absolute !important;
    bottom: 0 !important;
    width: 100% !important;
    height: 0% !important;
    background: linear-gradient(to top, #ff3366, #00ff88) !important;
    border-radius: 30px !important;
    transform: translateZ(0) !important;
    will-change: height !important;
    box-shadow: 0 0 25px #00ff88 !important;
  }

  #question-glow {
    position: absolute !important;
    bottom: 0 !important;
    width: 100% !important;
    height: 40px !important;
    background: radial-gradient(ellipse at center, #00ff8833 0%, transparent 70%) !important;
    opacity: 0.7 !important;
    pointer-events: none !important;
  }

  #section-perguntas .marks {
    position: absolute !important;
    right: -24px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: space-between !important;
    height: 160px !important;
    font-size: 0.7rem !important;
    color: #aaa !important;
  }

  #section-perguntas .thermo-label {
    font-weight: 600 !important;
    color: #ffd700 !important;
    text-shadow: 0 1px 2px #000 !important;
  }

  /* === ANIMAÇÕES === */
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  @keyframes spinHourglass {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
  }

  @media (max-width: 480px) {
    #section-perguntas .progress-top { top: 10px !important; left: 4% !important; width: 92% !important; }
    #section-perguntas .progress-total { top: 12px !important; right: 12px !important; }
    #section-perguntas .thermometer { width: 50px !important; height: 150px !important; }
    #section-perguntas .marks { right: -20px !important; height: 130px !important; font-size: 0.6rem !important; }
  }
</style>

<!-- === JS DE PROGRESSO (NÃO TOCA NO DATILOGRAFIA) === -->
<script>
  let currentQuestion = 1;
  const totalQuestions = 50;
  const questionsPerBlock = 10;
  const totalBlocks = 5;

  function updateProgress() {
    const blockNum = Math.floor((currentQuestion - 1) / questionsPerBlock) + 1;
    const questionInBlock = ((currentQuestion - 1) % questionsPerBlock) + 1;
    const totalPercent = (currentQuestion / totalQuestions) * 100;
    const blockPercent = (blockNum / totalBlocks) * 100;
    const questionPercent = (questionInBlock / questionsPerBlock) * 100;

    requestAnimationFrame(() => {
      document.getElementById('progress-block-fill').style.width = blockPercent + '%';
      document.getElementById('progress-block-value').textContent = `${blockNum} de 5`;

      document.getElementById('sand-fill').style.height = totalPercent + '%';
      document.getElementById('progress-total-value').textContent = `${currentQuestion} / 50`;

      document.getElementById('progress-question-mercury').style.height = questionPercent + '%';
      const glow = document.getElementById('question-glow');
      glow.style.height = (questionPercent > 10 ? 40 : questionPercent * 4) + 'px';
      document.getElementById('progress-question-value').textContent = questionInBlock;
    });
  }

  // Conecta com seu botão
  document.getElementById('jp-btn-confirmar')?.addEventListener('click', () => {
    if (currentQuestion < totalQuestions) {
      currentQuestion++;
      updateProgress();
    }
  });

  updateProgress();
</script>
